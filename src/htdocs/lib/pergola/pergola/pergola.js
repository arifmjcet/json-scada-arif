
/*
 * PERGOLA - JAVASCRIPT SVG FRAMEWORK AND LIBRARIES
 *
 * Author : Domenico Strazzullo
 * Contributor : Jayne De Sesa 
 * Copyright (C) 2009-2015  Dotuscomus
 * info@dotuscomus.com
 * http://www.dotuscomus.com/pergola/
 * License : http://www.dotuscomus.com/pergola/licenses 
*/

"use strict";var pergola={version:"2.2.2",ns:{svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},path:path,locale:navigator.language,debug:debug,decimals:decimals,theme:theme,systemMenu:systemMenu,taskbarLogo:taskbarLogo,undos:undos,getDir:"getDir.php",writeFile:"writeFile.php",doc:document.documentElement,mutationEvnt:document.implementation.hasFeature("MutationEvents","2.0")|!!window.MutationEvent,mutationObserver:window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,NF:window.Intl&&Intl.NumberFormat?!0:!1,DTF:window.Intl&&Intl.DateTimeFormat?!0:!1,remote:/http/.test(window.location.toString()),browser:{trident:/Trident/.test(navigator.userAgent),firefox:/Firefox/.test(navigator.userAgent),opera:/OPR/.test(navigator.userAgent),webkit:/WebKit/.test(navigator.userAgent),chrome:/Chrome/.test(navigator.userAgent),safari:/Safari/.test(navigator.userAgent)},removeSelection:!1,preventMousemoveDefault:!0,preventMousedownDefault:!1,preemptiveIsUp:null,contextmenuEnabled:!0,xmlName:{list:[],exist:function(t){var e,i=pergola.xmlName.list;for(e in i)if(t==i[e].substring(i[e].indexOf("XML")))return!0;return!1},add:function(t){return pergola.xmlName.list.push(t),t},remove:function(t){var e,i=pergola.xmlName.list;for(e in i)if(t==i[e]){i.splice(e,1);break}}},subclass:function(t,e){function i(){}var o,s;t.length||(t=[t]),i.prototype=e.prototype;for(s in t)o=t[s],o.prototype=new i,o.prototype.constructor=o,o.baseConstructor=e,o.superClass=e.prototype},extend:function(t,e){for(var i in e)t[i]=e[i];return t},destroy:function(t,e){t&&t[e]?delete t[e]:e in window&&(delete window[e]||(window[e]=null))},SVG:function(t){var e,i;for(var o in t)switch(i=t[o],o){case"element":e=document.createElementNS(pergola.ns.svg,i);break;case"textNode":e.appendChild(document.createTextNode(i));break;case"appendTo":i.appendChild(e);break;default:e.setAttributeNS("xlink:href"==o?pergola.ns.xlink:null,o,i)}return e},HTML_FO:function(t){var e,i;for(var o in t)switch(i=t[o],o){case"element":e=document.createElementNS(pergola.ns.xhtml,i);break;case"textNode":e.appendChild(document.createTextNode(i));break;case"appendTo":i.appendChild(e);break;default:e.setAttribute(o,i)}return e},HTML:function(t){var e,i;for(var o in t)switch(i=t[o],o){case"element":e=document.createElement(t.element);break;case"textNode":e.appendChild(document.createTextNode(i));break;case"appendTo":i.appendChild(e);break;default:e.setAttribute(o,i)}return e},attribute:function(t,e,i){var o;switch(i){case void 0:for(o in e)t.setAttributeNS(null,o,e[o]);break;case!1:for(o in e)t.setAttribute(o,e[o]);break;default:for(o in e)t.setAttributeNS(i,o,e[o])}},removeChildren:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},width:function(){return window.getComputedStyle?parseInt(window.getComputedStyle(pergola.container||pergola.doc,null).width):window.innerWidth},height:function(){return window.getComputedStyle?parseInt(window.getComputedStyle(pergola.container||pergola.doc,null).height):window.innerHeight},mousePoint:function(t){if(pergola.container){var e=pergola.doc.createSVGPoint();return e.x=t.clientX,e.y=t.clientY,e=e.matrixTransform(pergola.doc.getScreenCTM().inverse()),{x:e.x,y:e.y}}return{x:t.clientX,y:t.clientY}},setCursor:function(t,e){var i="";-1!=e.indexOf("#")&&(i=", default;"),t.setAttributeNS(null,"style","cursor:"+e+i)},select:function(t){"mousedown"==t.type?(pergola.preventMousedownDefault&&(t.preventDefault(),pergola.preventMousedownDefault=!1),t.detail>1&&t.target==pergola.background.rect&&t.preventDefault(),pergola.removeSelection&&(window.getSelection().removeAllRanges(),pergola.removeSelection=!1),pergola.doc.addEventListener("mousemove",pergola.select,!1),pergola.doc.addEventListener("mouseup",pergola.select,!1)):"mousemove"==t.type?(pergola.preventMousemoveDefault&&t.preventDefault(),pergola.browser.firefox&&window.getSelection().removeAllRanges()):"mouseup"==t.type&&(pergola.doc.removeEventListener("mousemove",pergola.select,!1),pergola.doc.removeEventListener("mouseup",pergola.select,!1))},contextmenuManager:{browser:function(t){pergola.contextmenuEnabled||t.preventDefault(),pergola.contextmenuEnabled=!0},custom:function(){pergola.Contextmenu.active&&pergola.Contextmenu.active.close()},activate:function(t,e,i){return"mousedown"==t.type?void t.target.addEventListener("mouseup",e,!1):(pergola.contextmenuEnabled=!1,t.target.removeEventListener("mouseup",e,!1),t.target.contextmenu||(t.target.contextmenu=(new pergola.Contextmenu).build({items:i})),void t.target.contextmenu.open(pergola.mousePoint(t)))}},use:function(t){if(!t.shape)return void alert(pergola.messages.noSuchShape);var e=pergola.extend({},t.shape);return e.appendTo=t.parent,$C(pergola.extend(e,t.attributes))},symbol:function(t){var e,i,o,s=t.x||0,n=t.y||0,r=t.parent||this.container,a={element:"g","pointer-events":"none",appendTo:pergola.user};if(t.opacity&&(a.opacity=t.opacity),a=$C(a),"string"==typeof t.symbol)$C({element:"image",width:t.width,height:t.height,"xlink:href":t.symbol,appendTo:a});else for(o in t.symbol)e=t.symbol[o],pergola.extend(e,t.attributes),e.appendTo=a,$C(e);return this!=pergola&&(i=a.getBBox(),s||(s=Math.ceil((this.width-i.width)/2)),n||(n=Math.ceil((this.height-i.height)/2))),(s||n)&&a.setAttributeNS(null,"transform","translate("+s+" "+n+")"),r.appendChild(a),a},shapeToSymbol:function(t){if(!t)return void alert(pergola.messages.noSuchShape);var e=[];e[0]={element:t.element};for(var i in t.geometry)e[0][i]=t.geometry[i];return e},message:function(t,e){var i=pergola.notification,o=i.messageGroup,s=16;t=t.split("\n"),pergola.removeChildren(i.messageGroup);for(var n in t)$C({element:"text",y:n*s,textNode:t[n],appendTo:o});e&&(i.x=e.x,i.y=e.y,i.container.setAttributeNS(null,"transform","translate("+i.x+" "+i.y+")")),i.open()},resize:function(){var t,e=pergola.width(),i=pergola.height(),o=pergola.background,s=pergola.Window.windows,n=pergola.taskbar;o&&(pergola.attribute(o.rect,{width:e,height:i}),pergola.attribute(o.image,{width:e,height:i})),pergola.attribute(pergola.dragarea.rect,{width:e,height:i});for(var r in s)t=s[r],t.isFull&&(t.width=t.fullW(),t.height=t.fullH(),t.setXYWH(t.container),t.doc.transformUpdate(),t.release());n&&(n.rect.setAttributeNS(null,"width",e),"bottom"==n.position&&n.container.setAttributeNS(null,"transform","translate("+n.x+" "+(n.y=i-n.height)+")"))},Timer:function(){var t,e;return{initialize:function(){pergola.extend(this,arguments[0]);var i="frequence"in this,o="delay"in this;return t=this,e=this.handle||this,e!=this&&(e.timerFunc=this.callback),i&&o?this.timeout=window.setTimeout(this.setInterval,this.delay):i?this.setInterval():this.timeout=window.setTimeout(function(){e.timerFunc(t)},this.delay),this},setInterval:function(){t.interval=window.setInterval(function(){e.timerFunc(t)},t.frequence)},clear:function(){this.timeout&&window.clearTimeout(this.timeout),this.interval&&window.clearInterval(this.interval),this.timeout=this.interval=null,this.destroy&&pergola.destroy(e,this.destroy)}}},Key:function(){},Undo:function(t){return this.max=t||pergola.undos,this.buffer=[],this.index=0,this},xhrGET:function(){var t=arguments[0],e=new XMLHttpRequest;t.mime&&e.overrideMimeType&&e.overrideMimeType(t.mime),e.open("GET",t.url,!0),e.onreadystatechange=function(){4==this.readyState&&this.status<300&&t.callback&&t.callback(e)},e.send(null)},xhrPOST:function(){var t=arguments[0],e=new XMLHttpRequest;t.mime&&e.overrideMimeType&&e.overrideMimeType(t.mime),e.open("POST",t.url,!0),e.onreadystatechange=function(){4==e.readyState&&200==this.status&&t.callback&&t.callback(e)},e.send(t.params)},saveJSON:function(t,e,i,o){pergola.xhrPOST({url:o||pergola.writeFile,mime:"application/x-www-form-urlencoded",params:"file="+t+"/"+e+".json&data="+JSON.stringify(i)})},saveSVG:function(t,e,i,o){pergola.xhrPOST({url:o||pergola.writeFile,mime:"application/x-www-form-urlencoded",params:"file="+t+"/"+e+".svg&data="+i})},loadSVG:function(){function t(t){for(var i=t;null!=i&&"svg"!=i.nodeName;)i=i.nextSibling;return null==i?(alert(pergola.messages.svgNotFound+e.url),null):(e.target.constructor==pergola.Window?(e.newdoc=i,e.target.doc.append(e)):e.target.appendChild(i),i)}var e=arguments[0];if(!e.url)return void alert(pergola.messages.missingURL);if(!e.target)return void alert(pergola.messages.missingTargetContainer);if(e.progress&&pergola.remote&&e.progress.start(),window.XMLHttpRequest){var i,o,s,n,r=new XMLHttpRequest;r.onreadystatechange=function(){if(pergola.remote&&3==r.readyState&&(i||(i=r.getResponseHeader("Content-Length")),e.progress&&e.progress.status.setAttribute("width",r.responseText.length*(e.progress.extent/i))),4==r.readyState){if(200==r.status)return window.DOMParser?(o=new DOMParser,s=o.parseFromString(r.responseText,"text/xml")):s=r.responseXML,n=t(document.importNode(s.documentElement,!0)),e.progress&&e.progress.stop(),n;if(0==r.status)try{return window.DOMParser?(o=new DOMParser,s=o.parseFromString(r.responseText,"text/xml")):s=r.responseXML,t(document.importNode(r.responseXML.documentElement,!0))}catch(a){alert(pergola.messages.noLocalLoading)}else 404==r.status&&(e.progress&&e.progress.stop(),alert(pergola.messages.file404))}};try{r.open("GET",e.url,!0),r.send(null)}catch(a){return e.progress&&e.progress.stop(),void alert(pergola.messages.loadingFail)}}else window.getURL&&getURL(e.url,function(i){return i.success?(n=t(parseXML(i.content,document).firstChild),e.progress&&e.progress.stop(),n):(e.progress&&e.progress.stop(),void alert(pergola.messages.loadingFail))})},xmlToJson:function(t){var e={};if(1==t.nodeType){if(t.attributes.length){e.attributes={};for(var i=0;i<t.attributes.length;i++){var o=t.attributes.item(i);e.attributes[o.nodeName]=o.value}}}else 3==t.nodeType&&(e=t.nodeValue);if(t.hasChildNodes())for(var s=0;s<t.childNodes.length;s++){var n=t.childNodes.item(s),r=n.nodeName;if("undefined"==typeof e[r])e[r]=pergola.xmlToJson(n);else{if("undefined"==typeof e[r].push){var a=e[r];e[r]=[],e[r].push(a)}e[r].push(pergola.xmlToJson(n))}}return e},jsonToXml:function(t,e){var i=function(t,e,o){var s="";if(t instanceof Array)for(var n=0,r=t.length;r>n;n++)s+=o+i(t[n],e,o+"	")+"\n";else if("object"==typeof t){var a=!1;s+=o+"<"+e;for(var l in t)"@"==l.charAt(0)?s+=" "+l.substr(1)+'="'+t[l].toString()+'"':a=!0;if(s+=a?">":"/>",a){for(var l in t)"#text"==l?s+=t[l]:"#cdata"==l?s+="<![CDATA["+t[l]+"]]>":"@"!=l.charAt(0)&&(s+=i(t[l],l,o+"	"));s+=("\n"==s.charAt(s.length-1)?o:"")+"</"+e+">"}}else s+=o+"<"+e+">"+t.toString()+"</"+e+">";return s},o="";for(var s in t)o+=i(t[s],s,"");return e?o.replace(/\t/g,e):o.replace(/\t|\n/g,"")},geo:{distance:function(t,e,i,o){var s=6378.1,n=(i-t).toRad(),r=(o-e).toRad(),a=Math.sin(n/2)*Math.sin(n/2)+Math.sin(r/2)*Math.sin(r/2)*Math.cos(t.toRad())*Math.cos(i.toRad()),l=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return s*l},kmToMi:function(t){return t/1.609344},kmToNmi:function(t){return t/1.852},formatMiles:function(t){var e,i,o=1760*t;return.25>t&&t>.1?(e=o%3,i=12*(e-parseInt(e)),parseInt(o)+" yd "+parseInt(e)+"′ "+parseInt(i)+"″"):.1>=t?(e=3*o,i=12*(e-parseInt(e)),parseInt(e)+"′ "+parseInt(i)+"″"):t.toFixed(3)+" mi"},formatKm:function(t){var e=1e3*t;return.5>t?e.toFixed(2)+" m":t.toFixed(3)+" Km"}},hexToDecimal:function(t){return parseInt(t,16)},decimalToHex:function(t){return t.toString(16)},toArray:function(t){var e=[];for(var i in t)e.push(t[i]);return e},propsToArray:function(t){var e=[];for(var i in t)e.push(i);return e},geom:{},color:{},getFiles:function(){var t=this,e=arguments[0],i=pergola.fileDialog;i||(i=pergola.lazyLoad.fileDialog()),i.update({title:e.title,ok:e.ok}),i.init({user:this,callback:e.callback}),pergola.xhrPOST({url:e.getDir||pergola.getDir,params:"folder="+[e.path],mime:"application/x-www-form-urlencoded",callback:function(o){i.comboBox.update(t[e.files]=JSON.parse(o.responseText))}})},find:function(t){pergola.findDialog||pergola.lazyLoad.findDialog(),pergola.findDialog.init({user:this,callback:t})},getColorpicker:function(t){pergola.colorpickerDialog||pergola.lazyLoad.colorpickerDialog(),pergola.colorpicker.init({user:this,color:t})},lazyLoad:{fileDialog:function(){return pergola.fileDialog=new pergola.Panel("Pergola File Dialog").build({title:" ",x:300,y:180,width:460,height:340,preemptive:!0,okButton:{text:"Save"},cancelButton:{text:"Cancel"},mousewheel:"scroll",layout:{type:"fileDialog"}})},findDialog:function(){return pergola.findDialog=new pergola.Panel("pergola Search Dialog").build({parent:pergola.preemptive,title:"FIND...",x:200,y:100,width:350,height:220,okButton:{text:"OK"},cancelButton:{text:"Cancel"},layout:{type:"findDialog"},preemptive:!0,getData:function(){if(!this.input.value)return!1;var t,e,i=this.input.value,o=this.caseCheckbox.checked,s=this.wholeWordsCheckbox.checked,n="";return t=s?"\b"+i+"\b":i,o||(n+="i"),e=new RegExp(t,n),{value:i,flags:n,wholeWord:s,regexp:e}}})},colorpickerDialog:function(){var t=pergola.colorpickerDialog=new pergola.Panel("pergola colorpicker dialog"),e=pergola.colorpicker=new pergola.ColorPicker,i="wide"==e.spectrum;pergola.extend(t,{parent:pergola.preemptive,title:"COLOR PICKER",preemptive:!0,x:150,y:80,width:500,height:412,okButton:{},cancelButton:{}}),i&&pergola.extend(t,{x:2,width:1552,height:580,okButton:{x:40,y:-120},cancelButton:{x:40,y:-60}}),t.build(),e.build({owner:t,parent:t.container})}}},$C=pergola.SVG,$H=pergola.HTML,$M=pergola.message,$D;container&&((pergola.container=document.getElementById(container))?pergola.doc=$C({element:"svg",width:svgWidth||"100%",height:svgHeight||"100%",appendTo:pergola.container}):alert('The HTML element with ID "'+container+'" was not found.')),pergola.defs=$C({element:"defs",id:"pergola_defs",appendTo:pergola.doc}),pergola.extend(pergola.geom,{intersectionPoint:function(t,e,i,o){var s=e.y-t.y,n=t.x-e.x,r=s*t.x+n*t.y,a=o.y-i.y,l=i.x-o.x,h=a*i.x+l*i.y,p=s*l-a*n;return 0!=p?{x:(l*r-n*h)/p,y:(s*h-a*r)/p}:!1},intersect:function(t,e,i,o){var s=(o.x-i.x)*(t.y-i.y)-(o.y-i.y)*(t.x-i.x),n=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),r=(o.y-i.y)*(e.x-t.x)-(o.x-i.x)*(e.y-t.y);if(0!=r){var a=s/r,l=n/r;if(a>=0&&1>=a&&l>=0&&1>=l)return!0}return!1},pointBetween:function(t,e,i){var o=t>=e?t:e,s=t!=o?t:e;return o>=i&&i>=s},pointOnLine:function(t,e,i){if(i.x.trim(6)-e.x.trim(6)==0)return pergola.geom.pointBetween(e.y,i.y,t.y)&&t.x.trim(6)==e.x.trim(6)?!0:!1;if(i.y.trim(6)-e.y.trim(6)==0)return pergola.geom.pointBetween(e.x,i.x,t.x)&&t.y.trim(6)==e.y.trim(6)?!0:!1;var o=(t.x-e.x)/(i.x-e.x),s=(t.y-e.y)/(i.y-e.y);return Math.abs(o-s)<1e-6&&o>=0&&1>=o},getPDistance:function(t,e,i,o,s,n){var r,a,l,h,p=t-i,d=e-o,c=s-i,u=n-o,m=p*c+d*u,g=c*c+u*u,f=m/g;return 0>f||i==s&&o==n?(r=i,a=o):f>1?(r=s,a=n):(r=i+f*c,a=o+f*u),l=t-r,h=e-a,Math.sqrt(l*l+h*h)},getPPoint:function(t,e){var i=e.x1,o=e.y1,s=e.x2,n=e.y2,r=s-i,a=n-o,l=r*r+a*a,h=((t.x-i)*r+(t.y-o)*a)/l;return{x:i+h*r,y:o+h*a}},getP2Pdistance:function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},centroid:function(t,e){for(var i,o,s,n=t.length,r=0,a=0,l=n-1,h=0;n>h;l=h++)o=t[h],s=t[l],i=o.x*s.y-s.x*o.y,r+=(o.x+s.x)*i,a+=(o.y+s.y)*i;return i=6*e,{x:Math.abs(r/i),y:Math.abs(a/i)}},crossProduct:function(t,e){return t.x*e.y-e.x*t.y},angle:{degrees:function(t,e){var i=e.y-t.y,o=e.x-t.x;return 180*Math.atan2(i,o)/Math.PI},radians:function(t,e){return Math.atan2(t,e)+Math.PI/2},toDegrees:function(t){return 180*Number(t)/Math.PI},toRadians:function(t){return Number(t)*Math.PI/180},angleBetween2Lines:function(t,e){var i=Math.atan2(t.y1-t.y2,t.x1-t.x2),o=Math.atan2(e.y1-e.y2,e.x1-e.x2);return i-o},constrain:function(t,e){function i(){for(var i=0;e/2>i;i++)if(t>=o&&t<=(o+=2*s))return!0}var o=0,e=e||16,s=180/e;return t>=o-s&&t<=(o+=s)?0:i()?o-s:t>=(o=180-s)||t<=(o*=-1)?180:i()?o-s:void 0}},area:{triangle:function(t){var e=t[0],i=t[1],o=t[2],s=(e+i+o)/2;return Math.sqrt(s*(s-e)*(s-i)*(s-o))},polygon:function(t,e,i){var o,s=0,n=i-1;for(o=0;i>o;n=o++)s+=(t[n]+t[o])*(e[n]-e[o]);return s/2}}}),pergola.extend(pergola.color,{rgbTablePopulate:{basic:function(){var t,e,i,o,s=pergola.color.rgbTable=[],n=255,r=0,a=42,l=43,h=a+l,p=h<<1,d=Math.round;for(o=0;n+1>o;o++){for(t=(n-o)/n*6,i=0,e=l;e>i;i++)s[r++]=[n,o+d(i*t),o];for(e+=l;e>i;i++)s[r++]=[o+d((h-i)*t),n,o];for(e+=a;e>i;i++)s[r++]=[o,n,o+d((i-h)*t)];for(e+=l;e>i;i++)s[r++]=[o,o+d((p-i)*t),n];for(e+=a;e>i;i++)s[r++]=[o+d((i-p)*t),o,n];for(e+=l;e>i;i++)s[r++]=[n,o,o+d((n-i)*t)]}},extended:function(){var t,e,i,o=pergola.color.rgbTable=[],s=255,n=s+1,r=0,a=Math.round;for(i=0;n>i;i++){for(t=(s-i)/s,e=0;n>e;e++)o[r++]=[s,i+a(e*t),i];for(e=0;n>e;e++)o[r++]=[i+a((s-e)*t),s,i];for(e=0;n>e;e++)o[r++]=[i,s,i+a(e*t)];for(e=0;n>e;e++)o[r++]=[i,i+a((s-e)*t),s];for(e=0;n>e;e++)o[r++]=[i+a(e*t),i,s];for(e=0;n>e;e++)o[r++]=[s,i,i+a((s-e)*t)]}}},convert:function(t,e){var i,o,s,n,r=!1,a=pergola.color.rgbToHex;for(n in pergola.color.keywordNames)if(t==n){t=pergola.color.keywordNames[n],r=!0;break}if(!r)for(n in pergola.customColorNames)if(t==n){t=pergola.customColorNames[n];break}if("#"==t.charAt(0))t=pergola.color.hexToRGB(t),i=t[0],o=t[1],s=t[2];else if(-1!=t.indexOf("rgb"))-1!=t.indexOf("%")?(t=t.slice(4,t.length-1).split(","),i=Math.round(2.55*parseInt(t[0])),o=Math.round(2.55*parseInt(t[1])),s=Math.round(2.55*parseInt(t[2]))):(t=t.slice(4,t.length-1).split(","),i=Number(t[0]),o=Number(t[1]),s=Number(t[2]));else{if(-1==t.indexOf("hsl"))return alert(pergola.messages.wrongColorFormat),[0,0,0];t=t.slice(4,t.length-1).split(","),t=pergola.color.hslToRgb(parseInt(t[0]),parseInt(t[1]),parseInt(t[2])),i=t[0],o=t[1],s=t[2]}return e?"rgb"==e?"rgb("+i+" "+o+" "+s+" )":"hex"==e?"#"+a(i)+a(o)+a(s):void 0:[i,o,s]},hslToRgb:function(t,e,i){t/=360,e/=100,i/=100;var o,s,n,r=Math.floor(6*t),a=6*t-r,l=i*(1-e),h=i*(1-a*e),p=i*(1-(1-a)*e);switch(r%6){case 0:o=i,s=p,n=l;break;case 1:o=h,s=i,n=l;break;case 2:o=l,s=i,n=p;break;case 3:o=l,s=h,n=i;break;case 4:o=p,s=l,n=i;break;case 5:o=i,s=l,n=h}return[Math.floor(255*o),Math.floor(255*s),Math.floor(255*n)]},hexToRGB:function(t){var e=parseInt("0x"+t.substring(1,3)),i=parseInt("0x"+t.substring(3,5)),o=parseInt("0x"+t.substring(5,7));return[e,i,o]},rgbToHex:function(t){var e=t.toString(16);return e.length>2&&(e="FF"),1==e.length&&(e="0"+e),e},lab:function(){var t=arguments[0],e=t[0],i=t[1],o=t[2];pergola.color.neutral=e==i&&e==o,pergola.color.themeLuminosity=pergola.color.luminosity(e,i,o),pergola.color.components={r:e,g:i,b:o},pergola.color.ingredients=pergola.toArray(pergola.color.components).sort(function(t,e){return e-t})},luminosity:function(t,e,i){return Math.round((t+e+i)/3)},shade:function(t,e){var i,o,s,n,r,a,l="#",h=pergola.color.components,p=pergola.color.ingredients;if(pergola.color.neutral)for(i=t[1],o=0;o<t.length;o++)t[o]=i;if(e){if("number"==typeof t)for(i=pergola.color.themeLuminosity,o=0;3>o;o++)s=i*(t/100),s>255&&(s=255),n=0>e?i/100*e:(255-s)/100*e,0>s+n&&(n=-s),l+=pergola.color.rgbToHex(Math.round(s+n)).toUpperCase();else for(r in h)for(a in p)if(h[r]==p[a]){s=h[r]*(t[a]/100),s>255&&(s=255),n=0>e?h[r]/100*e:(255-s)/100*e,0>s+n&&(n=-s),l+=pergola.color.rgbToHex(Math.round(s+n)).toUpperCase();break}}else for(r in h)for(a in p)if(h[r]==p[a]){l+=pergola.color.rgbToHex(Math.round(h[r]*(t[a]/100))).toUpperCase();break}return l},keywordNames:{aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",aqua:"rgb(0, 255, 255)",aquamarine:"rgb(127, 255, 212)",azure:"rgb(240, 255, 255)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",black:"rgb( 0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb( 0, 0, 255)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",burlywood:"rgb(222, 184, 135)",cadetblue:"rgb( 95, 158, 160)",chartreuse:"rgb(127, 255, 0)",chocolate:"rgb(210, 105, 30)",coral:"rgb(255, 127, 80)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",crimson:"rgb(220, 20, 60)",cyan:"rgb( 0, 255, 255)",darkblue:"rgb( 0, 0, 139)",darkcyan:"rgb( 0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb( 0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb( 85, 107, 47)",darkorange:"rgb(255, 140, 0)",darkorchid:"rgb(153, 50, 204)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkslateblue:"rgb( 72, 61, 139)",darkslategray:"rgb( 47, 79, 79)",darkslategrey:"rgb( 47, 79, 79)",darkturquoise:"rgb( 0, 206, 209)",darkviolet:"rgb(148, 0, 211)",deeppink:"rgb(255, 20, 147)",deepskyblue:"rgb( 0, 191, 255)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb( 30, 144, 255)",firebrick:"rgb(178, 34, 34)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb( 34, 139, 34)",fuchsia:"rgb(255, 0, 255)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",goldenrod:"rgb(218, 165, 32)",gray:"rgb(128, 128, 128)",grey:"rgb(128, 128, 128)",green:"rgb( 0, 128, 0)",greenyellow:"rgb(173, 255, 47)",honeydew:"rgb(240, 255, 240)",hotpink:"rgb(255, 105, 180)",indianred:"rgb(205, 92, 92)",indigo:"rgb( 75, 0, 130)",ivory:"rgb(255, 255, 240)",khaki:"rgb(240, 230, 140)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lightblue:"rgb(173, 216, 230)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightsalmon:"rgb(255, 160, 122)",lightseagreen:"rgb( 32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightyellow:"rgb(255, 255, 224)",lime:"rgb( 0, 255, 0)",limegreen:"rgb( 50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",maroon:"rgb(128, 0, 0)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb( 0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumpurple:"rgb(147, 112, 219)",mediumseagreen:"rgb( 60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb( 0, 250, 154)",mediumturquoise:"rgb( 72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb( 25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navy:"rgb( 0, 0, 128)",oldlace:"rgb(253, 245, 230)",olive:"rgb(128, 128, 0)",olivedrab:"rgb(107, 142, 35)",orange:"rgb(255, 165, 0)",orangered:"rgb(255, 69, 0)",orchid:"rgb(218, 112, 214)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",paleturquoise:"rgb(175, 238, 238)",palevioletred:"rgb(219, 112, 147)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",plum:"rgb(221, 160, 221)",powderblue:"rgb(176, 224, 230)",purple:"rgb(128, 0, 128)",red:"rgb(255, 0, 0)",rosybrown:"rgb(188, 143, 143)",royalblue:"rgb( 65, 105, 225)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb( 46, 139, 87)",seashell:"rgb(255, 245, 238)",sienna:"rgb(160, 82, 45)",silver:"rgb(192, 192, 192)",skyblue:"rgb(135, 206, 235)",slateblue:"rgb(106, 90, 205)",slategray:"rgb(112, 128, 144)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",springgreen:"rgb( 0, 255, 127)",steelblue:"rgb( 70, 130, 180)",tan:"rgb(210, 180, 140)",teal:"rgb( 0, 128, 128)",thistle:"rgb(216, 191, 216)",tomato:"rgb(255, 99, 71)",turquoise:"rgb( 64, 224, 208)",violet:"rgb(238, 130, 238)",wheat:"rgb(245, 222, 179)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellowgreen:"rgb(154, 205, 50)"}}),pergola.extend(Number.prototype,{evenToOdd:function(){return this-(this%parseInt(this/2)==0)|0},oddToEven:function(){return this-this%parseInt(this/2)},isEven:function(){return this%2==0},isInteger:function(){return this%1===0},trim:function(t){return t=t||pergola.decimals,parseFloat(this.toFixed(t))},toRad:function(){return this*Math.PI/180},toDeg:function(){return 180*this/Math.PI}}),pergola.extend(String.prototype,{xmlNameStartChar:/^["-""."0-9\u00B7\u0300-\u036F\u203F-\u2040]/,xmlNameChar:/[^A-Za-z":""_"\u002D\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u10000-\uEFFFF]/g,toXML:function(){return this.replace(this.xmlNameStartChar,"_").replace(this.xmlNameChar,"_")},xmlNameGenerator:function(){function t(){return e=Math.random().toString(16).toUpperCase(),"XML_"+e.substring(e.indexOf(".")+1)}for(var e,i=pergola.xmlName;;)if(!i.exist(e=t()))return i.add(this+e)},unformatNumber:function(t){t=t||".";var e=new RegExp("[^0-9-"+t+"]",["g"]);return parseFloat(this.replace(/\((.*)\)/,"-$1").replace(e,"").replace(t,"."))},width:function(t,e,i,o,s){var n,r,a=pergola.Class.prototype;return t=t||a["font-size"],e=e||a["font-family"],i=i||"normal",o=o||"normal",s=s||"auto",n=$C({element:"text","font-size":t,"font-family":e,"font-weight":i,"letter-spacing":o,kerning:s,textNode:this,appendTo:pergola.doc}),r=Math.round(n.getBBox().width),pergola.doc.removeChild(n),r},height:function(t,e){var i,o,s=pergola.Class.prototype;return t=t||s["font-size"],e=e||s["font-family"],i=$C({element:"text","font-size":t,"font-family":e,textNode:this,appendTo:pergola.doc}),o=Math.round(i.getBBox().height),pergola.doc.removeChild(i),o},truncate:function(t){return this.substring(0,this.length-t)},truncateWithDots:function(t,e,i,o,s,n){var r,a=pergola.Class.prototype,l=this;for(e=e||a["font-size"],i=i||a["font-family"],o=o||"normal",s=s||"normal",n=n||"auto",r=this.width(e,i,o,s,n);r>t;)l=l.truncate(4)+"...",r=l.width(e,i,o,s,n);return l},centerVertical:function(t,e,i){var o,s=pergola.Class.prototype;return e=e||s["font-size"],i=i||s["font-family"],o=this.height(e,i),(t+o)/2-e/6},brighten:function(t){var e=pergola.color.rgbToHex,i=pergola.color.convert(this);return i?(t=(t||.5)+1,"#"+e(Math.round(i[0]*t))+e(Math.round(i[1]*t))+e(Math.round(i[2]*t))):this},darken:function(t){var e=pergola.color.rgbToHex,i=pergola.color.convert(this);return i?(t=t||.5,"#"+e(Math.round(i[0]*t))+e(Math.round(i[1]*t))+e(Math.round(i[2]*t))):this}}),pergola.radixChar={sq:",","sq-AL":",",ar:".","ar-BH":".","ar-EG":".","ar-JO":".","ar-KW":".","ar-LB":".","ar-QA":".","ar-SA":".","ar-AE":".",hy:",","hy-AM":",","az-AZ":",",eu:",","eu-ES":",","be-BY":",","bn-BD":".",bs:",","bs-BA":",",bg:",","bg-BG":",",ca:",","ca-ES-EURO":",","ca-ES":",",zh:".","zh-CN-PINYIN":".","zh-CN-STROKE":".","zh-CN":".","zh-HK-STROKE":".","zh-HK":".","zh-MO":".","zh-SG":".","zh-TW-STROKE":".","zh-TW":".",hr:",","hr-HR":",",cs:",","cs-CZ":",",da:",","da-DK":",",nl:",","nl-BE":",","nl-NL":",","nl-SR":",","en-AU":".","en-BB":".","en-BM":".","en-CA":".","en-GH":".","en-IN":".","en-ID":".","en-IE-EURO":".","en-IE":".","en-MY":".","en-NZ":".","en-NG":".","en-PK":".","en-PH":".","en-SG":".","en-ZA":".","en-GB":".","en-US":".",et:",","et-EE":",",fi:",","fi-FI-EURO":",","fi-FI":",",fr:",","fr-BE":",","fr-CA":",","fr-FR-EURO":",","fr-FR":",","fr-LU":",","fr-MC":",","fr-CH":".",ka:",","ka-GE":",",de:",","de-AT-EURO":",","de-AT":",","de-DE-EURO":",","de-DE":",","de-LU-EURO":",","de-LU":",","de-CH":".",el:",","el-GR":",",iw:".","iw-IL":".",hi:".","hi-IN":".",hu:",","hu-HU":",",is:",","is-IS":",","in":",","in-ID":",",ga:".","ga-IE":".",it:",","it-IT":",","it-CH":".",ja:".","ja-JP":".","kk-KZ":",","km-KH":",","ky-KG":".",ko:".","ko-KR":".",lv:",","lv-LV":",",lt:",","lt-LT":",",lb:".","lb-LU":".",mk:",","mk-MK":",",ms:".","ms-BN":",","ms-MY":".",mt:".","mt-MT":".","sh-ME":",",no:",","no-NO":",",pl:",","pl-PL":",",pt:",","pt-AO":",","pt-BR":",","pt-PT":",",ro:",","ro-MD":",","ro-RO":",",rm:".","rm-CH":".",ru:",","ru-RU":",",sr:",","sr-BA":",",sh:",","sh-BA":",","sh-CS":",","sr-CS":",",sk:",","sk-SK":",",sl:",","sl-SI":",",es:",","es-AR":",","es-BO":",","es-CL":",","es-CO":",","es-CR":".","es-DO":".","es-EC":",","es-SV":".","es-GT":".","es-HN":".","es-MX":".","es-PA":".","es-PY":",","es-PE":",","es-PR":".","es-ES-EURO":",","es-ES":",","es-UY":",","es-VE":",",sv:",","sv-SE":",",tl:".","tl-PH":".","tg-TJ":".",th:".","th-TH":".",tr:",","tr-TR":",",uk:",","uk-UA":",",ur:".","ur-PK":".",vi:",","vi-VN":",",cy:".","cy-GB":"."},pergola["debugger"]=function(){var t,e,i,o=pergola["debugger"],s=20*("boolean"==typeof debug)||debug;o.toggleOn=function(){t.setAttributeNS(null,"display","none"),e.setAttributeNS(null,"display","block")},o.toggleOff=function(){e.setAttributeNS(null,"display","none"),t.setAttributeNS(null,"display","block")},o.vars=function(t){var e,i=[],n=0;for(e in t)i.push(e);if(i.length>s)return void alert(pergola.messages.debuggerLines[0]+s+pergola.messages.debuggerLines[1]);for(e in t)o["var"+n++].firstChild.data=void 0==t[e]?e+" is undefined":e+" = "+t[e]},i=pergola.debug=$C({element:"g",id:"debugger",transform:"translate(0 54)",appendTo:pergola.systemComponents}),t=$C({element:"g",appendTo:i}),t.addEventListener("click",o.toggleOn,!1),$C({element:"circle",cx:4,cy:-6,r:12,fill:"#FFFFFF",stroke:"#505090","stroke-width":4,appendTo:t}),$C({element:"text","font-size":16,"font-weight":"bold",fill:"firebrick","pointer-events":"none",textNode:"D",appendTo:t}),e=$C({element:"g",fill:"firebrick",display:"none",appendTo:i}),e.addEventListener("click",o.toggleOff,!1),$C({element:"rect",x:2,y:-20,rx:4,width:360,height:20*s+40,fill:"#F3F3F0",stroke:"gray","stroke-width":4,opacity:.4,"pointer-events":"none",appendTo:e}),$C({element:"circle",cx:16,cy:-6.5,r:7,fill:"#505090",appendTo:e}),$C({element:"path",d:"M11.5 -6.5h9",stroke:"#FFFFFF","pointer-events":"none",appendTo:e}),$C({element:"text",x:180,"font-family":"Arial","font-size":14,"text-anchor":"middle","pointer-events":"none",textNode:"MINI DEBUGGER",appendTo:e}),i=$C({element:"g",transform:"translate(10 20)","font-family":"'Courier New'","font-size":"10pt","font-weight":"bold","pointer-events":"none",appendTo:e});for(var n=0;s>n;n++)o["var"+n]=$C({element:"text",y:20*n,textNode:" ",appendTo:i});$D=o.vars},pergola.filter={blur:function(t){t=pergola.extend({x:-.5,y:-.5,stdDeviation:2,dx:3.2,dy:3.2,"flood-color":"#000000","flood-opacity":.4},t);var e,i=("blur"+(t.x=parseFloat(t.x)+"%")+(t.y=parseFloat(t.y)+"%")+t.stdDeviation+t.dx+t.dy+t["flood-color"]+t["flood-opacity"]).toXML();return document.getElementById(i)||(e=$C({element:"filter",id:i,x:t.x,y:t.y,appendTo:pergola.defs}),$C({element:"feGaussianBlur",stdDeviation:t.stdDeviation,appendTo:e}),$C({element:"feOffset",result:"offsetBlur",dx:t.dx,dy:t.dy,appendTo:e}),$C({element:"feFlood","flood-color":t["flood-color"],"flood-opacity":t["flood-opacity"],appendTo:e}),$C({element:"feComposite",in2:"offsetBlur",result:"shadow",operator:"in",appendTo:e}),$C({element:"feComposite","in":"SourceGraphic",in2:"shadow",appendTo:e})),"url(#"+i+")"},specular:function(t){t=pergola.extend({x:0,y:0,stdDeviation:2.5,dx:0,dy:0,"lighting-color":"aliceblue",surfaceScale:5,specularExponent:1,specularConstant:1.1,fePointLight:{x:-1e4,y:-1e4,z:-5e3}},t);var e,i,o=("specular"+(t.x=parseFloat(t.x)+"%")+(t.y=parseFloat(t.y)+"%")+t.stdDeviation+t.dx+t.dy+t["lighting-color"]+t.surfaceScale+t.specularExponent+t.specularConstant+t.fePointLight.x+t.fePointLight.y+t.fePointLight.z).toXML();return document.getElementById(o)||(e=$C({element:"filter",id:o,x:t.x,y:t.y,width:"100%",height:"100%",appendTo:pergola.defs}),$C({element:"feGaussianBlur","in":"SourceAlpha",stdDeviation:t.stdDeviation,result:"blurredAlpha",appendTo:e}),$C({element:"feOffset","in":"blurredAlpha",dx:t.dx,dy:t.dy,result:"offsetBlur",appendTo:e}),i=$C({element:"feSpecularLighting","lighting-color":t["lighting-color"],surfaceScale:t.surfaceScale,specularExponent:t.specularExponent,specularConstant:t.specularConstant,appendTo:e}),$C({element:"fePointLight",x:t.fePointLight.x,y:t.fePointLight.y,z:t.fePointLight.z,appendTo:i}),i=$C({element:"feMerge",appendTo:e}),$C({element:"feMergeNode","in":"offsetBlur",appendTo:i}),$C({element:"feMergeNode","in":"litPaint",appendTo:i})),"url(#"+o+")"
},noise:function(t){t=pergola.extend({x:0,y:0,baseFrequency:".5 .5",numOctaves:8,seed:0,values:"1 0 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0 0 0 1",tableValues:{R:".15 0",G:".015 0",B:"0 0"}},t);var e,i,o=("noise"+(t.x=parseFloat(t.x)+"%")+(t.y=parseFloat(t.y)+"%")+t.baseFrequency+t.numOctaves+t.seed+t.values+t.tableValues.R+t.tableValues.G+t.tableValues.B).toXML();return document.getElementById(o)||(e=$C({element:"filter",id:o,x:t.x,y:t.y,width:"100%",height:"100%",appendTo:pergola.defs}),$C({element:"feTurbulence",type:"fractalNoise",baseFrequency:t.baseFrequency,numOctaves:t.numOctaves,seed:t.seed,stitchTiles:"noStitch",appendTo:e}),$C({element:"feColorMatrix",type:"matrix",values:t.values,appendTo:e}),i=$C({element:"feComponentTransfer",appendTo:e}),$C({element:"feFuncR",type:"table",tableValues:t.tableValues.R,appendTo:i}),$C({element:"feFuncG",type:"table",tableValues:t.tableValues.G,appendTo:i}),$C({element:"feFuncB",type:"table",tableValues:t.tableValues.B,appendTo:i})),"url(#"+o+")"},turbulence:function(t){t=pergola.extend({x:0,y:0,baseFrequency:".5 .5",numOctaves:8,seed:0,values:"1 0 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0 0 0 1",tableValues:{R:".5 0",G:".5 0",B:".5 0"}},t);var e,i,o=("turbulence"+(t.x=parseFloat(t.x)+"%")+(t.y=parseFloat(t.y)+"%")+t.baseFrequency+t.numOctaves+t.seed+t.values+t.tableValues.R+t.tableValues.G+t.tableValues.B).toXML();return document.getElementById(o)||(e=$C({element:"filter",id:o,x:t.x,y:t.y,width:"100%",height:"100%",appendTo:pergola.defs}),$C({element:"feTurbulence",type:"turbulence",baseFrequency:t.baseFrequency,numOctaves:t.numOctaves,seed:t.seed,stitchTiles:"noStitch",appendTo:e}),$C({element:"feColorMatrix",type:"matrix",values:t.values,appendTo:e}),i=$C({element:"feComponentTransfer",appendTo:e}),$C({element:"feFuncR",type:"table",tableValues:t.tableValues.R,appendTo:i}),$C({element:"feFuncG",type:"table",tableValues:t.tableValues.G,appendTo:i}),$C({element:"feFuncB",type:"table",tableValues:t.tableValues.B,appendTo:i})),"url(#"+o+")"}},pergola.marker={arrow1:function(){var t="arrow1_pMarker";return document.getElementById(t)||$C({element:"marker",id:t,viewBox:"0 0 10 10",refX:0,refY:5,orient:"auto",appendTo:pergola.defs}).appendChild($C({element:"path",d:"M0,0L10,5L0,10z",fill:"#000000",stroke:"none"})),"url(#"+t+")"},dot:function(t){var t=t||{},e=t.radius||4,i=t.fill||"red",o=t.stroke||"none",s="none"!=o,n="dot"+e+i+o+"_pMarker";return document.getElementById(n)||$C({element:"marker",id:n,viewBox:-.5*s+" "+-.5*s+" "+(12+s)+" "+(12+s),refX:6,refY:6,markerWidth:e,markerHeight:e,orient:"auto",appendTo:pergola.defs}).appendChild($C({element:"circle",cx:6,cy:6,r:6,fill:i,stroke:o,"stroke-width":1})),"url(#"+n+")"},terminalStart:function(){var t="terminalStart_pMarker";return document.getElementById(t)||$C({element:"marker",id:t,viewBox:"0 0 6 22",refX:2,refY:11,markerUnits:"userSpaceOnUse",markerWidth:6,markerHeight:22,orient:"auto",appendTo:pergola.defs}).appendChild($C({element:"path",d:"M0,0h2v8l4,3l-4,3v8h-2z",fill:"#404040",stroke:"none"})),"url(#"+t+")"},terminalEnd:function(){var t="terminalEnd_pMarker";return document.getElementById(t)||$C({element:"marker",id:t,viewBox:"0 0 5 22",refX:0,refY:11,markerUnits:"userSpaceOnUse",markerWidth:5,markerHeight:22,orient:"auto",appendTo:pergola.defs}).appendChild($C({element:"path",d:"M1,0v22M4,0v22",fill:"none",stroke:"#404040","stroke-width":2})),"url(#"+t+")"},chevron:function(){var t="chevron_pMarker";return document.getElementById(t)||$C({element:"marker",id:t,viewBox:"0 0 9 15",refX:0,refY:7.5,markerWidth:5,markerHeight:5,orient:"auto",appendTo:pergola.defs}).appendChild($C({element:"path",d:"M1.5,1.5l6,6l-6,6",fill:"none",stroke:"#002068","stroke-width":3,"stroke-linecap":"round","stroke-linejoin":"round"})),"url(#"+t+")"},chevronDbl:function(){var t="chevronDbl_pMarker";return document.getElementById(t)||$C({element:"marker",id:t,viewBox:"0 0 15.5 15",refX:0,refY:7.5,markerWidth:5,markerHeight:5,orient:"auto",appendTo:pergola.defs}).appendChild($C({element:"path",d:"M1.5,1.5l6,6l-6,6 M8,1.5l6,6l-6,6",fill:"none",stroke:"#002068","stroke-width":3,"stroke-linecap":"round","stroke-linejoin":"round"})),"url(#"+t+")"},secant:function(){var t="secant_pMarker";return document.getElementById(t)||$C({element:"marker",id:t,viewBox:"0 0 12 24",refX:6,refY:12,markerUnits:"userSpaceOnUse",markerWidth:12,markerHeight:24,orient:"auto",appendTo:pergola.defs}).appendChild($C({element:"path",d:"M11.5,0L.5,24",fill:"none",stroke:"red","stroke-width":1})),"url(#"+t+")"},verticalBarDbl:function(){var t="verticalBarDbl_pMarker";return document.getElementById(t)||$C({element:"marker",id:t,viewBox:"0 0 8 24",refX:4,refY:12,markerUnits:"userSpaceOnUse",markerWidth:8,markerHeight:24,orient:"auto",appendTo:pergola.defs}).appendChild($C({element:"path",d:"M1,0v24 M6,0v24",fill:"none",stroke:"red","stroke-width":2})),"url(#"+t+")"},intersect:function(){var t="intersect_pMarker";return document.getElementById(t)||$C({element:"marker",id:t,viewBox:"0 0 12 12",refX:6,refY:6,markerUnits:"userSpaceOnUse",markerWidth:12,markerHeight:12,appendTo:pergola.defs}).appendChild($C({element:"path",d:"M12,0L0,12 M0,0L12,12",fill:"none",stroke:"brown","stroke-width":.25})),"url(#"+t+")"},cross:function(){var t="cross_pMarker";return document.getElementById(t)||$C({element:"marker",id:t,viewBox:"0 0 12 12",refX:6,refY:6,markerUnits:"userSpaceOnUse",markerWidth:12,markerHeight:12,appendTo:pergola.defs}).appendChild($C({element:"path",d:"M12,0L0,12 M0,0L12,12",fill:"none",stroke:"red","stroke-width":1.25})),"url(#"+t+")"},arrowBaseArc:function(){var t="arrowBaseArc_pMarker";return document.getElementById(t)||$C({element:"marker",id:t,viewBox:"0 0 20 12",refX:8,refY:6,markerWidth:8,markerHeight:8,orient:"auto",appendTo:pergola.defs}).appendChild($C({element:"path",d:"M0,0c0,0 8,6 0,12 l20,-6z",fill:"#B03030",stroke:"none"})),"url(#"+t+")"},arrowBaseArcSmall:function(){var t="arrowBaseArc_pMarker";return document.getElementById(t)||$C({element:"marker",id:t,viewBox:"0 0 20 12",refX:8,refY:6,markerWidth:8,markerHeight:8,orient:"auto",appendTo:pergola.defs}).appendChild($C({element:"path",d:"M0,0c0,0 8,6 0,12 l20,-6z",fill:"#303030",stroke:"none"})),"url(#"+t+")"},arrowBaseArrow:function(){var t="arrowBaseArrow_pMarker";return document.getElementById(t)||$C({element:"marker",id:t,viewBox:"0 0 18 12",refX:9,refY:6,markerWidth:8,markerHeight:8,orient:"auto",appendTo:pergola.defs}).appendChild($C({element:"path",d:"M0,0l6,6l-6,6l18,-6z",fill:"#208020",stroke:"none"})),"url(#"+t+")"},bullseye:function(){var t="bullseye_pMarker";if(!document.getElementById(t)){var e=$C({element:"marker",id:t,viewBox:"0 0 40 40",refX:20,refY:20,markerWidth:5,markerHeight:5,appendTo:pergola.defs});$C({element:"circle",cx:20,cy:20,r:16,fill:"none",stroke:"#3E3E3E","stroke-width":2,appendTo:e}),$C({element:"circle",cx:20,cy:20,r:11.5,fill:"none",stroke:"#3E3E3E","stroke-width":2,appendTo:e}),$C({element:"path",d:"M0,20.5h8M20.5,0v8M32,20.5h8M20.5,32v8",fill:"none",stroke:"#000000","stroke-width":1,appendTo:e})}return"url(#"+t+")"},marker:function(){var t="marker_pMarker";if(!document.getElementById(t)){var e=$C({element:"marker",id:t,viewBox:"0 0 38.5 64.5",refX:0,refY:64,markerUnits:"userSpaceOnUse",markerWidth:38,markerHeight:64,appendTo:pergola.defs});$C({element:"path",d:"M28.47,2.67c0,0,0.69-1.28,1.09-2.02c0.57-1.06,9.43,3.88,8.91,4.84c-0.4,0.74-1.09,2.02-1.09,2.02L28.47,2.67z",fill:"url(#marker1)",stroke:"#000000","stroke-width":.25,appendTo:e}),$C({element:"path",d:"M28.4,2.63c0,0-1.7-0.46-2.36,0.75L5.04,42.25l12.28,6.67l20.95-38.76c0.71-1.46-0.88-2.67-0.88-2.67L28.4,2.63z",fill:"url(#marker2)",stroke:"#000000","stroke-width":.25,appendTo:e}),$C({element:"path",d:"M4.98,42.37l-2.75,5.1l12.28,6.67l2.81-5.2",fill:"url(#marker3)",stroke:"#000000","stroke-width":.25,appendTo:e}),$C({element:"path",d:"M2.81,47.9l-0.9,1.75l10.78,5.85l1-1.84",fill:"url(#marker3)",stroke:"#000000","stroke-width":.25,appendTo:e}),$C({element:"path",d:"M1.85,49.71l1.27,5.79l3.85,2.1l5.74-2.03",fill:"url(#marker3)",stroke:"#000000","stroke-width":.25,appendTo:e}),$C({element:"path",d:"M3.1,55.62L0.8,59.86l3.76,2.04l2.29-4.31",fill:"url(#marker3)",stroke:"#000000","stroke-width":.25,appendTo:e}),$C({element:"path",d:"M1.37,60.33c0,0-1.48,3.61-0.57,4.11c1.01,0.55,3.07-2.77,3.07-2.77",fill:"#554400",stroke:"#000000","stroke-width":1,appendTo:e})}return"url(#"+t+")"}},pergola.pattern={catseye:function(t){var e,i;return t=pergola.extend({colors:["#E08000","#F0A000"],size:5,opacity:1,transform:""},t),document.getElementById(e=pergola.pattern.id("catseye_pPattern_",t))||(i=$C({element:"pattern",id:e,width:t.size,height:t.size,patternUnits:"userSpaceOnUse",patternTransform:t.transform,appendTo:pergola.defs}),$C({element:"rect",width:t.size,height:t.size,fill:t.colors[0],appendTo:i}),$C({element:"path",d:"M 0,"+t.size+"h"+t.size+"v-"+t.size,fill:t.colors[1],opacity:t.opacity,appendTo:i})),"url(#"+e+")"},pirelli:function(t){var e,i;return t=pergola.extend({colors:["#507060","#608070"],size:6,opacity:1,transform:""},t),document.getElementById(e=pergola.pattern.id("pirelli_pPattern_",t))||(i=$C({element:"pattern",id:e,width:t.size,height:t.size,patternUnits:"userSpaceOnUse",patternTransform:t.transform,appendTo:pergola.defs}),$C({element:"rect",width:t.size,height:t.size,fill:t.colors[0],appendTo:i}),$C({element:"circle",cx:t.size/2,cy:t.size/2,r:t.size/2-1,fill:t.colors[1],opacity:t.opacity,appendTo:i})),"url(#"+e+")"},line:function(t){var e,i;return t=pergola.extend({colors:["black"],size:1,spacing:1,width:8,opacity:1,transform:""},t),t.height=t.spacing+t.size,document.getElementById(e=pergola.pattern.id("line_pPattern_",t))||(i=$C({element:"pattern",id:e,width:t.width,height:t.height,patternUnits:"userSpaceOnUse",patternTransform:t.transform,appendTo:pergola.defs}),$C({element:"line",y1:t.height/2-.5,x2:8,y2:t.height/2-.5,stroke:t.colors[0],"stroke-width":t.size,opacity:t.opacity,appendTo:i})),"url(#"+e+")"},grid:function(t){var e,i;return t=pergola.extend({colors:["#D8D8D8"],size:1,spacing:4,opacity:1,transform:""},t),t.width=t.height=2*t.spacing,document.getElementById(e=pergola.pattern.id("grid_pPattern_",t))||(i=$C({element:"pattern",id:e,width:t.width,height:t.height,patternUnits:"userSpaceOnUse",patternTransform:t.transform,appendTo:pergola.defs}),$C({element:"line",x1:0,y1:t.spacing-.5,x2:2*t.spacing,y2:t.spacing-.5,stroke:t.colors[0],"stroke-width":t.size,opacity:t.opacity,appendTo:i}),$C({element:"line",x1:t.spacing-.5,y1:0,x2:t.spacing-.5,y2:2*t.spacing,stroke:t.colors[0],"stroke-width":t.size,opacity:t.opacity,appendTo:i})),"url(#"+e+")"},bar:function(t){var e,i;return t=pergola.extend({colors:["white","gray"],size:8,spacing:8,opacity:1,transform:""},t),t.width=t.height=t.spacing+t.size,document.getElementById(e=pergola.pattern.id("bar_pPattern_",t))||(i=$C({element:"pattern",id:e,width:t.width,height:t.height,patternUnits:"userSpaceOnUse",patternTransform:t.transform,appendTo:pergola.defs}),$C({element:"rect",width:t.width,height:t.height,fill:t.colors[0],appendTo:i}),$C({element:"rect",x:t.spacing/2,width:t.size,height:t.height,fill:t.colors[1],opacity:t.opacity,appendTo:i})),"url(#"+e+")"},grille:function(t){var e,i;return t=pergola.extend({colors:["#507060","#608070"],size:6,opacity:1,transform:""},t),document.getElementById(e=pergola.pattern.id("grille_pPattern_",t))||(i=$C({element:"pattern",id:e,width:t.size,height:t.size,patternUnits:"userSpaceOnUse",patternTransform:t.transform,appendTo:pergola.defs}),$C({element:"rect",width:t.size,height:t.size,fill:t.colors[0],appendTo:i}),$C({element:"rect",rx:1,width:t.size-1,height:t.size-1,fill:t.colors[1],opacity:t.opacity,appendTo:i})),"url(#"+e+")"},pied_de_poule:function(t){var e,i;return t=pergola.extend({colors:["#EEEBEB","#463232"],width:10,height:10,opacity:1,transform:""},t),document.getElementById(e=pergola.pattern.id("pied_de_poule_pPattern_",t))||(i=$C({element:"pattern",id:e,width:t.width,height:t.height,patternUnits:"userSpaceOnUse",patternTransform:t.transform,appendTo:pergola.defs}),$C({element:"rect",width:t.width,height:t.height,fill:t.colors[0],appendTo:i}),pergola.use({parent:i,shape:pergola.shapes.pied_de_poule,attributes:{fill:t.colors[1],opacity:t.opacity}})),"url(#"+e+")"},pied_de_poule1:function(t){var e,i;return t=pergola.extend({colors:["#F4F4F4","#282828"],width:12,height:12,opacity:1,transform:""},t),document.getElementById(e=pergola.pattern.id("pied_de_poule1_pPattern_",t))||(i=$C({element:"pattern",id:e,width:t.width,height:t.height,patternUnits:"userSpaceOnUse",patternTransform:t.transform,appendTo:pergola.defs}),$C({element:"rect",width:t.width,height:t.height,fill:t.colors[0],appendTo:i}),$C({element:"path",d:"M0,3l3-3h3l-6,6h3l3-3v3h3l-3,3v3l6-6v3l-3,3h-9z",fill:t.colors[1],opacity:t.opacity,appendTo:i})),"url(#"+e+")"},checkers:function(t){var e,i;if(t=pergola.extend({colors:["white","black"],size:32,opacity:1,transform:""},t),!document.getElementById(e=pergola.pattern.id("checkers_pPattern_",t))){var o=t.size/2;i=$C({element:"pattern",id:e,width:t.size,height:t.size,patternUnits:"userSpaceOnUse",patternTransform:t.transform,appendTo:pergola.defs}),$C({element:"rect",width:t.size,height:t.size,fill:t.colors[0],appendTo:i}),$C({element:"rect",width:o,height:o,fill:t.colors[1],opacity:t.opacity,appendTo:i}),$C({element:"rect",x:o,y:o,width:o,height:o,fill:t.colors[1],opacity:t.opacity,appendTo:i})}return"url(#"+e+")"},dot:function(t){var e,i;return t=pergola.extend({colors:["none","#404040"],size:3,spacing:9,opacity:1,transform:""},t),document.getElementById(e=pergola.pattern.id("dot_pPattern_",t))||(i=$C({element:"pattern",id:e,width:t.spacing,height:t.spacing,patternUnits:"userSpaceOnUse",patternTransform:t.transform,appendTo:pergola.defs}),$C({element:"rect",width:t.spacing,height:t.spacing,fill:t.colors[0],appendTo:i}),$C({element:"circle",cx:t.spacing/2,cy:t.spacing/2,r:t.size,fill:t.colors[1],opacity:t.opacity,appendTo:i})),"url(#"+e+")"},hive:function(t){var e,i;return t=pergola.extend({colors:["gold","goldenrod"],width:48,height:27.713,"stroke-width":2,opacity:1,transform:""},t),document.getElementById(e=pergola.pattern.id("hive_pPattern_",t))||(i=$C({element:"pattern",id:e,width:t.width,height:t.height,patternUnits:"userSpaceOnUse",patternTransform:t.transform,appendTo:pergola.defs}),$C({element:"rect",width:t.width,height:t.height,fill:t.colors[0],appendTo:i}),$C({element:"polyline",points:"32,13.856 24,27.713 8,27.713 0,13.856 8,0 24,0 32,13.856 48,13.856",fill:"none",stroke:t.colors[1],"stroke-width":t["stroke-width"],"stroke-linecap":"square",opacity:t.opacity,appendTo:i})),"url(#"+e+")"},ring:function(t){var e,i;return t=pergola.extend({colors:["none","#303030","#303030"],size:6,spacing:10,"stroke-width":2,opacity:1,transform:""},t),document.getElementById(e=pergola.pattern.id("ring_pPattern_",t))||(i=$C({element:"pattern",id:e,width:t.width||2*t.spacing,height:t.height||2*t.spacing,patternUnits:"userSpaceOnUse",patternTransform:t.transform,appendTo:pergola.defs}),$C({element:"rect",width:2*t.spacing,height:2*t.spacing,fill:t.colors[0],appendTo:i}),$C({element:"circle",cx:0,cy:t.spacing,r:t.size,fill:"none",stroke:t.colors[1],"stroke-width":t["stroke-width"],opacity:t.opacity,appendTo:i}),$C({element:"circle",cx:2*t.spacing,cy:t.spacing,r:t.size,fill:"none",stroke:t.colors[2],"stroke-width":t["stroke-width"],opacity:t.opacity,appendTo:i})),"url(#"+e+")"},id:function(t,e){for(var i in e)t+=e[i];return t.toXML()}},pergola.shapes={triangle:{element:"path",d:"M0,32h32l-16-27.7128z"},pentagon:{element:"polygon",points:"5.812,28.944 0,11.056 15.217,0 30.434,11.056 24.622,28.944"},hexagon:{element:"polygon",points:"8,27.713 0,13.856 8,0 24,0 32,13.856 24,27.713"},heptagon:{element:"polygon",points:"8.657,30.416 0,19.561 3.089,6.024 15.599,0 28.108,6.024 31.197,19.561 22.541,30.416"},octagon:{element:"polygon",points:"8.659,29.564 0,20.905 0,8.659 8.659,0 20.905,0 29.564,8.659 29.564,20.905 20.905,29.564"},nonagon:{element:"polygon",points:"10.285,31.035 1.9,24 0,13.222 5.472,3.743 15.757,0 26.042,3.743 31.514,13.222 29.613,24 21.229,31.035"},decagon:{element:"polygon",points:"11.056,30.434 3.056,24.621 0,15.217 3.056,5.813 11.056,0 20.944,0 28.944,5.813 32,15.217 28.944,24.621 20.944,30.434"},dodecagon:{element:"polygon",points:"11.313,30.909 4.141,26.769 0,19.596 0,11.313 4.141,4.141 11.313,0 19.596,0 26.768,4.141 30.909,11.313 30.909,19.596 26.768,26.769 19.596,30.909"},rhombus:{element:"polygon",points:"12,32 0,16 12,0 24,16"},semicircle:{element:"path",d:"M16,32C7.164,32,0,24.836,0,16S7.164,0,16,0V32z"},star:{element:"polygon",points:"24,0 29.848,18.265 48,18.265 33.479,29.848 38.722,48 24,37.168 9.278,48 14.521,29.848 0,18.265 18.265,18.265"},heart:{element:"path",d:"M23.5,42.5c7.7-11.49,24-20.91,24-30s-6.48-12-12-12s-10.01,2.71-12,7c-1.91-3.98-5.77-7-12-7s-12,2.98-12,12S16.65,30.87,23.5,42z"},pied_de_poule:{element:"path",d:"M2,0h2v2h6v2h-2v6h-2v-2h-6v-2h2z"}},pergola.symbols=function(){function t(){var t,e=pergola.defs,i=pergola.color.shade,o=pergola.color.themeLuminosity,s=o>128,n=[100,100,100];t=$C({element:"radialGradient",id:"lensGrad",cx:"28%",cy:"20%",r:"54.6%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"12%","stop-color":"#FAFAFA",appendTo:t}),$C({element:"stop",offset:"34%","stop-color":"#D8E0E2",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#ACB9BD",appendTo:t}),t=$C({element:"radialGradient",id:"handGrad",cx:"55%",cy:"65%",r:"100%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"20%","stop-color":"#FFFFFF",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#ACB9BD",appendTo:t}),t=$C({element:"linearGradient",id:"LatGutter",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"0%","stop-color":"#00040A",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#00040A","stop-opacity":0,appendTo:t}),t=$C({element:"radialGradient",id:"paddleGrad",cx:"50%",cy:"50%",r:"69%",fx:"50%",fy:"50%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"55%","stop-color":"#F02424",appendTo:t}),$C({element:"stop",offset:"78%","stop-color":"#F06060",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#FF1010",appendTo:t}),t=$C({element:"radialGradient",id:"pushpinGrad_red",cx:"50%",cy:"50%",r:"69%",fx:"50%",fy:"50%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"55%","stop-color":"#F02424",appendTo:t}),$C({element:"stop",offset:"78%","stop-color":"#F06060",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#FF1010",appendTo:t}),t=$C({element:"radialGradient",id:"pushpinGrad_green",cx:"50%",cy:"50%",r:"69%",fx:"50%",fy:"50%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"55%","stop-color":"#00C000",appendTo:t}),$C({element:"stop",offset:"78%","stop-color":"#20C020",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#00C000",appendTo:t}),t=$C({element:"radialGradient",id:"pushpinGrad_blue",cx:"50%",cy:"50%",r:"69%",fx:"50%",fy:"50%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"55%","stop-color":"#4040FF",appendTo:t}),$C({element:"stop",offset:"78%","stop-color":"#6868FF",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#4040FF",appendTo:t}),t=$C({element:"linearGradient",id:"chiaroscuro",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"25%","stop-color":"#FFFFFF",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#A8A8A8",appendTo:t}),t=$C({element:"linearGradient",id:"chrome",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"20%","stop-color":"#787878",appendTo:t}),$C({element:"stop",offset:"32%","stop-color":"#FFFFFF",appendTo:t}),$C({element:"stop",offset:"58%","stop-color":"#FFFFFF",appendTo:t}),$C({element:"stop",offset:"58%","stop-color":"#686868",appendTo:t}),$C({element:"stop",offset:"78%","stop-color":"#686868",appendTo:t}),$C({element:"stop",offset:"96%","stop-color":"#808080",appendTo:t}),t=$C({element:"linearGradient",id:"paddleReflection",x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"16%","stop-color":"#FFC0C0",appendTo:t}),$C({element:"stop",offset:"32%","stop-color":"#F06060",appendTo:t}),t=$C({element:"linearGradient",id:"pinReflection_red",x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"16%","stop-color":"#FFC0C0",appendTo:t}),$C({element:"stop",offset:"32%","stop-color":"#F06060",appendTo:t}),t=$C({element:"linearGradient",id:"pinReflection_green",x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"16%","stop-color":"#C0FFC0",appendTo:t}),$C({element:"stop",offset:"32%","stop-color":"#20CE20",appendTo:t}),t=$C({element:"linearGradient",id:"pinReflection_blue",x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"16%","stop-color":"#C8C8FF",appendTo:t}),$C({element:"stop",offset:"32%","stop-color":"#6868FF",appendTo:t}),t=$C({element:"radialGradient",id:"leg_diskGrad",cx:"50%",cy:"50%",r:"69%",fx:"50%",fy:"50%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"45%","stop-color":"#1050AF",appendTo:t}),$C({element:"stop",offset:"84%","stop-color":"#B0D0F0",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#0000E0",appendTo:t}),t=$C({element:"linearGradient",id:"pointerBlackGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"0%","stop-color":"#B2B2B2",appendTo:t}),$C({element:"stop",offset:"50%","stop-color":"#000000",appendTo:t}),t=$C({element:"linearGradient",id:"pointerWhiteGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"0%","stop-color":"#FFFFFF",appendTo:t}),$C({element:"stop",offset:"85%","stop-color":"#A0A0A0",appendTo:t}),t=$C({element:"linearGradient",id:"penToolGrad_tip",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"0%","stop-color":"#FFFFFF",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#000000",appendTo:t}),t=$C({element:"linearGradient",id:"penToolGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"0%","stop-color":"#FFFFFF",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#969696",appendTo:t}),t=$C({element:"linearGradient",id:"rubberToolGrad",x1:"0%",y1:"0%",x2:"100%",y2:"10%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"15%","stop-color":"#FCFCFC",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#C8C8C8",appendTo:t}),t=$C({element:"linearGradient",id:"accessoriesGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"0%","stop-color":"#F8F8F8",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#C8C8C8",appendTo:t}),t=$C({element:"linearGradient",id:"areaToolGrad",x1:"0%",y1:"0%",x2:"100%",y2:"50%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"20%","stop-color":"#F0F0F0",appendTo:t}),$C({element:"stop",offset:"50%","stop-color":"#808080",appendTo:t}),t=$C({element:"linearGradient",id:"calcToolGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:e}),$C({element:"stop",offset:"0%","stop-color":s?i(n,-24):i(n,10),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":s?i(n,-36):i(n,2),appendTo:t})}var e=pergola.color.shade,i=[100,100,100],o=e(i,80),s=e(i,-50),n=pergola.color.themeLuminosity<128,r=pergola.marker.cross(),a=pergola.marker.dot({radius:8,fill:"#60A0FF",stroke:"#FF6000"});return t(),{lens:[{element:"path",d:"M4.5 3.4l6.5,5",stroke:"#323232","stroke-width":1.25,"stroke-linecap":"round"},{element:"circle",r:5.75,fill:"#FFFFFF",stroke:"#727272","stroke-width":1.5,"fill-opacity":.6}],zoomMinus:[{element:"path",d:"M0 .5h13",stroke:n?"#F0F0F0":"#202020","stroke-linecap":"round"}],zoomPlus:[{element:"path",d:"M0 .5h13M6.5 -6v13",fill:"none",stroke:n?"#F0F0F0":"#202020","stroke-linecap":"round"}],hand:[{element:"path",d:"M0,11l-3-4l1.5-2l3,2v-8h3v5v-7h3v7v-6h3v6v-4h3v10",fill:"url(#handGrad)",stroke:"black","stroke-width":.45,"stroke-linejoin":"round","stroke-linecap":"round"}],ruler:[{element:"path",d:"M0,10.5l3.3,5l16.2,-10.5l-3.3,-5z",fill:"#FFFFFF",stroke:"#000000","stroke-width":.5},{element:"path",d:"M1.9,12.9l1.5,2.3l15.72,-10.25l-1.5,-2.3z",fill:"#E8F0F0"},{element:"path",d:"M2,9.3l1.23,1.88 M4,8l1.5,2.3 M6,6.75l1.23,1.88 M8,5.45l1.5,2.3 M10,4.15l1.23,1.88 M12,2.85l1.5,2.3 M14,1.55l1.23,1.88",fill:"none",stroke:"#000000","stroke-width":.4}],measure:[{element:"path",d:"M-6,22h32",stroke:"#00D0FF","stroke-width":2,"marker-start":r,"marker-end":r,transform:"rotate(-30) scale(.5)"}],itinerary:[{element:"path",d:"M2,8l5-8l7,14l4-11",fill:"none",stroke:"#FF0000","stroke-width":.5,"marker-start":a,"marker-mid":a,"marker-end":a}],winMinimize:[{element:"path",d:"M0,7h9",fill:"none",stroke:n?"#E8E8E8":"#707070","stroke-width":2}],winFull:[{element:"path",d:"M.5,2v6M8.5,2v6",fill:"none",stroke:n?"#E8E8E8":"#707070"},{element:"path",d:"M0,1h9M0,7h9",fill:"none",stroke:n?"#E8E8E8":"#707070","stroke-width":2}],winClose:[{element:"path",d:"M.5,0l6,6M.5,6l6-6",fill:"none",stroke:n?"#F0F0F0":"#585858","stroke-width":1.75,"stroke-linecap":"round"}],resize:[{element:"path",d:"M0,0l6,-6 a8,8 0 0,1 -12,12z",fill:"url(#resizeGrad)"}],checkmark:[{element:"path",d:"M0,4l3,4l6-8h-1l-5.5,6l-1.5-2z",fill:"#000000"}],arrow:{tiny:{up:[{element:"path",d:"M0,3h5l-2.5,-3z",fill:n?o:s}],down:[{element:"path",d:"M0,0h5l-2.5,3z",fill:n?o:s}],left:[{element:"path",d:"M3,0v5l-3-2.5z",fill:n?o:s}],right:[{element:"path",d:"M0,0v5l3-2.5z",fill:n?o:s}]},small:{up:[{element:"path",d:"M0,6h7l-3.5,-6z",fill:n?o:s}],down:[{element:"path",d:"M0,1h7l-3.5,6z",fill:n?o:s}],left:[{element:"path",d:"M0,3.5l6-3.5v7z",fill:n?o:s}],right:[{element:"path",d:"M0,0v7l6-3.5z",fill:n?o:s}]},large:{up:[{element:"path",d:"M0,8h10l-5,-8.8z",fill:n?o:s}],down:[{element:"path",d:"M0,0h10l-5,8.8z",fill:n?o:s}],left:[{element:"path",d:"M-1,5l8.8-5v10z",fill:n?o:s}],right:[{element:"path",d:"M0,0v10l8.8-5z",fill:n?o:s}]}},selectionTool:[{element:"path",d:"M3.7,8.5h3.5L-.5,0v11.5l2.25-2.25l2.25,6c0,0 .3,1 1,1 1,0 1-1 .9-1.3z",fill:"url(#pointerBlackGrad)",stroke:"#000000","stroke-width":.6}],directSelectionTool:[{element:"path",d:"M3.7,8.5h3.5L-.5,0v11.5l2.25-2.25l2.25,6c0,0 .3,1 1,1 1,0 1-1 .9-1.3z",fill:"url(#pointerWhiteGrad)",stroke:"#000000","stroke-width":.6}],groupSelectionTool:[{element:"path",d:"M3.7,8.5h3.5L-.5,0v11.5l2.25-2.25l2.25,6c0,0 .3,1 1,1 1,0 1-1 .9-1.3z",fill:"url(#pointerWhiteGrad)",stroke:"#000000","stroke-width":.6},{element:"path",d:"M7.5,2.5h5 M10,-0v5",fill:"none",stroke:"#000000"}],areaSelectionTool:[{element:"path",d:"M3.7,8.5h3.5L-.5,0v11.5l2.25-2.25l2.25,6c0,0 .3,1 1,1 1,0 1-1 .9-1.3z",fill:"url(#pointerWhiteGrad)",stroke:"#000000","stroke-width":.6},{element:"path",d:"M8.5,.5h5v5h-5z",fill:"#F0F0F0",stroke:"#303030"}],dot:{large:[{element:"circle",cx:4.5,cy:4.5,r:4.5,fill:e([100,100,100],-28)}],small:[{element:"circle",cx:2.5,cy:2.5,r:2.2,fill:e([100,100,100],-28)}]},menuArrow:[{element:"path",d:"M0,0l3.5,3.5l-3.5,3.5z",fill:"black"}],selectorArrow:{up:[{element:"path",d:"M0 0l4 4h-8z",fill:"#6B6E6B"}],down:[{element:"path",d:"M0 0l4 -4h-8z",fill:"#6B6E6B"}]},question:[{element:"text","font-size":"13pt","font-family":"Verdana","font-weight":"bold",fill:"#606060",stroke:"white","stroke-width":.75,textNode:"?"}],transition:[{element:"path",d:"M0,.5h10",fill:"none",stroke:"#808090","stroke-width":2,"stroke-linecap":"round","marker-end":pergola.marker.chevron()}],pathToLineTool:[{element:"path",d:"M4.29,4.31C3.03,5.57,2.2,7.42,2.02,8.96H0c0.45-4.74,4.23-8.47,8.96-8.95v2.01C7.45,2.16,5.54,3.05,4.29,4.31z M4.3,15.61c1.27,1.27,2.88,2.01,4.65,2.28v2.01C4.23,19.44,0.46,15.69,0,10.96h2.01C2.26,12.75,3.04,14.35,4.3,15.61z M15.58,15.65c1.33-1.33,2.11-2.99,2.32-4.69h2.01c-0.46,4.75-4.2,8.5-8.95,8.95V17.9C12.67,17.64,14.25,16.98,15.58,15.65z M15.6,4.29c-1.4-1.4-3.34-2.14-4.64-2.27V0c4.74,0.45,8.47,4.22,8.95,8.96h-2.01C17.76,7.61,17,5.68,15.6,4.29z",fill:"black"}],lineTool:[{element:"path",d:"M0,"+(n?0:.5)+"l16,16",stroke:n?"#FFFFFF":"#000000","stroke-width":1}],penTool:[{element:"polyline",points:"2,20.84 2,17.34 8,17.34 8,20.84",fill:"url(#penToolGrad_tip)",stroke:"#000000"},{element:"path",d:"M3,17.34l-2.5-7.45c3-3,4.5-8,4.5-8s1.38,5,4.5,8.11l-2.5,7.4z",fill:"url(#penToolGrad)",stroke:"#000000"},{element:"path",d:"M5,1.84v7.8",stroke:"#000000","stroke-width":.5},{element:"path",d:"M4.3,10h1.4",stroke:"#000000","stroke-width":.5}],typeTool:[{element:"text",y:20,"font-family":"Georgia","font-size":20,fill:n?"#FFFFFF":"#000000",textNode:"T"}],rubberTool:[{element:"path",d:"M1.5,8.5l7-8h7.5v2.9l-6.5,11h-10zh9.2",fill:"url(#rubberToolGrad)",stroke:"#606060","stroke-width":.5},{element:"path",d:"M16,.5v2.9l-6.5,11l1-6z",fill:"#B8B8B8",stroke:"#606060","stroke-width":.3,"stroke-linejoin":"round"}],accessoriesTool:[{element:"polygon",points:"6.83,0.5 0.73,14.5 18.25,16.5 30.73,11.5 24.83,0.5",fill:"url(#accessoriesGrad)",stroke:"#505050","stroke-width":.5},{element:"polygon",points:"6.73,0.5 2.73,5.8 2.73,6.8 19.63,7.8 24.23,0.5",fill:"white",stroke:"#505050","stroke-width":.5},{element:"path",d:"M15.33,0.5l-4.9,6.76 M20.55,10.57L3.06,9.25 M8.78,15.42l2.04-5.53 M18.25,16.5l5.98-16l-4.6,6.3l-16.9-1",fill:"none",stroke:"#505050","stroke-width":.5}],lineOptionsTool:[{element:"rect",x:-.5,y:-.5,width:22,height:16,rx:2,fill:"#F0F0F0",stroke:"#B0B0B0"},{element:"line",x1:2.5,y1:3.5,x2:18.5,y2:3.5,stroke:"#909090"},{element:"line",x1:2.5,y1:6.5,x2:18.5,y2:6.5,stroke:"#00D000"},{element:"line",x1:2.5,y1:9.5,x2:18.5,y2:9.5,stroke:"#D89080","stroke-dasharray":"3.5,.7"},{element:"line",x1:2.5,y1:12.5,x2:18.5,y2:12.5,stroke:"#50B0FF","stroke-dasharray":"4.5,1.25"}],cutWasteTool:[{element:"text",y:16,"font-size":16,fill:n?"#FFFFFF":"#202020","text-anchor":"middle",textNode:"%"}],areaTool:[{element:"rect",x:-.5,y:-.5,width:20,height:16,fill:"#ECECEC",stroke:n?"#ECECEC":"#B0B0B0"},{element:"text",x:2,y:14,"font-size":18,"font-weight":"bold",fill:"url(#areaToolGrad)",textNode:"A"},{element:"text",x:12,y:12.5,"font-size":14,"font-weight":"bold",fill:"#606060",textNode:"²"}],calcTool:[{element:"rect",width:11,height:8,rx:1,fill:"url(#calcToolGrad)"},{element:"rect",y:9,width:11,height:8,rx:1,fill:"url(#calcToolGrad)"},{element:"rect",x:12,width:11,height:17,rx:1,fill:"url(#calcToolGrad)"},{element:"path",d:"M2.5,3.5h6 M2,12.5h7M5.5,10v5 M14,6.5h7M14,9.5h7",stroke:"#FFFFFF"}],configTool:[{element:"path",d:"M17.5,16.4c0.9-0.9,0.6-2-0.2-2.7L9.4,6.7C7.9,5.3,9.6,3.1,7.1,0.9C4.6-1.4,1.5,1.4,1.5,1.4l2.7,1.1l0.8,2.3L2.7,5.9L0,4.8c0,0-0.1,1.8,1.6,3.4c1.8,1.7,4-0.3,5.5,1l7.7,7.2C15.5,17.1,16.6,17.3,17.5,16.4z",fill:"url(#penToolGrad)",stroke:n?"#ECECEC":"#404040","stroke-width":.5}],testSquareTool:[{element:"rect",x:-.5,y:-.5,width:16,height:16,fill:"none",stroke:n?"#ECECEC":"#606060"},{element:"rect",x:2,y:2,width:11,height:11,fill:n?"#F0F0F0":"#808080"}],leg:[{element:"polyline",fill:"#FFFFFF",stroke:"#404040",points:"-1.5,-14.5 -1.5,-.5 1.5,-.5 1.5,-14.5"},{element:"circle",fill:"white","fill-opacity":.65,stroke:"url(#leg_diskGrad)","stroke-width":5,cx:0,cy:-24,r:7}],signalPaddle:[{element:"polyline",fill:"url(#chiaroscuro)",stroke:"#A8A8A8",points:"-2.5,-22 -2.5,.5 2.5,0.5 2.5,-22 "},{element:"circle",fill:"none",stroke:"url(#paddleGrad)","stroke-width":6,cx:0,cy:-29,r:8},{element:"circle",fill:"none",stroke:"url(#paddleReflection)","stroke-width":1.25,cx:-.25,cy:-29.25,r:9}],pushpin_red:[{element:"polyline",fill:"url(#chrome)",points:"-2,-30 -2,-8.5 -1.2,.5 1.2,.5 2,-8.5 2,-30 "},{element:"circle",fill:"none",stroke:"url(#pushpinGrad_red)","stroke-width":6,cx:0,cy:-37,r:8},{element:"circle",fill:"none",stroke:"url(#pinReflection_red)","stroke-width":1.25,cx:-.25,cy:-37.25,r:9}],pushpin_green:[{element:"polyline",fill:"url(#chrome)",points:"-2,-30 -2,-8.5 -1.2,.5 1.2,.5 2,-8.5 2,-30 "},{element:"circle",fill:"none",stroke:"url(#pushpinGrad_green)","stroke-width":6,cx:0,cy:-37,r:8},{element:"circle",fill:"none",stroke:"url(#pinReflection_green)","stroke-width":1.25,cx:-.25,cy:-37.25,r:9}],pushpin_blue:[{element:"polyline",fill:"url(#chrome)",points:"-2,-30 -2,-8.5 -1.2,.5 1.2,.5 2,-8.5 2,-30 "},{element:"circle",fill:"none",stroke:"url(#pushpinGrad_blue)","stroke-width":6,cx:0,cy:-37,r:8},{element:"circle",fill:"none",stroke:"url(#pinReflection_blue)","stroke-width":1.25,cx:-.25,cy:-37.25,r:9}],banana:[{element:"path",fill:"#FADC74",d:"M3.8,12.7L4.6,15l4.2,5.1l9,4.4l10.5,0.7l8.6-1.3l7-4.6l3.9-5l1.3-5.7l3.1-8.4c0,0-0.5-0.3-1.1-0.2c-0.9,3.5-1.7,5-3.5,8C41.7,11.4,35.8,18.4,27,18.5C17.3,18.7,8.7,14.6,4.6,10C3.3,9.3,2.8,9.9,3.8,12.7z"},{element:"path",fill:"#E8B84D",d:"M27.6,24.2c5.8-0.1,10.4-1.8,14.9-5c4.4-3.4,5.8-7.5,5.8-10.9c2-3.3,3.9-8.1,3.9-8.1c0.9-0.2,1.5,0.2,1.5,0.2s1.4,0.6,2,0.5c-1.8,2.5-4.3,6.4-4.3,9.2s1.5,4.4-0.4,8.3C48,24,40,31.2,26,31.2c-8.8,0-13.5-2-17.6-5.2C4.7,23.1,1.8,18.9,1,14.9c0-4,1-4.6,2.8-2.2c1,1.9,3,4.4,5.8,6.7C14.2,22.6,19.9,24.3,27.6,24.2z"},{element:"path",fill:"#C89943",d:"M55.8,0.8c-1.6,2.3-4.4,6.5-4.4,9.3s1.5,4.4-0.4,8.3C48,24,42.1,28,36.2,29.8c2.1-2.1,7.6-4.3,7.6-7.1c0,0-2.1,1.5-3.8,1.1c6.5-3.7,9.4-8.3,9.7-13.6c0.2-3.1,1.6-6.4,4.9-8.9c-0.2-0.4-0.8-0.3-0.9-0.9C53.8,0.3,54.6,0.2,55.8,0.8z"},{element:"path",fill:"#B2BC4B",d:"M4.6,10C4,9,3.1,8,2.8,8c0,0-1.1,1.1-2.8,2c0,0.6,0.6,2,1,4.9c0-3.9,1-4.6,2.8-2.2C2.9,9.9,3.3,9.4,4.6,10z"},{element:"path",fill:"#537F37",d:"M4.3,9.6C3.7,8.7,3,8,2.8,8c0,0-1.1,1.1-2.8,2c0,0.4,0.6,2.4,0.8,3.5c-0.2-3.5,0.8-4,2.4-1.9C1.9,8.8,2.9,8.6,4.3,9.6z"},{element:"path",fill:"#4C4822",d:"M2.8,8C2.1,7.9,1.9,8.8,1.4,9S-0.1,9.6,0,10c0.3,0.2,1.1-0.1,1.7-0.7C2.4,8.7,3,8.2,2.8,8z"}]}
},pergola.cursors=function(){var t=pergola.defs,e=pergola.path+"lib/cursors/";$C({element:"cursor",id:"lensCursor","xlink:href":e+"cursor_lens_empty.png",x:6,y:6,appendTo:t}),$C({element:"cursor",id:"minusCursor","xlink:href":e+"cursor_lens_minus.png",x:6,y:6,appendTo:t}),$C({element:"cursor",id:"plusCursor","xlink:href":e+"cursor_lens_plus.png",x:6,y:6,appendTo:t}),$C({element:"cursor",id:"PointerBlack","xlink:href":e+"pointerBlack.png",x:6,y:6,appendTo:t}),$C({element:"cursor",id:"rotationCursor","xlink:href":e+"rotation.png",x:9,y:5.25,appendTo:t})},pergola.quickTip={deleteSelected:{tip:"Delete Selected Objects"},lensTool:{tip:["Click : select/deselect","Click on canvas: zoom up","Shift + Click on canvas: zoom down","Click & drag on canvas: selection area","DoubleClick: reset to 1:1"]},handTool:{tip:["Click : select/deselect","Click & drag on canvas to navigate","DoubleClick: reset to origin"]},zoomup:{tip:["Click : step zoom up","Click & hold : linear zoom up"]},zoomdown:{tip:["Click : step zoom down","Click & hold : linear zoom down"]},mapLensTool:{tip:["Click : select/deselect","Click on map : zoom up","Shift + Click on map : zoom down","Click & drag on map : selection area","DoubleClick : reset zoom to level 2"]},mapHandTool:{tip:["Click : select/deselect","Click & drag on map to navigate","DoubleClick : reset to lon. 0, lat. 0, zoom 1"]},measureTool:{tip:["Measure Tool","Click : select/deselect","Click & drag on map to","measure linear distance"]},itineraryTool:{tip:["Itinerary Tool","Click : select/deselect","Click on map : set itinerary points","DoubleClick on tool : clear"]},mapHelp:{tip:"Map Help"}},pergola.messages={activateWindow:["Please activate "," window."],conflictingProperties:"\nConflicting properties.",closeConfirm:"Close Document? \nAll unsaved changes will be lost.",debuggerInactive:"The debugger is not activated.\nIt can be activated in the config file.",debuggerLines:["The debugger input cannot exceed "," lines.\nYou can increase the number of lines in the config file."],deleteColumn:"The selected column will be permanently removed.\n\n Delete?",deleteRow:"The selected row will be permanently removed.\n\n Delete?",documentReplace:['A document named "','" is already open.\nAll unsaved changes will be lost.\n\nReplace Document?'],dontShow:"Don't show again",file404:"The requested file does not exist at the specified address.",fieldExists:["The field property ","\nalready exists and will be skipped."],generic:"The operation could not be completed.",handToolHelp:["Click : select/deselect","Click & drag on map : pan","DoubleClick : reset to lon. 0, lat. 0, zoom 1"],header:"Object: ",help:"\nSee the examples or the documentation.",kbdNavHelp:["Arrow : 16 user space units","Shift + Arrow : 128 user space units","Shift + Alt + Arrow : 512 user space units","+ : zoom up","- : zoom down"],itineraryToolHelp:["Click : select/deselect","Click on map : set itinerary points","DoubleClick : clear"],lensToolHelp:["Click : select/deselect","Click on map : zoom up","Alt + Click on map : zoom down","Click & drag on map : selection area","DoubleClick : reset to zoom 2"],lineNunmberRange:"You must enter a line number in the range: ",loadingFail:"Document loading failed.",notANumber:"You must enter a number.",overwriteCurrentFile:"Overwrite current file?",overwriteExistingFile:['File "','" already exists. \n\nOverwrite?'],mapLevelRange:"The zoom level must be in the range 1 – 21\n",measureToolHelp:["Click & drag on map (max lon range: 180°)"],minusToolHelp:["Click : step zoom down by 1","Click & hold : linear zoom down by 0.05"],missingCompForCmenu:['You are trying to add a context menu for the "','" component.\n'],missingComponent:['Object "','" does not have the "','" component property.\n\nCheck overridden components properties in the initialization object.'],missingHandler:"\nYou must specify an existing owner object or a valid \nhandler function for an instance of class: ",missingList:"\nMissing list parameter. \nCould not update the contents of ",missingOwner:"\nYou must specify an existing owner object\nfor an instance of class: ",missingOwnerDatagrid:"\nA DataGrid object must be specified as \nowner object for an instance of class: ",missingParent:["\nYou haven't specified a parent node for object:\n","\nThe object will be placed on the desktop."],missingParameter:"\nThis method expects an argument of type: ",missingProperty:"\nThe object does not have a property: ",missingSeparatorType:'\nThe "type" property of a separator object \nmust be set to "horizontal" or "vertical".',missingTarget:"You haven't specified a target object for \nobject: ",missingTargetContainer:"To load a document you must specify a target container.",missingURL:"To load a document you must specify its URL.",mouseNavHelp:["Click&Drag : pan","DoubleClick : zoom up","Shift + DoubleClick : zoom down","Wheel : Zoom up/down by 0.1 (resampling)"],nextNotFound:['Next occurrence of "','" not found. \n\nContinue search from the beginning?'],noGridDataType:"You haven't specified the dataType property \nin the DataGrid initialization object.",noLocalLoading:"Loading local documents is only allowed in \nbrowers that implement XMLHttpRequest 2.",noSavePermission:"Can't overwrite the current document. \nYou don't have admistrator permissions.\n\nPlease choose a different file name.",noSuchColumn:"Can't find column \"",noSuchRow:"Can't find row #",noSuchShape:"The shape you are trying to use does not \nexist in the shapes library.",outOfRange:["This value must be between "," and "],plusToolHelp:["Click : step zoom up by 1","Click & hold : linear zoom up by 0.05"],preemptiveIsUp:'A preemptive panel is already open. \nYou can\'t set the "isOpen" property \nfor more than one preemptive panel.',previousNotFound:['Previous occurrence of "','" not found. \n\nContinue search from the end?'],runtimeError:"RUNTIME ERROR \n\n",scrollHelp:["Navigation type. Tiles query"],svgNotFound:"Cannot find <svg> element in document: ",wrongButtonSize:"\nCan't make a button of size: ",wrongButton:'\nYou cannot declare "size" and "width" or "height"',wrongButtonShape:"\nA user define button shape can only be:\nan object from the shapes library\nan object defining a primitive and its geometrical attributes",wrongColorFormat:"Wrong format. Allowed values: \nhexadecimal; rgb (decimal or percentage);\ncolor keyword names; user define color names.\n\nConverting to black...",wrongQuickTip:" quick–tip does not exist in quickTip library.",wrongScrollBar:"\nCan't make a scrollbar of scrollType: ",wrongScrollType:"\nCan't make a slider of scrollType: ",wrongSliderShape:"\nCan't make a button of shape: ",wrongSliderPosition:"\nCan't set initial slider position to: ",wrongSeparatorType:"\nCan't make a separator of type: ",wrongStatusOwner:"\nThe owner object of a StatusBar must be \na Window instance.",wrongTaskBarPosition:"Can't position the taskbar to: ",wrongTypeArray:" must be of type Array.",wrongTypeObject:" must be of type Object.",wrongTypeString:" must be of type String."},pergola.skins={rubber:function(){var t,e,i,o,s=pergola.defs,n=pergola.color.shade,r=[100,100,100];pergola.color.lab(pergola.color.convert(pergola.theme)),i=pergola.color.themeLuminosity,o=i>128,pergola.presentationAttributes={all:{"font-family":"'Segoe UI', 'Trebuchet MS', 'Lucida Grande', 'Deja Vu'","font-size":13,stroke:"#7F7F7F"},areaTag:{"font-size":9,rx:4,fill:"#FFFFC0",stroke:"#989898"},background:{fill:"white",stroke:"none",opacity:.5,"xlink:href":""},button:{fill:"url(#buttonGrad)",stroke:"#878787",maskFill:"url(#buttonMaskGrad)",large:{width:20,height:20},small:{width:14,height:14}},caption:{fill:"black"},checkBox:{width:13,height:13,fill:"white"},colorpicker:{spectrum:"narrow"},colorBoxSelector:{fill:"#FFFFFF",stroke:"#B0B0B0",width:216,height:21},comboBox:{width:220,height:160,listItemHeight:21,listMargin:8},commandButton:{width:16,height:13,fill:o?n(r,-10):n(r,40),maskFill:"none",stroke:"none"},contextMenu:{margin:15,filter:pergola.filter.blur({stdDeviation:1.4,dx:2.8,dy:2.8,"flood-opacity":.42}),"font-size":11,fill:n(r,70)},coordinates:{"font-size":12},datagrid:{headerHeight:30,rowHeight:"auto",nColumns:6,nRows:50,fill:"#FFFFFF",altFill:"#F4F8FF",stroke:"#E0E0E0",highlightFill:"url(#highlightDatagridGrad)",highlightStroke:"#A0BCF0",gutter:!1},datagridHeader:{width:60,height:30,fill:"url(#gridHeaderGrad)",stroke:"#C0C0C0"},datagridLine:{fill:"url(#gridRowGrad)",stroke:"#C0C0C0"},dialogButton:{width:64,height:25,rx:3},frame:{width:200,height:200,fill:n([90,90,90]),stroke:n([90,90,90],-24),"fill-opacity":function(){var t=pergola.color.hexToRGB(pergola.presentationAttributes.background.fill),e=pergola.color.luminosity(t[0],t[1],t[2]);return.2+.15*(i>e)},"stroke-opacity":function(){var t=pergola.color.hexToRGB(pergola.presentationAttributes.background.fill),e=pergola.color.luminosity(t[0],t[1],t[2]);return.3+.3*(i>e)},rx:3},grid:{type:"dots",color:"#000000",display:"block"},input:{width:36,height:20,fill:"#FFFFFF",stroke:"#A0A0A0"},inputCursor:{blinkRate:750},layer:{color:"red",hiliteColor:"#40FFFF"},legend:{"font-size":"12px"},listItem:{fill:"url(#listItemGrad)",maskFill:"#FBFBFB"},menu:{"font-size":"12px",fill:"url(#menuGrad)",stroke:n(r,-4),rx:3},menuBar:{"font-size":"12px",height:19,fill:"url(#menubarGrad)"},menuItem:{height:19,fill:"url(#listItemGrad)"},menuList:{margin:15,filter:pergola.filter.blur({stdDeviation:1.4,dx:2.8,dy:2.8,"flood-opacity":.42})},notification:{x:440,y:340,width:360,height:220,fill:"white"},panel:{x:150,y:120,width:440,height:360,margin:4,fill:"#ebecec",hasFooter:!1,footerFill:"#ebecec",footerHeight:60,filter:pergola.filter.blur()},popupList:{width:200,listItemHeight:20,listMargin:8},preview:{rx:2,width:150,height:120,"fill-opacity":.3,"stroke-opacity":.6},progress:{fill:"#F0F0F0",stroke:"#E0E0E0",statusFill:"url(#progressGrad)",width:300,height:12},quickTip:{"font-size":"8pt",rx:6,fill:"url(#quickTipGrad)",stroke:"#989898",textFill:"#242424",delay:700},radioButton:{r:7,dotR:3,fill:"url(#radioButtonGrad)",stroke:"#808080",dotFill:"#303030"},rubberBox:{stroke:"black","stroke-width":1,"stroke-dasharray":"1,2",maskStroke:"white"},scrollBar:{fill:n(r,50),stroke:"#D0D0D0",horTrackFill:"url(#hTrackGrad)",vertTrackFill:"url(#vTrackGrad)",size:15,padding:1,delay:250,stepFrequence:50,step:40,pageFrequence:100,mapPageFrequence:500},scrollButton:{width:16,height:13,fill:o?n(r,-6):n(r,20),maskFill:o?n(r,20):n(r),stroke:n(r,64)},scrollSlider:{fill:{horizontal:"url(#sliderPattern)",vertical:"url(#sliderPattern)"},stroke:n(r),rx:0},selector:{"font-size":"9pt",fill:"#F5F5F6",stroke:"#B0B0B0",maskFill:"#B0B0B0","stroke-width":2,rx:5,width:216,height:21},separator:{width:15,height:5,stroke:o?n(r,-40):n(r,50)},slider:{"font-size":"7pt",rx:2,fill:"url(#sliderButtonGrad)",stroke:"#FFFFFF",trackFill:"#C0C0C0",trackStroke:"none",trackOpacity:.05,slotStroke:"#606060",slotSize:1,shape:"round",size:16,type:"linear",initial:"middle",valueTip:!1},statusBar:{fill:"url(#statusBarGrad)",height:20,"font-size":"10px",advanceX:10},suffix:{position:"right","text-anchor":"start"},tab:{"font-size":"11px",fill:"url(#tabGrad)","fill-opacity":.5,width:120,height:18.5},taskBar:{fill:"url(#taskbarGrad)",width:"100%",height:32},text:{fill:o?"#000000":"#FFFFFF",fillInverse:o?"#FFFFFF":"#000000",shadow:o?n([82,84,85.5],i/4):"#000000"},toolBar:{fill:"url(#toolbarGrad)",height:29,rx:0,spacing:5},toolButton:{width:28,height:22,fill:"url(#toolButtonGrad)",stroke:o?n(r,-13):n(r,10),maskFill:"url(#toolButtonMaskGrad)",rx:4},topBar:{fill:{panel:"url(#topBarGrad)",window:"url(#winTopBarGrad)",messageBox:"url(#alertTopBarGrad)"},maskFill:n(r,25),preemptiveFill:o?n(r,-40):n(r,80),height:{panel:32,window:44}},upDownButton:{width:12,height:20,rx:0},window:{fill:"#FFFFFF",scrollSize:17},windowTab:{"font-size":11,width:100,fill:"url(#windowTabGrad)",maskFill:"url(#windowTabMaskGrad)",maskStroke:n(r,75)}},t=$C({element:"linearGradient",id:"taskbarGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#FFFFFF","stop-opacity":.9,appendTo:t}),$C({element:"stop",offset:"4%","stop-color":"#D8D8D8","stop-opacity":.65,appendTo:t}),$C({element:"stop",offset:"95%","stop-color":"#606060","stop-opacity":.4,appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#000000",appendTo:t}),t=$C({element:"linearGradient",id:"windowTabGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n([90,90,90],20),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n([90,90,90],50),appendTo:t}),t=$C({element:"linearGradient",id:"windowTabMaskGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n([90,90,90],20),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n([90,90,90],0),appendTo:t}),t=$C({element:"linearGradient",id:"topBarGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,-18),appendTo:t}),$C({element:"stop",offset:"10%","stop-color":n(r),appendTo:t}),$C({element:"stop",offset:"94%","stop-color":n(r,10),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,60),appendTo:t}),t=$C({element:"linearGradient",id:"alertTopBarGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,-36),appendTo:t}),$C({element:"stop",offset:"10%","stop-color":n(r,-16),appendTo:t}),$C({element:"stop",offset:"95%","stop-color":n(r,-8),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,80),appendTo:t}),t=$C({element:"linearGradient",id:"winTopBarGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,-40),appendTo:t}),$C({element:"stop",offset:"1%","stop-color":n(r,-18),appendTo:t}),$C({element:"stop",offset:"12%","stop-color":n(r),appendTo:t}),$C({element:"stop",offset:"92%","stop-color":n(r,10),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,32),appendTo:t}),t=$C({element:"linearGradient",id:"menuGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,50),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,45),appendTo:t}),t=$C({element:"linearGradient",id:"menubarGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n([103.333,98.514,92.934]),appendTo:t}),$C({element:"stop",offset:"44%","stop-color":n([104.761,99.009,91.847]),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n([102.38,91.584,80.434]),appendTo:t}),t=$C({element:"radialGradient",id:"radioButtonGrad",cx:"65%",cy:"65%",r:"100%",fx:"65%",fy:"65%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#F0F0F0",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#A8B0B8",appendTo:t}),t=$C({element:"linearGradient",id:"tabGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#C0C0C0",appendTo:t}),$C({element:"stop",offset:"15%","stop-color":"#ECECEC",appendTo:t}),$C({element:"stop",offset:"50%","stop-color":"white",appendTo:t}),t=$C({element:"linearGradient",id:"toolbarGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n([102.333,100,96.934]),appendTo:t}),$C({element:"stop",offset:"44%","stop-color":n([103.761,100.009,97.847]),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n([99.38,92.584,88.434]),appendTo:t}),t=$C({element:"linearGradient",id:"statusBarGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,70),appendTo:t}),$C({element:"stop",offset:"8%","stop-color":n(r,10),appendTo:t}),$C({element:"stop",offset:"94%","stop-color":n(r,10),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,-30),appendTo:t}),t=$C({element:"linearGradient",id:"gridHeaderGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":o?n(r,80):n(r,100),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":o?n(r,20):n(r,88),appendTo:t}),t=$C({element:"linearGradient",id:"highlightDatagridGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#E8ECFF",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#D8DCFF",appendTo:t}),t=$C({element:"linearGradient",id:"gridRowGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":o?n(r,80):n(r,100),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":o?n(r,40):n(r,92),appendTo:t}),t=$C({element:"linearGradient",id:"toolButtonMaskGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n([104.761,99.009,91.847],30),appendTo:t}),$C({element:"stop",offset:"44%","stop-color":n([104.761,99.009,91.847],36),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n([104.761,99.009,91.847],21),appendTo:t}),t=$C({element:"linearGradient",id:"toolButtonStrokeGrad",x1:"0%",y1:"0%",x2:"33%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,100),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,60),appendTo:t}),t=$C({element:"linearGradient",id:"hTrackGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,-35),appendTo:t}),$C({element:"stop",offset:"12%","stop-color":n(r,78),appendTo:t}),$C({element:"stop",offset:"88%","stop-color":n(r,78),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#FFFFFF",appendTo:t}),t=$C({element:"linearGradient",id:"listItemGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n([120.283,61.538,47.058],9),appendTo:t}),$C({element:"stop",offset:"45%","stop-color":n([120.283,61.538,47.058],11),appendTo:t}),$C({element:"stop",offset:"55%","stop-color":n([120.283,61.538,47.058],10),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n([120.283,61.538,47.058],-5),appendTo:t}),t=$C({element:"linearGradient",id:"vTrackGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,-35),appendTo:t}),$C({element:"stop",offset:"12%","stop-color":n(r,78),appendTo:t}),$C({element:"stop",offset:"88%","stop-color":n(r,78),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#FFFFFF",appendTo:t}),t=$C({element:"linearGradient",id:"hScrollSliderStrokeGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,74),appendTo:t}),$C({element:"stop",offset:"10%","stop-color":n(r),appendTo:t}),$C({element:"stop",offset:"88%","stop-color":n(r),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,-25),appendTo:t}),t=$C({element:"linearGradient",id:"vScrollSliderStrokeGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,74),appendTo:t}),$C({element:"stop",offset:"10%","stop-color":n(r),appendTo:t}),$C({element:"stop",offset:"88%","stop-color":n(r),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,-25),appendTo:t}),t=$C({element:"linearGradient",id:"buttonMaskGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,76),appendTo:t}),$C({element:"stop",offset:"8%","stop-color":n(r,55),appendTo:t}),$C({element:"stop",offset:"88%","stop-color":n(r,55),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,-12),appendTo:t}),t=$C({element:"linearGradient",id:"buttonGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,-20),appendTo:t}),$C({element:"stop",offset:"20%","stop-color":n(r,10),appendTo:t}),$C({element:"stop",offset:"80%","stop-color":n(r,10),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,55),appendTo:t}),t=$C({element:"linearGradient",id:"neutralButtonMaskGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#F8F8F8",appendTo:t}),$C({element:"stop",offset:"20%","stop-color":"#DADCDE",appendTo:t}),$C({element:"stop",offset:"80%","stop-color":"#DADCDE",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#9EA0A2",appendTo:t}),t=$C({element:"linearGradient",id:"neutralButtonGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#8A8C8E",appendTo:t}),$C({element:"stop",offset:"20%","stop-color":"#B4B6B8",appendTo:t}),$C({element:"stop",offset:"80%","stop-color":"#B4B6B8",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#FFFFFF",appendTo:t}),t=$C({element:"linearGradient",id:"sliderButtonGrad",x1:"0%",y1:"0%",x2:"40%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,80),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,-8),appendTo:t}),t=$C({element:"linearGradient",id:"sliderPatternGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,20),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,-20),appendTo:t}),e=$C({element:"pattern",id:"sliderPattern",x:2.5,y:2.5,width:5,height:5,patternUnits:"userSpaceOnUse",appendTo:s}),$C({element:"rect",x:0,y:0,width:5,height:5,fill:"url(#sliderPatternGrad)",appendTo:e}),$C({element:"circle",cx:2.5,cy:2.5,r:1.5,fill:n(r),appendTo:e}),t=$C({element:"linearGradient",id:"progressGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"50%","stop-color":"#d00030",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#ffc030",appendTo:t}),t=$C({element:"linearGradient",id:"quickTipGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"10%","stop-color":n(r,100),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,72),appendTo:t}),t=$C({element:"linearGradient",id:"insetStroke",x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#c0c0c0",appendTo:t}),$C({element:"stop",offset:"49.9%","stop-color":"#c0c0c0",appendTo:t}),$C({element:"stop",offset:"50%","stop-color":"#f0f0f0",appendTo:t}),t=$C({element:"linearGradient",id:"marker1",x1:"0%",y1:"0%",x2:"100%",y2:"75%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#001030",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#FAFAFF",appendTo:t}),t=$C({element:"linearGradient",id:"marker2",x1:"0%",y1:"0%",x2:"100%",y2:"75%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"40%","stop-color":"#001030",appendTo:t}),$C({element:"stop",offset:"66%","stop-color":"#FAFAFF",appendTo:t}),t=$C({element:"linearGradient",id:"marker3",x1:"0%",y1:"0%",x2:"100%",y2:"75%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#003090",appendTo:t}),$C({element:"stop",offset:"94%","stop-color":"#E0F0FF",appendTo:t}),t=$C({element:"linearGradient",id:"LonGutter",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#00040A",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#00040A","stop-opacity":0,appendTo:t}),t=$C({element:"linearGradient",id:"resizeGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"40%","stop-color":"#FFFFFF","stop-opacity":.05,appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#000000","stop-opacity":.25,appendTo:t}),t=$C({element:"radialGradient",id:"lensGrad",cx:"28%",cy:"20%",r:"54.6%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"12%","stop-color":"#FAFAFA",appendTo:t}),$C({element:"stop",offset:"34%","stop-color":"#D8E0E2",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#ACB9BD",appendTo:t}),t=$C({element:"radialGradient",id:"handGrad",cx:"55%",cy:"65%",r:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"20%","stop-color":"#FFFFFF",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#ACB9BD",appendTo:t}),t=$C({element:"linearGradient",id:"LatGutter",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#00040A",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#00040A","stop-opacity":0,appendTo:t}),t=$C({element:"radialGradient",id:"paddleGrad",cx:"50%",cy:"50%",r:"69%",fx:"50%",fy:"50%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"55%","stop-color":"#F02424",appendTo:t}),$C({element:"stop",offset:"78%","stop-color":"#F06060",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#FF1010",appendTo:t}),t=$C({element:"radialGradient",id:"pushpinGrad_red",cx:"50%",cy:"50%",r:"69%",fx:"50%",fy:"50%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"55%","stop-color":"#F02424",appendTo:t}),$C({element:"stop",offset:"78%","stop-color":"#F06060",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#FF1010",appendTo:t}),t=$C({element:"radialGradient",id:"pushpinGrad_green",cx:"50%",cy:"50%",r:"69%",fx:"50%",fy:"50%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"55%","stop-color":"#00C000",appendTo:t}),$C({element:"stop",offset:"78%","stop-color":"#20C020",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#00C000",appendTo:t}),t=$C({element:"radialGradient",id:"pushpinGrad_blue",cx:"50%",cy:"50%",r:"69%",fx:"50%",fy:"50%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"55%","stop-color":"#4040FF",appendTo:t}),$C({element:"stop",offset:"78%","stop-color":"#6868FF",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#4040FF",appendTo:t}),t=$C({element:"linearGradient",id:"chiaroscuro",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"25%","stop-color":"#FFFFFF",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#A8A8A8",appendTo:t}),t=$C({element:"linearGradient",id:"chrome",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"20%","stop-color":"#787878",appendTo:t}),$C({element:"stop",offset:"32%","stop-color":"#FFFFFF",appendTo:t}),$C({element:"stop",offset:"58%","stop-color":"#FFFFFF",appendTo:t}),$C({element:"stop",offset:"58%","stop-color":"#686868",appendTo:t}),$C({element:"stop",offset:"78%","stop-color":"#686868",appendTo:t}),$C({element:"stop",offset:"96%","stop-color":"#808080",appendTo:t}),t=$C({element:"linearGradient",id:"paddleReflection",x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"16%","stop-color":"#FFC0C0",appendTo:t}),$C({element:"stop",offset:"32%","stop-color":"#F06060",appendTo:t}),t=$C({element:"linearGradient",id:"pinReflection_red",x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"16%","stop-color":"#FFC0C0",appendTo:t}),$C({element:"stop",offset:"32%","stop-color":"#F06060",appendTo:t}),t=$C({element:"linearGradient",id:"pinReflection_green",x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"16%","stop-color":"#C0FFC0",appendTo:t}),$C({element:"stop",offset:"32%","stop-color":"#20CE20",appendTo:t}),t=$C({element:"linearGradient",id:"pinReflection_blue",x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"16%","stop-color":"#C8C8FF",appendTo:t}),$C({element:"stop",offset:"32%","stop-color":"#6868FF",appendTo:t}),t=$C({element:"radialGradient",id:"leg_diskGrad",cx:"50%",cy:"50%",r:"69%",fx:"50%",fy:"50%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"45%","stop-color":"#1050AF",appendTo:t}),$C({element:"stop",offset:"84%","stop-color":"#B0D0F0",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#0000E0",appendTo:t}),t=$C({element:"linearGradient",id:"pointerBlackGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#B2B2B2",appendTo:t}),$C({element:"stop",offset:"50%","stop-color":"#000000",appendTo:t}),t=$C({element:"linearGradient",id:"pointerWhiteGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#FFFFFF",appendTo:t}),$C({element:"stop",offset:"85%","stop-color":"#A0A0A0",appendTo:t}),t=$C({element:"linearGradient",id:"penToolGrad_tip",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#FFFFFF",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#000000",appendTo:t}),t=$C({element:"linearGradient",id:"penToolGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#FFFFFF",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#969696",appendTo:t}),t=$C({element:"linearGradient",id:"rubberToolGrad",x1:"0%",y1:"0%",x2:"100%",y2:"10%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"15%","stop-color":"#FCFCFC",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#A4A4A4",appendTo:t}),t=$C({element:"linearGradient",id:"accessoriesGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#F8F8F8",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#C8C8C8",appendTo:t}),t=$C({element:"linearGradient",id:"areaToolGrad",x1:"0%",y1:"0%",x2:"100%",y2:"50%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"20%","stop-color":"#F0F0F0",appendTo:t}),$C({element:"stop",offset:"50%","stop-color":"#808080",appendTo:t}),t=$C({element:"linearGradient",id:"calcToolGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":o?n(r,-24):n(r,10),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":o?n(r,-36):n(r,2),appendTo:t})},office:function(){var t,e,i,o,s=pergola.defs,n=pergola.color.shade,r=[100,100,100];pergola.color.lab(pergola.color.convert(pergola.theme)),i=pergola.color.themeLuminosity,o=i>128,pergola.presentationAttributes={all:{"font-family":"'Segoe UI', 'Trebuchet MS', 'Lucida Grande', 'Deja Vu'","font-size":13,stroke:"#7F7F7F"},areaTag:{"font-size":9,rx:4,fill:"#FFFFC0",stroke:"#989898"},background:{fill:"white",stroke:"none",opacity:.5,"xlink:href":""},button:{fill:"url(#buttonGrad)",stroke:o?n([75,77,79],-12):n([75,77,79],40),maskFill:"url(#buttonMaskGrad)",large:{width:20,height:20},small:{width:14,height:14}},caption:{fill:"black"},checkBox:{width:13,height:13,fill:"white"},colorpicker:{spectrum:"narrow"},colorBoxSelector:{fill:"#FFFFFF",stroke:"#B0B0B0",width:216,height:21},comboBox:{width:220,height:160,listItemHeight:21,listMargin:8},commandButton:{width:16,height:13,fill:o?n(r,-6):n(r,40),maskFill:"none",stroke:"none"},contextMenu:{margin:15,filter:pergola.filter.blur({stdDeviation:1.4,dx:2.8,dy:2.8,"flood-opacity":.42}),"font-size":11,fill:n(r,70)},coordinates:{"font-size":12},datagrid:{headerHeight:30,rowHeight:"auto",nColumns:6,nRows:50,fill:"#FFFFFF",altFill:"#F4F8FF",stroke:"#E0E0E0",highlightFill:"url(#highlightDatagridGrad)",highlightStroke:"#80DCFF",gutter:!1},datagridHeader:{width:60,height:30,fill:"url(#gridHeaderGrad)",stroke:"#C0C0C0"},datagridLine:{fill:"url(#gridRowGrad)",stroke:"#C0C0C0"},dialogButton:{width:64,height:25,rx:3},frame:{width:200,height:200,fill:n([90,90,90]),stroke:n([90,90,90],-32),"fill-opacity":function(){var t=pergola.color.hexToRGB(pergola.presentationAttributes.background.fill),e=pergola.color.luminosity(t[0],t[1],t[2]);
return.2+.15*(i>e)},"stroke-opacity":function(){var t=pergola.color.hexToRGB(pergola.presentationAttributes.background.fill),e=pergola.color.luminosity(t[0],t[1],t[2]);return.3+.3*(i>e)},rx:3},grid:{type:"dots",color:"#000000",display:"block"},input:{width:36,height:20,fill:"#FFFFFF",stroke:"#A0A0A0"},inputCursor:{blinkRate:750},layer:{color:"red",hiliteColor:"#40FFFF"},legend:{"font-size":"12px"},listItem:{fill:"url(#listItemGrad)",maskFill:"#FBFBFB"},measurements:{"font-family":"Arial","font-size":"12px","font-weight":"normal"},menu:{"font-size":"12px",fill:"url(#menuGrad)",stroke:n(r,-8),rx:0},menuBar:{"font-size":"12px",height:19,fill:"url(#menubarGrad)"},menuItem:{height:19,fill:"url(#listItemGrad)"},menuList:{margin:15,filter:pergola.filter.blur({stdDeviation:1.4,dx:2.8,dy:2.8,"flood-opacity":.42})},notification:{x:440,y:340,width:360,height:220,fill:"white"},panel:{x:150,y:120,width:440,height:360,margin:12,fill:n(r,70),hasFooter:!1,footerFill:n(r,40),footerHeight:60,filter:pergola.filter.blur()},popupList:{width:200,listItemHeight:20,listMargin:8},preview:{rx:2,width:150,height:120,"fill-opacity":.3,"stroke-opacity":.6},progress:{fill:"#F0F0F0",stroke:"#E0E0E0",statusFill:"url(#progressGrad)",width:300,height:12},quickTip:{"font-size":"8pt",rx:6,fill:"url(#quickTipGrad)",stroke:"#989898",textFill:"#242424",delay:700},radioButton:{r:7,dotR:3,fill:"url(#radioButtonGrad)",stroke:"#404040",dotFill:"#303030"},rubberBox:{stroke:"black","stroke-width":1,"stroke-dasharray":"1,2",maskStroke:"white"},scrollBar:{fill:n(r,64),stroke:o?n(r):n(r,40),horTrackFill:n(r,82),vertTrackFill:n(r,82),size:15,padding:2,delay:250,stepFrequence:50,step:40,pageFrequence:100,mapPageFrequence:500},scrollButton:{width:16,height:13,fill:o?n(r,-6):n(r,40),maskFill:n(r),stroke:n(r,64)},scrollSlider:{fill:{horizontal:"url(#horScrollSliderGrad)",vertical:"url(#vertScrollSliderGrad)"},stroke:"none",rx:0},selector:{"font-size":"9pt",fill:"#F5F5F6",stroke:"#B0B0B0",maskFill:"#B0B0B0","stroke-width":2,rx:5,width:216,height:21},separator:{width:14,height:5,stroke:o?n(r,-40):n(r,60)},slider:{"font-size":"7pt",rx:2,fill:"url(#sliderButtonGrad)",stroke:"#FFFFFF",trackFill:"#C0C0C0",trackStroke:"none",trackOpacity:.05,slotStroke:"#606060",slotSize:1,shape:"round",size:16,type:"linear",initial:"middle",valueTip:!1},statusBar:{fill:n(r),height:22,"font-size":"10px",advanceX:10},suffix:{position:"right","text-anchor":"start"},tab:{"font-size":"11px",fill:"url(#tabGrad)","fill-opacity":.5,width:120,height:18.5,margin:12},taskBar:{fill:"url(#taskbarGrad)",width:"100%",height:32},text:{fill:o?"#000000":"#FFFFFF",fillInverse:o?"#FFFFFF":"#000000",shadow:o?n([82,84,85.5],i/4):"#000000"},toolBar:{fill:"url(#toolbarGrad)",height:28,rx:0,spacing:4},toolButton:{width:28,height:22,fill:"url(#toolButtonGrad)",stroke:o?n(r,-13):n(r,10),maskFill:"url(#toolButtonMaskGrad)",rx:4},topBar:{fill:{panel:"url(#topBarGrad)",window:n(r,10),messageBox:n(r,-2)},maskFill:n(r,70),preemptiveFill:o?n(r,-40):n(r,80),height:{panel:32,window:44}},upDownButton:{width:12,height:20,rx:0},window:{fill:"#FFFFFF",scrollSize:17},windowTab:{"font-size":11,width:100,fill:"url(#windowTabGrad)",maskFill:"url(#windowTabMaskGrad)",maskStroke:n(r,75)}},t=$C({element:"linearGradient",id:"taskbarGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,100),appendTo:t}),$C({element:"stop",offset:"4%","stop-color":n(r,-12),appendTo:t}),$C({element:"stop",offset:"96%","stop-color":n(r,-9),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,-60),appendTo:t}),t=$C({element:"linearGradient",id:"windowTabGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n([90,90,90],20),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n([90,90,90],50),appendTo:t}),t=$C({element:"linearGradient",id:"windowTabMaskGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n([90,90,90],20),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n([90,90,90],0),appendTo:t}),t=$C({element:"linearGradient",id:"topBarGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,-2),appendTo:t}),t=$C({element:"linearGradient",id:"alertTopBarGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,-36),appendTo:t}),$C({element:"stop",offset:"10%","stop-color":n(r,-16),appendTo:t}),$C({element:"stop",offset:"95%","stop-color":n(r,-8),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,80),appendTo:t}),t=$C({element:"linearGradient",id:"menuGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,50),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,45),appendTo:t}),t=$C({element:"linearGradient",id:"menubarGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,-4),appendTo:t}),t=$C({element:"radialGradient",id:"radioButtonGrad",cx:"65%",cy:"65%",r:"100%",fx:"65%",fy:"65%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#FFFFFF",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#D0D0D0",appendTo:t}),t=$C({element:"linearGradient",id:"tabGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#C0C0C0",appendTo:t}),$C({element:"stop",offset:"15%","stop-color":"#ECECEC",appendTo:t}),$C({element:"stop",offset:"50%","stop-color":"white",appendTo:t}),t=$C({element:"linearGradient",id:"toolbarGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":o?n(r):n(r,13),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":o?n(r,-6):n(r,6),appendTo:t}),t=$C({element:"linearGradient",id:"statusBarGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,10),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,10),appendTo:t}),t=$C({element:"linearGradient",id:"gridHeaderGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":o?n(r,80):n(r,100),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":o?n(r,20):n(r,88),appendTo:t}),t=$C({element:"linearGradient",id:"highlightDatagridGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#90ECFF",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#80DCFF",appendTo:t}),t=$C({element:"linearGradient",id:"gridRowGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":o?n(r,80):n(r,100),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":o?n(r,40):n(r,92),appendTo:t}),t=$C({element:"linearGradient",id:"toolButtonGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":o?n(r,80):n(r,65),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":o?n(r,40):n(r,50),appendTo:t}),t=$C({element:"linearGradient",id:"toolButtonMaskGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":o?n(r,-1):n(r,40),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":o?n(r,-6):n(r,25),appendTo:t}),t=$C({element:"linearGradient",id:"hTrackGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,-35),appendTo:t}),$C({element:"stop",offset:"12%","stop-color":n(r,78),appendTo:t}),$C({element:"stop",offset:"88%","stop-color":n(r,78),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#FFFFFF",appendTo:t}),t=$C({element:"linearGradient",id:"listItemGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n([100,88,88],-6),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n([100,88,88],-13),appendTo:t}),t=$C({element:"linearGradient",id:"vTrackGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,-35),appendTo:t}),$C({element:"stop",offset:"12%","stop-color":n(r,78),appendTo:t}),$C({element:"stop",offset:"88%","stop-color":n(r,78),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#FFFFFF",appendTo:t}),t=$C({element:"linearGradient",id:"hScrollSliderStrokeGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,74),appendTo:t}),$C({element:"stop",offset:"10%","stop-color":n(r),appendTo:t}),$C({element:"stop",offset:"88%","stop-color":n(r),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,-25),appendTo:t}),t=$C({element:"linearGradient",id:"vScrollSliderStrokeGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,74),appendTo:t}),$C({element:"stop",offset:"10%","stop-color":n(r),appendTo:t}),$C({element:"stop",offset:"88%","stop-color":n(r),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,-25),appendTo:t}),t=$C({element:"linearGradient",id:"buttonMaskGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,10),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,-6),appendTo:t}),t=$C({element:"linearGradient",id:"buttonGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,50),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,20),appendTo:t}),t=$C({element:"linearGradient",id:"neutralButtonMaskGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#F8F8F8",appendTo:t}),$C({element:"stop",offset:"20%","stop-color":"#DADCDE",appendTo:t}),$C({element:"stop",offset:"80%","stop-color":"#DADCDE",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#9EA0A2",appendTo:t}),t=$C({element:"linearGradient",id:"neutralButtonGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#8A8C8E",appendTo:t}),$C({element:"stop",offset:"20%","stop-color":"#B4B6B8",appendTo:t}),$C({element:"stop",offset:"80%","stop-color":"#B4B6B8",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#FFFFFF",appendTo:t}),t=$C({element:"linearGradient",id:"sliderButtonGrad",x1:"0%",y1:"0%",x2:"40%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,50),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,-6),appendTo:t}),t=$C({element:"linearGradient",id:"sliderPatternGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":n(r,20),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,-20),appendTo:t}),e=$C({element:"pattern",id:"sliderPattern",x:2.5,y:2.5,width:5,height:5,patternUnits:"userSpaceOnUse",appendTo:s}),$C({element:"rect",x:0,y:0,width:5,height:5,fill:"url(#sliderPatternGrad)",appendTo:e}),$C({element:"circle",cx:2.5,cy:2.5,r:1.5,fill:n(r),appendTo:e}),t=$C({element:"linearGradient",id:"horScrollSliderGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":o?n(r,-12):n(r,10),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":o?n(r,-15):n(r,2),appendTo:t}),t=$C({element:"linearGradient",id:"vertScrollSliderGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":o?n(r,-12):n(r,12),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":o?n(r,-15):n(r,2),appendTo:t}),t=$C({element:"linearGradient",id:"progressGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"50%","stop-color":"#d00030",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#ffc030",appendTo:t}),t=$C({element:"linearGradient",id:"quickTipGrad",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"10%","stop-color":n(r,100),appendTo:t}),$C({element:"stop",offset:"100%","stop-color":n(r,72),appendTo:t}),t=$C({element:"linearGradient",id:"insetStroke",x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#C0C0C0",appendTo:t}),$C({element:"stop",offset:"49.9%","stop-color":"#C0C0C0",appendTo:t}),$C({element:"stop",offset:"50%","stop-color":"#F0F0F0",appendTo:t}),t=$C({element:"linearGradient",id:"marker1",x1:"0%",y1:"0%",x2:"100%",y2:"75%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#001030",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#FAFAFF",appendTo:t}),t=$C({element:"linearGradient",id:"marker2",x1:"0%",y1:"0%",x2:"100%",y2:"75%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"40%","stop-color":"#001030",appendTo:t}),$C({element:"stop",offset:"66%","stop-color":"#FAFAFF",appendTo:t}),t=$C({element:"linearGradient",id:"marker3",x1:"0%",y1:"0%",x2:"100%",y2:"75%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#003090",appendTo:t}),$C({element:"stop",offset:"94%","stop-color":"#E0F0FF",appendTo:t}),t=$C({element:"linearGradient",id:"LonGutter",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#00040A",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#00040A","stop-opacity":0,appendTo:t}),t=$C({element:"linearGradient",id:"LatGutter",x1:"0%",y1:"0%",x2:"100%",y2:"0%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"0%","stop-color":"#00040A",appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#00040A","stop-opacity":0,appendTo:t}),t=$C({element:"linearGradient",id:"resizeGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:s}),$C({element:"stop",offset:"40%","stop-color":"#FFFFFF","stop-opacity":.05,appendTo:t}),$C({element:"stop",offset:"100%","stop-color":"#000000","stop-opacity":.25,appendTo:t})}},pergola.customColorNames={"nürburgring":"#B8CAD2",city:"#CCD0D4",rustica:"#7B961E",suburban:"#DDFF58",frostica:"#F8FDFE",tropica:"#FF4200",herman:"#5E0200",glockenspiel:"#EDF4F4",black_diamond:"#293032",lightslategray:"rgb(144, 160, 176)",cube:"#F4F4F5",editor:"#E7E7EB",maps:"#E8E9E1"},pergola.skins[skin](),pergola.Class=function(t){this.name=t||"".xmlNameGenerator(),this.id=this.name.toXML()},pergola.extend(pergola.Class.prototype,{x:0,y:0,"font-family":pergola.presentationAttributes.all["font-family"],"font-size":pergola.presentationAttributes.all["font-size"],stroke:pergola.presentationAttributes.all.stroke,registerEvents:function(t,e,i){"string"==typeof e&&(e=[e]);for(var o in e)t.addEventListener(e[o],i||this,!1)},unregisterEvents:function(t,e,i){"string"==typeof e&&(e=[e]);for(var o in e)t.removeEventListener(e[o],i||this,!1)},checkEventsList:function(t){for(var e in this.ev)if(t==this.ev[e])return!0;return!1},setPointerEvents:function(){var t=arguments[0];for(var e in t)t[e].setAttributeNS(null,"pointer-events","all")},removePointerEvents:function(){var t=arguments[0];for(var e in t)t[e].setAttributeNS(null,"pointer-events","none")},absoluteX:function(t){return t.getCTM().e},absoluteY:function(t){return t.getCTM().f},ff_absoluteX:function(){for(var t=this.owner,e=0;void 0!=t;)e+=t.x,t=t.owner;return e},ff_absoluteY:function(){for(var t=this.owner,e=0;void 0!=t;)e+=t.y,t=t.owner;return e},setXYWH:function(t){pergola.attribute(t,{x:this.x,y:this.y,width:this.width,height:this.height})},moveXY:function(t){pergola.attribute(this.target,{x:t.clientX-this.offset.x,y:t.clientY-this.offset.y})},moveByTranslation:function(t){this.target.setAttributeNS(null,"transform","translate("+(t.clientX-this.offset.x)+" "+(t.clientY-this.offset.y)+")")},checkUserFunction:function(t){"string"==typeof this.fn?this[this.fn](t):"function"==typeof this.fn&&this.fn(t)},checkCallback:function(t,e){"string"==typeof e?this[e](t):"function"==typeof e&&e.call(this,t)},memento:function(){var t={obj:this},e=arguments[0];for(var i in e)t[i]=e[i];return t},setContextmenu:function(t,e,i){return"mousedown"==t.type?void(this.checkEventsList("mouseup")||(this.registerEvents(e,"mouseup",this),this.cMenuEvent=!0)):(pergola.contextmenuEnabled=!1,this.checkEventsList("mouseup")||this.unregisterEvents(e,"mouseup",this),this.contextmenu||(this.contextmenu=(new pergola.Contextmenu).build({owner:this,items:i})),void this.contextmenu.open(pergola.mousePoint(t)))},getFiles:pergola.getFiles,getColorpicker:pergola.getColorpicker,find:pergola.find,setPositionToStrokeWidth:function(t){return!t.isEven()/2},sweep:function(t){for(var e in t)delete this[t[e]]},autoScroll:function(){var t=this.owner,e=t.autoscrollValue;this.left?this.owner.ctm.e+=e*(this.owner.ctm.e<-e):this.right&&(this.owner.ctm.e-=e*(this.owner.ctm.e>this.range.minX)),this.up?this.owner.ctm.f+=e*(this.owner.ctm.f<-e):this.down&&(this.owner.ctm.f-=e*(this.owner.ctm.f>this.range.minY)),this.owner.matrixTransformApply(),this.owner.horScrollSliderSync(),this.owner.vertScrollSliderSync(),this.offset=t.getOffset(),this.timer.fn&&this[this.timer.fn]()},zoomBylensToolInit:function(t){var e=this.owner.map?"mapZoomBylensTool":"zoomBylensTool";"editor"==this.owner.type&&this.hideSelectionOnScale(),t.altKey&&(this.scaleDown=!0),pergola.rubberBox.set({user:this,fn:e,point:pergola.mousePoint(t)}),pergola.browser.firefox?pergola.dragarea.resize(this.ff_absoluteX(this.container)+this.x,this.ff_absoluteY(this.container)+this.y,this.visibleW,this.visibleH):pergola.dragarea.resize(this.absoluteX(this.container),this.absoluteY(this.container),this.visibleW,this.visibleH),pergola.dragarea.activate({callback:pergola.rubberBox.update,handle:pergola.rubberBox,offset:this.getOffset(),cursor:this.currentTool.cursor,altCursor:this.currentTool.altCursor,updateCoordinates:!1})},zoomBylensTool:function(){var t=pergola.rubberBox.width;if(pergola.rubberBox.width>0&&pergola.rubberBox.height>0&&(this.scaleDown=!1),this.scaleDown){if(this.scaleDown=!1,this.scaleFactor==this.minScale)return;this.scaleFactor=(this.scaleFactor/2).trim(4),this.scaleFactor<this.minScale&&(this.scaleFactor=this.minScale)}else{if(this.scaleFactor==this.maxScale)return;this.scaleFactor=4>t?(2*this.scaleFactor).trim(4):(this.scaleFactor*(this.visibleW/t)).trim(3),this.scaleFactor>this.maxScale&&(this.scaleFactor=this.maxScale)}this.scale(pergola.rubberBox),"editor"==this.owner.type&&this.redrawOnScale()},mapZoomBylensTool:function(t){var e=this.owner,i=e.map,o=this.ctm,s=pergola.rubberBox,n=i.zoom(),r=polymaps.origin,a={x:o.e+r.x,y:o.f+r.y},l=pergola.mousePoint(t),h={x:l.x-a.x,y:l.y-a.y},p=s.x-a.x,d=s.y-a.y;s.width&&s.height?(i.extent([i.pointLocation({x:p,y:d}),i.pointLocation({x:p+s.width,y:d+s.height})]),i.zoom(parseInt(i.zoom()))):(this.scaleDown?(n=Math.ceil(n)-n-1,this.scaleDown=!1):n=1-n+Math.floor(n),e.centerMap(i.pointLocation(h)),i.zoomBy(n)),n=i.zoom(),e.mapZoomLevelMark(n),e.status&&e.status.zoom(n)},scrollByhandToolInit:function(t){var e=pergola.mousePoint(t);if(this.owner.map){var i={x:e.x-(this.ctm.e+polymaps.origin.x),y:e.y-(this.ctm.f+polymaps.origin.y)};this.owner.status&&this.owner.status.location(this.owner.map.pointLocation(i))}pergola.dragarea.activate({callback:this.scrollByHandTool,handle:this,offset:e,cursor:this.currentTool.cursor,updateCoordinates:!1})},scrollByHandTool:function(t){var e=this.handle,i=e.owner.map,o=pergola.mousePoint(t),s=e.ctm,n=s.e+(o.x-this.offset.x),r=s.f+(o.y-this.offset.y),a=-(e.scaledW-e.visibleW)*(e.scaledW>e.visibleW)|0,l=-(e.scaledH-e.visibleH)*(e.scaledH>e.visibleH)|0;return i?(i.panBy({x:o.x-this.offset.x,y:o.y-this.offset.y}),e.owner.status&&e.owner.status.center(i.center()),void(this.offset=o)):(n>0&&(n=0),r>0&&(r=0),a>n&&(n=a),l>r&&(r=l),s.e=n,s.f=r,e.matrixTransformApply(),e.horScrollSliderSync(),e.vertScrollSliderSync(),void(this.offset=o))},measureByRulerTool:function(t){var e,i,o=this.owner.map,s=pergola.mousePoint(t);if("mousemove"==t.type){i=this.ruler;var n,r,a=o.pointLocation({x:s.x-this.offset.x,y:s.y-this.offset.y}),l=i.geoPoint1.lat,h=i.geoPoint1.lon,p=a.lat,d=a.lon,c=h-d,u=pergola.geo.distance(l,h,p,d),m=-180>c||c>180?" (!longitude range > 180°)":"";pergola.attribute(i.line,{x2:s.x,y2:s.y}),i.valueGroup.setAttributeNS(null,"transform","translate("+(s.x+12)+" "+(s.y-8)+")"),"mi"==o.unit?u=pergola.geo.kmToMi(u):"nmi"==o.unit&&(u=pergola.geo.kmToNmi(u)),n="Km"==o.unit?pergola.geo.formatKm(u):"nmi"==o.unit?u.toFixed(3)+" "+o.unit:pergola.geo.formatMiles(u),i.text.firstChild.data=n+m,e=this.owner.lonToRange(d),i.lon.firstChild.data="Lon: "+e.toFixed(3),i.lat.firstChild.data="Lat: "+a.lat.toFixed(3),r=Math.max.apply(null,[i.text.getComputedTextLength(),i.lon.getComputedTextLength(),i.lat.getComputedTextLength()]),i.box.setAttributeNS(null,"width",r+10),i.text.setAttributeNS(null,"x",r+6)}else if("mouseup"==t.type)this.unregisterEvents(this.transformable,["mousemove","mouseup"]),pergola.systemComponents.removeChild(this.ruler.line),pergola.systemComponents.removeChild(this.ruler.valueGroup),delete this.ruler;else if("mousedown"==t.type){var g,f=polymaps.origin,y=pergola.marker.cross();this.registerEvents(this.transformable,["mousemove","mouseup"]),this.offset={x:this.ctm.e+f.x,y:this.ctm.f+f.y},i=this.ruler={geoPoint1:o.pointLocation({x:s.x-this.offset.x,y:s.y-this.offset.y}),line:$C({element:"line",x1:s.x,y1:s.y,x2:s.x,y2:s.y,stroke:"#00FFFF","marker-start":y,"marker-end":y,"pointer-events":"none",appendTo:pergola.systemComponents}),valueGroup:$C({element:"g",transform:"translate("+(s.x+12)+" "+(s.y-8)+")","pointer-events":"none",appendTo:pergola.systemComponents})},i.box=$C({element:"rect",x:.5,y:-7.5,rx:2,width:1,height:1,fill:"url(#quickTipGrad)",stroke:"#808080",appendTo:i.valueGroup}),i.text=$C({element:"text",x:46,y:5,"font-size":"11px","text-anchor":"end",textNode:"0.00 "+o.unit,appendTo:i.valueGroup}),this.owner.status&&this.owner.status.location(i.geoPoint1),e=this.owner.lonToRange(i.geoPoint1.lon),i.lon=$C({element:"text",x:6,y:16,"font-size":"11px",textNode:"Lon: "+e.toFixed(3),appendTo:i.valueGroup}),i.lat=$C({element:"text",x:6,y:27,"font-size":"11px",textNode:"Lat: "+i.geoPoint1.lat.toFixed(3),appendTo:i.valueGroup}),g=i.valueGroup.getBBox(),pergola.attribute(i.box,{width:g.width,height:g.height+2})}},measureItinerary:function(t){function e(t){return Math.max.apply(null,t)}function i(t){return"mi"==r.unit?t/=1.609344:"nmi"==r.unit&&(t/=1.852),t="Km"==r.unit?pergola.geo.formatKm(t):"nmi"==r.unit?t.toFixed(3)+" "+r.unit:pergola.geo.formatMiles(t)}var o,s,n,r=this.owner.map,a=polymaps.origin,l=pergola.mousePoint(t);if(this.offset={x:this.ctm.e+a.x,y:this.ctm.f+a.y},s=this.itinerary){var h=r.pointLocation({x:l.x-this.offset.x,y:l.y-this.offset.y}),p=s.geoPoint.lat,d=s.geoPoint.lon,c=h.lat,u=h.lon,m=d-u,g=pergola.geo.distance(p,d,c,u);return s.remove(),s.totalDistance+=g,s.warn=-180>m||m>180?" (!longitude range > 180°)":"",s.coordinates.push([h.lon,h.lat]),s.width=e([(i(s.totalDistance)+s.warn).width("11px",0,"bold"),("Lon: "+s.geoPoint.lon.toFixed(4)).width("11px",0,"bold"),("Lat: "+s.geoPoint.lat.toFixed(4)).width("11px",0,"bold")]),s.geoPoint=h,void s.render(r)}n=pergola.marker.dot({radius:24,fill:"#0080FF",stroke:"#FF6000"}),s=this.itinerary={feature:!0,totalDistance:0,geoPoint:r.pointLocation({x:l.x-this.offset.x,y:l.y-this.offset.y}),warn:"",updateUnit:function(t){this.remove(),this.render(t)},remove:function(){r.remove(this.layer),delete this.layer},render:function(t){o=pergola.Window.active().lonToRange(this.geoPoint.lon),this.layer=polymaps.geoJson(this).features([{geometry:{type:"LineString",coordinates:this.coordinates,style:"fill: none; stroke: #808080; stroke-width: 1px; opacity: .35; marker-start:"+n+"; marker-mid: "+n+"; marker-end:"+n+";"}},{geometry:{type:"LineString",coordinates:this.coordinates,style:"fill: none; stroke: #C00000; stroke-width: 2px; stroke-dasharray: 5,2;"}},{geometry:{type:"Point",coordinates:[this.geoPoint.lon,this.geoPoint.lat],elements:[{element:"rect",x:6.5,y:-33.5,rx:2.5,width:this.width+8,height:37,fill:"#F0F0FF",stroke:"#808080",opacity:.5},{element:"text",x:10,y:-22,"font-size":"11px","font-weight":"bold","pointer-events":"none",textNode:i(this.totalDistance)+this.warn},{element:"text",x:10,y:-11,"font-size":"11px","font-weight":"bold",textNode:"Lon: "+o.toFixed(4)},{element:"text",x:10,y:0,"font-size":"11px","font-weight":"bold",textNode:"Lat: "+this.geoPoint.lat.toFixed(4)}]}}]),t.add(this.layer)}},s.coordinates=[[s.geoPoint.lon,s.geoPoint.lat]],s.width=e([("Lon: "+s.geoPoint.lon.toFixed(4)).width("11px",0,"bold"),("Lat: "+s.geoPoint.lat.toFixed(4)).width("11px",0,"bold")]),s.render(r)},zoomTimerInit:function(t){var e=t.type,i=this.owner,o=i.doc,s=this.zoomTimer;if("mousedown"==e)"editor"==i.type&&o.hideSelectionOnScale(),o.zoomStep=1.05,s.initialize({handle:o,callback:this.callback,delay:250,frequence:20});else if("mouseup"==e)o.zoomStep=2,null==s.interval&&this.callback.call(o),s.clear(),"editor"==i.type&&o.redrawOnScale();else if("mouseout"==e){if(null==s.interval)return;s.clear(),"editor"==i.type&&o.redrawOnScale()}},mapZoomTimerInit:function(t){var e=t.type,i=this.owner,o=i.map,s=o.zoomRange(),n=o.zoom();"mousedown"==e?(i.zoomStep=.05,this.zoomTimer.initialize({handle:i,callback:this.callback,delay:250,frequence:30})):("mouseup"==e||"mouseout"==e)&&("mouseup"==e?this.callback==this.mapZoomUpByButton?(this.z=Math.floor(n)+1,this.z>s[1]&&(this.z=s[1])):this.callback==this.mapZoomDownByButton&&(this.z=Math.ceil(n)-1,this.z<s[0]&&(this.z=s[0])):this.z=n,"mouseup"==e&&null==this.zoomTimer.interval?(this.zoomTimer.clear(),o.zoom(this.z)):this.fadeTimer?this.fadeTimer.initialize():this.fadeTimer=pergola.Timer().initialize({handle:this,callback:this.mapZoomFadeout,frequence:30}),i.mapZoomLevelMark(),i.status&&i.status.zoom(this.z))},mapZoomFadeout:function(){var t=this.owner.map.zoom();parseFloat(t)==parseInt(t)&&(this.zoomTimer.clear(),this.fadeTimer.clear(),this.z=null,this.owner.mapZoomLevelMark(t))},mapZoomDownByButton:function(){this.map.zoomBy(-this.zoomStep)},mapZoomUpByButton:function(){this.map.zoomBy(this.zoomStep)},zoomDownByButton:function(){this.scaleFactor!=this.minScale&&(this.scaleFactor=(this.scaleFactor/this.zoomStep).trim(4),this.scaleFactor<this.minScale&&(this.scaleFactor=this.minScale),this.scale())},zoomUpByButton:function(){this.scaleFactor!=this.maxScale&&(this.scaleFactor=(this.scaleFactor*this.zoomStep).trim(4),this.scaleFactor>this.maxScale&&(this.scaleFactor=this.maxScale),this.scale())},quickTipFormat:function(){var t=this.quickTip;"string"==typeof t?pergola.quicktips[t]?this.quickTip=pergola.quicktips[t]:alert(t+pergola.messages.wrongQuickTip):this.quickTip=(new pergola.QuickTip).build(t)},quickTipInit:function(){var t=this.quickTip;this.registerEvents(this.button,"mousemove"),t.owner=this,t.timer?t.timer.initialize():t.timer=pergola.Timer().initialize({handle:t,callback:this.quickTip.show,delay:this.quickTip.delay})},rollover:function(t){this.button.setAttributeNS(null,"fill-opacity","mouseover"==t.type|0),this.image&&this.image.setAttributeNS(null,"opacity","mouseover"==t.type|0),this.text&&this.hasTextEffect&&this.videoInverse(t)},videoInverse:function(t){var e="mouseover"==t.type?this.textFillInverse:this.textFill;this.text.setAttributeNS(null,"fill",e),this.checkmark&&this.checkmark.setAttributeNS(null,"fill",e),this.arrow&&this.arrow.setAttributeNS(null,"fill",e)},buttonSelect:function(t){t.button.setAttributeNS(null,"fill-opacity",1)},buttonDeselect:function(t){t.button.setAttributeNS(null,"fill-opacity",0)},textCenterVertical:function(t,e){return e=parseFloat(e||pergola.Class.prototype["font-size"]),(t+e)/2-e/5},textShow:function(){this.text.setAttributeNS(null,"display","block")},textHide:function(){this.text.setAttributeNS(null,"display","none")},textDataUpdate:function(t){this.text.firstChild.data=t}}),pergola.extend(pergola,{Background:function(){pergola.Background.baseConstructor.call(this,arguments[0])},Button:function(){pergola.Button.baseConstructor.call(this,arguments[0])},Caption:function(){pergola.Caption.baseConstructor.call(this,arguments[0])},CheckBox:function(){pergola.CheckBox.baseConstructor.call(this,arguments[0])},ColorBoxSelector:function(){pergola.ColorBoxSelector.baseConstructor.call(this,arguments[0])},ColorPicker:function(){pergola.ColorPicker.baseConstructor.call(this,arguments[0])},ComboBox:function(){pergola.ComboBox.baseConstructor.call(this,arguments[0])},CommandButton:function(){pergola.CommandButton.baseConstructor.call(this,arguments[0])},Contextmenu:function(){pergola.Contextmenu.baseConstructor.call(this,arguments[0])},ContextmenuItem:function(){pergola.ContextmenuItem.baseConstructor.call(this,arguments[0])},Coordinates:function(){pergola.Coordinates.baseConstructor.call(this,arguments[0])},DataGrid:function(){pergola.DataGrid.baseConstructor.call(this,arguments[0])},DataGridHeader:function(){pergola.DataGridHeader.baseConstructor.call(this,arguments[0])},DataGridLine:function(){pergola.DataGridLine.baseConstructor.call(this,arguments[0])},DialogButton:function(){pergola.DialogButton.baseConstructor.call(this,arguments[0])},Doc:function(){pergola.Doc.baseConstructor.call(this,arguments[0])},Dragarea:function(){pergola.Dragarea.baseConstructor.call(this,arguments[0])},Frame:function(){pergola.Frame.baseConstructor.call(this,arguments[0])},Input:function(){pergola.Input.baseConstructor.call(this,arguments[0])},InputCursor:function(){pergola.InputCursor.baseConstructor.call(this,arguments[0])},Layout:function(){pergola.Layout.baseConstructor.call(this,arguments[0])},Legend:function(){pergola.Legend.baseConstructor.call(this,arguments[0])},ListItem:function(){pergola.ListItem.baseConstructor.call(this,arguments[0])},Menu:function(){pergola.Menu.baseConstructor.call(this,arguments[0])},Menubar:function(){pergola.Menubar.baseConstructor.call(this,arguments[0])},MenuItem:function(){pergola.MenuItem.baseConstructor.call(this,arguments[0])},MenuList:function(){pergola.MenuList.baseConstructor.call(this,arguments[0])},Panel:function(){pergola.Panel.baseConstructor.call(this,arguments[0])},PopupList:function(){pergola.PopupList.baseConstructor.call(this,arguments[0])},PopupListItem:function(){pergola.PopupListItem.baseConstructor.call(this,arguments[0])},Preview:function(){pergola.Preview.baseConstructor.call(this,arguments[0])},Progress:function(){pergola.Progress.baseConstructor.call(this,arguments[0])},QuickTip:function(){pergola.QuickTip.baseConstructor.call(this,arguments[0])},RadioButton:function(){pergola.RadioButton.baseConstructor.call(this,arguments[0])},RubberBox:function(){pergola.RubberBox.baseConstructor.call(this,arguments[0])},Scrollbar:function(){pergola.Scrollbar.baseConstructor.call(this,arguments[0])},ScrollButton:function(){pergola.ScrollButton.baseConstructor.call(this,arguments[0])},ScrollSlider:function(){pergola.ScrollSlider.baseConstructor.call(this,arguments[0])},Selector:function(){pergola.Selector.baseConstructor.call(this,arguments[0])
},Separator:function(){pergola.Separator.baseConstructor.call(this,arguments[0])},Slider:function(){pergola.Slider.baseConstructor.call(this,arguments[0])},StatusBar:function(){pergola.StatusBar.baseConstructor.call(this,arguments[0])},Suffix:function(){pergola.Suffix.baseConstructor.call(this,arguments[0])},Tab:function(){pergola.Tab.baseConstructor.call(this,arguments[0])},TabsDock:function(){pergola.TabsDock.baseConstructor.call(this,arguments[0])},Taskbar:function(){pergola.Taskbar.baseConstructor.call(this,arguments[0])},ToolBar:function(){pergola.ToolBar.baseConstructor.call(this,arguments[0])},ToolButton:function(){pergola.ToolButton.baseConstructor.call(this,arguments[0])},TopBar:function(){pergola.TopBar.baseConstructor.call(this,arguments[0])},UpDownButton:function(){pergola.UpDownButton.baseConstructor.call(this,arguments[0])},Window:function(){pergola.Window.baseConstructor.call(this,arguments[0]||pergola.Window.unnamed())},WindowTab:function(){pergola.WindowTab.baseConstructor.call(this,arguments[0])},WindowTopBar:function(){pergola.WindowTopBar.baseConstructor.call(this,arguments[0])}}),pergola.subclass([pergola.Background,pergola.Button,pergola.CheckBox,pergola.Caption,pergola.ColorBoxSelector,pergola.ColorPicker,pergola.ComboBox,pergola.Contextmenu,pergola.Coordinates,pergola.DataGrid,pergola.DataGridHeader,pergola.DataGridLine,pergola.Doc,pergola.Dragarea,pergola.Frame,pergola.Input,pergola.InputCursor,pergola.Layout,pergola.Legend,pergola.ListItem,pergola.Menu,pergola.Menubar,pergola.MenuItem,pergola.MenuList,pergola.Panel,pergola.PopupList,pergola.Preview,pergola.Progress,pergola.QuickTip,pergola.RadioButton,pergola.RubberBox,pergola.Scrollbar,pergola.ScrollSlider,pergola.Selector,pergola.Separator,pergola.Slider,pergola.StatusBar,pergola.Tab,pergola.TabsDock,pergola.Taskbar,pergola.ToolBar,pergola.TopBar,pergola.Window],pergola.Class),pergola.subclass([pergola.ToolButton,pergola.CommandButton,pergola.WindowTab,pergola.DialogButton,pergola.ScrollButton,pergola.UpDownButton],pergola.Button),pergola.subclass(pergola.ContextmenuItem,pergola.MenuItem),pergola.subclass(pergola.PopupListItem,pergola.ListItem),pergola.subclass(pergola.Suffix,pergola.Caption),pergola.subclass(pergola.WindowTopBar,pergola.TopBar),function(){var t=pergola.extend,e=pergola.presentationAttributes,i=e.background;t(pergola.Background.prototype,{parent:null,width:"100%",height:"100%",fill:i.fill,stroke:i.stroke,opacity:i.opacity,"xlink:href":i["xlink:href"],display:"block","pointer-events":"visiblePainted",preserveAspectRatio:"xMidYMid slice",cursor:"default",build:function(){return pergola.extend(this,arguments[0]),this.parent?(this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.rect=$C({element:"rect",width:this.width,height:this.height,fill:this.fill,stroke:this.stroke,"pointer-events":this["pointer-events"],appendTo:this.container}),this.image=$C({element:"image",x:.5,y:.5,width:this.width,height:this.height,"xlink:href":this["xlink:href"],preserveAspectRatio:this.preserveAspectRatio,display:this.display,opacity:this.opacity,"pointer-events":"none",appendTo:this.container}),this):void alert(pergola.messages.missingParent[0]+this.name+"Background instance")}}),i=e.button,t(pergola.Button.prototype,{fill:i.fill,"fill-opacity":0,stroke:i.stroke,maskFill:i.maskFill,large:i.large,small:i.small,hasVisualEffects:!0,hasTextEffect:!0,textFill:e.text.fill,textFillInverse:e.text.fillInverse,handleEvent:function(t){var e=t.type;if(t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp)return void("mousedown"==e&&pergola.preemptiveIsUp.warn());if(2==t.button&&this.contextMenuItems)return void this.setContextmenu(t,this.button,this.contextMenuItems);if("mouseover"==e?(this.rollover(t),this.quickTip&&(this.quickTipInit(t),this.mouse=pergola.mousePoint(t))):"mousemove"==e?this.mouse=pergola.mousePoint(t):("mousedown"==e||"mouseout"==e)&&(this.quickTip&&(this.quickTip.timer&&this.quickTip.timer.clear(),this.quickTip.hide()),this.selected||"mouseout"!=e||this.rollover(t)),this.ev)for(var i in this.ev)if(this.ev[i]==e){this.checkUserFunction(t);break}},build:function(){pergola.extend(this,arguments[0]);var t,e,i,o,s,n,r,a,l,h,p,d=this.width,c=this.height,u=this.size,m={stroke:this.stroke};if((d||c)&&u)return void alert(pergola.messages.header+this.name+pergola.messages.conflictingProperties+pergola.messages.wrongButton);if(u&&"small"!=u&&"large"!=u)return void alert(pergola.messages.header+this.name+pergola.messages.wrongButtonSize+u);if(d||c?(this.width=d||this.large.width,this.height=c||this.large.height):(d&&c||u)&&"large"!=u?"small"==u&&(this.width=this.small.width,this.height=this.small.height):(this.width=this.large.width,this.height=this.large.height),this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.buttonGroup=$C({element:"g",appendTo:this.container}),this.extra&&(p=this.extra.transform,delete this.extra.transform,pergola.extend(m,this.extra)),this.shape){if("object"!=typeof this.shape)return void alert(pergola.messages.wrongButtonShape);this.mask=pergola.extend({},this.shape),this.button=pergola.extend({},this.shape),pergola.extend(this.mask,m),pergola.extend(this.button,m)}else this.mask=pergola.extend({element:"rect",width:this.width,height:this.height},m),this.button=pergola.extend({element:"rect",width:this.width,height:this.height},m),this.button["stroke-width"]?(h=this.button["stroke-width"],"string"==typeof h&&(h=-1!=h.indexOf("px")?parseInt(h):null)):h=1,h&&(t=this.setPositionToStrokeWidth(h)),t&&(this.button.x=this.mask.x=this.button.y=this.mask.y=t);return this.mask.fill=this.maskFill,this.button.fill=this.fill,this.button["fill-opacity"]=this["fill-opacity"],this.mask.appendTo=this.button.appendTo=this.buttonGroup,this.mask=$C(this.mask),this.button=$C(this.button),p&&(r=p.indexOf("rotate"),-1!=r&&(e="rotate(".length,i=p.substring(r+e,p.indexOf(")",r+e)),o=this.button.getBBox(),s=o.width/2,n=o.height/2,a="rotate("+i+")",l="rotate("+i+" "+s.trim(3)+" "+n.trim(3)+")",p=p.replace(a,l)),this.buttonGroup.setAttributeNS(null,"transform",p)),this.shape&&(o=this.button.getBBox(),this.width=o.width,this.height=o.height),this.registerEvents(this.button,"mousedown"),this.ev&&("string"==typeof this.ev&&(this.ev=[this.ev]),this.registerEvents(this.button,this.ev)),this.hasVisualEffects&&this.registerEvents(this.button,["mouseover","mouseout"]),this.text&&(this.textFill=this.text.fill||this.textFill,this.text=$C(pergola.extend({element:"text",appendTo:this.container},this.text))),this.symbol&&(this.symbol=pergola.symbol.call(this,this.symbol)),this.image&&(this.image=$C(pergola.extend({element:"image",opacity:0,"pointer-events":"none",appendTo:this.container},this.image))),this.quickTip&&this.quickTipFormat(),this.sweep(["size","shape","extra"]),this}}),t(pergola.Caption.prototype,{position:"left","text-anchor":"end",textFill:e.caption.fill,inverse:!1,activator:!0,build:function(){if(pergola.extend(this,arguments[0]),!this.owner)return void alert(pergola.messages.missingOwner+"Caption");var t,i,o,s=this.inverse?e.text.fill:this.textFill;return"right"==this.position?(this["text-anchor"]="start",this.x=this.x||this.owner.container.getBBox().width+12):this.x=this.x||-12,this.element=$C({element:"text",x:this.x,y:this.y,"font-family":this["font-family"],"font-size":this["font-size"],fill:s,"text-anchor":this["text-anchor"],"pointer-events":"none",textNode:this.textNode,appendTo:this.parent}),this.activator&&(t=this.element.getBBox(),i="start"==this["text-anchor"]?this.x-2:this.x-t.width-2,o=this.y-this["font-size"],$C({element:"rect",x:i,y:o,width:t.width+4,height:t.height,fill:"none","pointer-events":"all",appendTo:this.parent})),this}}),i=e.checkBox,t(pergola.CheckBox.prototype,{width:i.width,height:i.height,fill:i.fill,checked:!1,handleEvent:function(t){var e;if(t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp)return void("mousedown"==t.type&&pergola.preemptiveIsUp.warn());if("mousedown"==t.type)this.registerEvents(this.container,["mouseup"]);else if("mouseup"==t.type){if(this.checked){if(this.checked=!1,this.manager)for(var i in this.manager.checked)this.manager.checked[i]==this&&this.manager.checked.splice(i,1);e="none"}else this.checked=!0,this.manager&&this.manager.checked.push(this),e="block";this.unregisterEvents(this.container,["mouseup"]),this.checkmark.setAttributeNS(null,"display",e),this.fn&&this.checkUserFunction(t),this.manager&&this.manager.fn&&this.manager.fn()}},build:function(){return pergola.extend(this,arguments[0]),this.manager&&!this.manager.checked&&(this.manager.checked=[]),this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.registerEvents(this.container,["mousedown"]),$C({element:"rect",x:.5,y:.5,width:this.width,height:this.height,fill:this.fill,stroke:this.stroke,appendTo:this.container}),this.checkmark=pergola.symbol.call(this,{symbol:pergola.symbols.checkmark,x:3,y:3}),this.checkmark=this.checkmark.firstChild,this.checkmark.setAttributeNS(null,"display",this.checked?"block":"none"),this.caption&&(this.caption=(new pergola.Caption).build(pergola.extend(this.caption,{owner:this,parent:this.container}))),this}}),i=e.colorBoxSelector,t(pergola.ColorBoxSelector.prototype,{fill:i.fill,stroke:i.stroke,width:i.width,height:i.height,handleEvent:function(t){if(t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp)return void("mousedown"==t.type&&pergola.preemptiveIsUp.warn());if("mousedown"==t.type){if(pergola.preemptiveIsUp)return;this.registerEvents(this.container,["mouseup"])}else"mouseup"==t.type&&(this.getColorpicker(this.fill),this.unregisterEvents(this.container,["mouseup"]))},build:function(){pergola.extend(this,arguments[0]);var t=this.width,e=this.height;return this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.rect=$C({element:"rect",width:t,height:e,fill:this.fill,appendTo:this.container}),this.registerEvents(this.container,["mousedown"]),$C({element:"path",d:"M1 "+e+"v-"+(e-1)+"h"+(t-1),fill:"none",stroke:"#C0C0C0","stroke-width":2,"pointer-events":"none",appendTo:this.container}),$C({element:"path",d:"M0 "+e+"h"+t+"v-"+e+"l-2 2v"+(e-4)+"h-"+(t-4)+"z",fill:"#E8E8E8","pointer-events":"none",appendTo:this.container}),this.caption&&(this.caption=(new pergola.Caption).build(pergola.extend(this.caption,{owner:this,parent:this.container}))),this}}),t(pergola.ColorPicker.prototype,{spectrum:e.colorpicker.spectrum,width:256,height:256,maxX:255,max:255,mult:6,region:[0,85,170],release:function(){var t=this.RGB.r,e=this.RGB.g,i=this.RGB.b,o=this.toHex(t),s=this.toHex(e),n=this.toHex(i);this.input.hex.value=(o+s+n).toUpperCase(),this.input.r.value=t+"",this.input.g.value=e+"",this.input.b.value=i+"",this.color="#"+this.input.hex.value},spectrumIinitDrag:function(t){var e=pergola.mousePoint(t);return{callback:this.spectrumScan,handle:this,offset:{x:e.x-this.drop.x,y:e.y-this.drop.y},updateCoordinates:!1,cursor:"crosshair"}},spectrumScan:function(t){var e=this.handle,i=e.drop,o=pergola.mousePoint(t);i.x=Math.round(o.x-this.offset.x),i.y=Math.round(o.y-this.offset.y),i.x<0?i.x=0:i.x>e.maxX&&(i.x=e.maxX),i.y<0?i.y=0:i.y>e.max&&(i.y=e.max),e.setDrop()},setDrop:function(){var t=this.drop.x,e=this.drop.y;this.colorIndex=e*this.width+t,this.hue=pergola.color.rgbTable[this.colorIndex],this.RGB.r=this.valueFromBrightness(this.hue[0]),this.RGB.g=this.valueFromBrightness(this.hue[1]),this.RGB.b=this.valueFromBrightness(this.hue[2]),this.newSample.setAttributeNS(null,"fill","rgb("+[this.RGB.r,this.RGB.g,this.RGB.b]+")"),this.brightnessMask.setAttributeNS(null,"stop-color","rgb("+this.hue+")"),this.drop.container.setAttributeNS(null,"transform","translate("+t+" "+e+")"),this.valuesDisplay(this.RGB.r,this.RGB.g,this.RGB.b)},brightnessIinitDrag:function(t){return{callback:this.brightnessScan,handle:this,offset:pergola.mousePoint(t).y-this.needle.y,updateCoordinates:!1}},brightnessScan:function(t){var e=this.handle,i=e.needle;i.y=pergola.mousePoint(t).y-this.offset,i.y<0?i.y=0:i.y>e.max&&(i.y=e.max),e.setBrightness()},setBrightness:function(){this.opacity=this.needle.y/this.max,this.brightness=this.max-this.needle.y,this.needle.container.setAttributeNS(null,"transform","translate(0 "+this.needle.y+")"),this.spectrumMask.setAttributeNS(null,"opacity",this.opacity),this.RGB.r=this.valueFromBrightness(this.hue[0]),this.RGB.g=this.valueFromBrightness(this.hue[1]),this.RGB.b=this.valueFromBrightness(this.hue[2]),this.newSample.setAttributeNS(null,"fill","rgb("+[this.RGB.r,this.RGB.g,this.RGB.b]+")"),this.valuesDisplay(this.RGB.r,this.RGB.g,this.RGB.b)},setByHex:function(t){var e=this.toRGB(t);this.RGB.r=e[0],this.RGB.g=e[1],this.RGB.b=e[2],this.set()},set:function(){var t,e,i,o=Number(this.RGB.r),s=Number(this.RGB.g),n=Number(this.RGB.b),r=[o,s,n],a=o==s&&s==n,l=Math.max.apply(null,r),h=Math.min.apply(null,r),p=(l-h)/this.max*this.mult,d=this.needle,c=0;this.drop.y=a?this.max:Math.round(h*(this.max/l)),l==o?(t=this.region[0],e=s>n):l==s?(t=this.region[1],e=n>o):(t=this.region[2],e=o>s);for(i in r)if(r[i]==l){r.splice(i,1);break}r[1]!=r[0]&&(c=Math.round((Math.max.apply(null,r)-h)/p*(e||-1))),this.drop.x=t+c,this.drop.x<0&&(this.drop.x+=this.maxX),d.y=this.max-l,d.y<0?d.y=0:d.y>this.max&&(d.y=this.max),this.brightness=l,this.opacity=d.y/this.max,this.spectrumMask.setAttributeNS(null,"opacity",this.opacity),this.drop.container.setAttributeNS(null,"transform","translate("+this.drop.x+" "+this.drop.y+")"),d.container.setAttributeNS(null,"transform","translate(0 "+d.y+")"),this.hue=this.hueFromValues([o,s,n]),this.brightnessMask.setAttributeNS(null,"stop-color","rgb("+this.hue+")"),this.newSample.setAttributeNS(null,"fill","rgb("+[o,s,n]+")"),this.valuesDisplay(this.RGB.r,this.RGB.g,this.RGB.b),this.release()},valuesDisplay:function(t,e,i){var o=this.input,s=this.toHex;o.hex.element.firstChild.data=(s(t)+s(e)+s(i)).toLowerCase(),o.r.element.firstChild.data=t+"",o.g.element.firstChild.data=e+"",o.b.element.firstChild.data=i+""},valueFromBrightness:function(t){return parseInt(t/this.max*this.brightness)},hueFromValues:function(t){return this.brightness?[Math.ceil(t[0]/this.brightness*this.max),Math.ceil(t[1]/this.brightness*this.max),Math.ceil(t[2]/this.brightness*this.max)]:[this.max,this.max,this.max]},toHex:function(t){var e=Number(t).toString(16);return e.length>2&&(e="ff"),1==e.length&&(e="0"+e),e},toRGB:function(t){var e=parseInt("0x"+t.substring(0,2)),i=parseInt("0x"+t.substring(2,4)),o=parseInt("0x"+t.substring(4,6));return[e,i,o]},absoluteX:function(t){return t.getCTM().e},absoluteY:function(t){return t.getCTM().f},layout_narrow:function(){var t=this.owner;this.width=256,this.maxX=255,this.mult=6,this.region=[0,85,170],this.spectrum="narrow",this.gamutButton.text.firstChild.data="Wide Spectrum",pergola.color.rgbTablePopulate.basic(),t.resize({x:t.oldX,y:t.oldY,width:500,height:412,ok:{x:240,y:16},cancel:{x:370,y:16}}),this.container.setAttributeNS(null,"transform","translate(32 "+(t.topBar.height+28)+")"),this.sampleGroup.setAttributeNS(null,"transform","translate(336 0)"),pergola.attribute(this.sampleFrame,{width:58,height:58}),pergola.attribute(this.sample,{width:54,height:27}),pergola.attribute(this.newSample,{y:27,width:54,height:27}),this.brightnessBarGroup.setAttributeNS(null,"transform","translate(276 0)"),this.inputGroup.setAttributeNS(null,"transform","translate(336 110)"),this.spectrumFrame1.setAttributeNS(null,"d","M257-1v258h-258"),this.spectrumFrame2.setAttributeNS(null,"d","M-2,258v-260h260l-2 2h-256v256z"),this.svg.removeChild(this.image),this.svg.setAttributeNS(null,"width",this.width),this.image=$C({element:"image",width:this.width,height:this.height,"xlink:href":pergola.path+"lib/palettes/spectrum.png","pointer-events":"none"}),this.svg.insertBefore(this.image,this.spectrumMask),this.spectrumMask.setAttributeNS(null,"width",this.width),this.set()},layout_wide:function(){var t=this.owner;this.width=1536,this.maxX=1535,this.mult=1,this.region=[0,512,1024],this.spectrum="wide",this.gamutButton.text.firstChild.data="Narrow Spectrum",pergola.color.rgbTablePopulate.extended(),t.resize({x:2,width:1552,height:580,ok:{x:40,y:-120},cancel:{x:40,y:-60}}),this.container.setAttributeNS(null,"transform","translate(8 "+(t.topBar.height+8)+")"),this.sampleGroup.setAttributeNS(null,"transform","translate(142 270)"),pergola.attribute(this.sampleFrame,{width:260,height:260}),pergola.attribute(this.sample,{width:256,height:128}),pergola.attribute(this.newSample,{y:128,width:256,height:128}),this.brightnessBarGroup.setAttributeNS(null,"transform","translate(454 270)"),this.inputGroup.setAttributeNS(null,"transform","translate(546 380)"),this.spectrumFrame1.setAttributeNS(null,"d","M1537-1v258h-1538"),this.spectrumFrame2.setAttributeNS(null,"d","M-2,258v-260h1540l-2 2h-1536v256z"),this.svg.removeChild(this.image),this.svg.setAttributeNS(null,"width",this.width),this.image=$C({element:"image",width:this.width,height:this.height,"xlink:href":pergola.path+"lib/palettes/spectrumExtended.png","pointer-events":"none"}),this.svg.insertBefore(this.image,this.spectrumMask),this.spectrumMask.setAttributeNS(null,"width",this.width),this.set()},init:function(){pergola.extend(this,arguments[0]),"wide"==this.spectrum?pergola.color.rgbTablePopulate.extended():pergola.color.rgbTablePopulate.basic(),this.color=pergola.color.convert(this.color,"hex")||"#ffffff",this.sample.setAttributeNS(null,"fill",this.color),this.setByHex(this.color.substring(1)),this.owner.open(),this.owner.fn=this.user.fn},handleEvent:function(t){var e=pergola.mousePoint(t);t.target==this.spectrumMask?(this.drop.x=Math.round(e.x-this.absoluteX(this.drop.container.parentNode)),this.drop.y=Math.round(e.y-this.absoluteY(this.drop.container.parentNode)),this.setDrop(),pergola.dragarea.activate(this.spectrumIinitDrag(t))):t.target==this.brightnessBar?(this.needle.y=e.y-this.absoluteY(this.needle.container.parentNode),this.setBrightness(),pergola.dragarea.activate(this.brightnessIinitDrag(t))):t.target==this.gamutButton.button&&("narrow"==this.spectrum?this.layout_wide():this.layout_narrow())},build:function(){var t,e,i="wide"==this.spectrum,o="M257-1v258h-258",s="M-2,258v-260h260l-2 2h-256v256z",n="lib/palettes/spectrum.png",r="translate(276 0)",a="translate(336 0)",l=58,h=54,p=27,d="translate(336 110)";return pergola.extend(this,arguments[0]),this.x=32,this.y=this.owner.topBar.height+28,this.RGB={},i&&(this.x=8,this.y=this.owner.topBar.height+8,this.width=1536,this.maxX=1535,this.mult=1,this.region=[0,512,1024],o="M1537-1v258h-1538",s="M-2,258v-260h1540l-2 2h-1536v256z",n="lib/palettes/spectrumExtended.png",r="translate(454 270)",a="translate(142 270)",l=260,h=256,p=128,d="translate(546 380)"),this.container=$C({element:"g",transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.spectrumFrame1=$C({element:"path",d:o,fill:"none",stroke:"#F0F0F0","stroke-width":2,appendTo:this.container}),this.spectrumFrame2=$C({element:"path",d:s,fill:"#C0C0C0",appendTo:this.container}),this.svg=$C({element:"svg",id:this.id+"_spectrumGroup",width:this.width,height:this.height,cursor:"crosshair",appendTo:this.container}),this.image=$C({element:"image",width:this.width,height:this.height,"xlink:href":pergola.path+n,"pointer-events":"none",appendTo:this.svg}),this.spectrumMask=$C({element:"rect",width:this.width,height:this.height,fill:"black",appendTo:this.svg}),this.registerEvents(this.spectrumMask,"mousedown"),this.drop={container:$C({element:"g","pointer-events":"none",appendTo:this.svg})},$C({element:"circle",r:7,fill:"none",stroke:"black",appendTo:this.drop.container}),$C({element:"circle",r:8,fill:"none",stroke:"white",appendTo:this.drop.container}),t=this.brightnessBarGroup=$C({element:"g",transform:r,appendTo:this.container}),e=$C({element:"linearGradient",id:"brightnessbar",x1:"0%",y1:"0%",x2:"0%",y2:"100%",gradientUnits:"objectBoundingBox",appendTo:this.container}),this.brightnessMask=$C({element:"stop",id:"brightnessMaskColor",offset:"0%","stop-color":"#ffffff",appendTo:e}),$C({element:"stop",offset:"100%","stop-color":"#000000",appendTo:e}),$C({element:"path",d:"M24-2v260h-26",fill:"#F0F0F0","pointer-events":"none",appendTo:t}),$C({element:"path",d:"M-2,258v-260h26l-2 2h-22v256z",fill:"#C0C0C0","pointer-events":"none",appendTo:t}),$C({element:"rect",width:22,height:256,fill:"url(#brightnessbar)","pointer-events":"none",appendTo:t}),this.needle={x:0,y:0,container:$C({element:"g",id:this.id+"_needleGroup",transform:"translate("+this.x+" "+this.y+")",appendTo:t})},$C({element:"path",d:"M-4,0.5l-4-5v10z",fill:"#303030",appendTo:this.needle.container}),$C({element:"path",d:"M0,0.5l4-5v10z",transform:"translate(26 0)",fill:"#303030",appendTo:this.needle.container}),this.brightnessBar=$C({element:"rect",id:this.id+"_brightnessBar",x:-11,width:42,height:256,fill:"white",opacity:0,appendTo:t}),this.registerEvents(this.brightnessBar,"mousedown"),t=this.sampleGroup=$C({element:"g",transform:a,appendTo:this.container}),this.sampleFrame=$C({element:"rect",x:-2,y:-2,width:l,height:l,fill:"url(#insetStroke)",appendTo:t}),this.sample=$C({element:"rect",width:h,height:p,fill:"white",appendTo:t}),this.newSample=$C({element:"rect",y:p,width:h,height:p,fill:"white",appendTo:t}),this.gamutButton=(new pergola.DialogButton).build({owner:this,parent:this.container,x:0,y:this.height+11,width:84,height:16,"font-size":10,text:"Wide Spectrum"}),t=this.inputGroup=$C({element:"g",transform:d,appendTo:this.container}),this.input={r:(new pergola.Input).build({owner:this,parent:t,callback:{keypress:pergola.Key.keypressPosInt},width:34,caption:{x:-10,textNode:"R"},hasButtons:!0,max:this.max,min:0,maxLength:3,value:this.RGB.r+"",allowEmpty:!1,realTime:!0,target:this.RGB,propName:"r",fn:"set"}),g:(new pergola.Input).build({owner:this,parent:t,callback:{keypress:pergola.Key.keypressPosInt},y:26,width:34,caption:{x:-10,textNode:"G"},hasButtons:!0,max:this.max,min:0,maxLength:3,value:this.RGB.g+"",allowEmpty:!1,realTime:!0,target:this.RGB,propName:"g",fn:"set"}),b:(new pergola.Input).build({owner:this,parent:t,callback:{keypress:pergola.Key.keypressPosInt},y:52,width:34,caption:{x:-10,textNode:"B"},hasButtons:!0,max:this.max,min:0,maxLength:3,value:this.RGB.b+"",allowEmpty:!1,realTime:!0,target:this.RGB,propName:"b",fn:"set"}),hex:(new pergola.Input).build({owner:this,parent:t,callback:{keypress:pergola.Key.keypressHex},y:78,width:50,caption:{x:-10,textNode:"#"},max:16777215,min:0,maxLength:6,value:"ffffff",allowEmpty:!1,lowerCaseHex:!0,message:"This value must be between 0 and FFFFFF.",fn:"setByHex"})},this}}),i=e.comboBox,t(pergola.ComboBox.prototype,{width:i.width,height:i.height,listItemHeight:i.listItemHeight,listMargin:i.listMargin,scrollSize:e.scrollBar.size,resizable:!1,margin:0,paneY:0,selectionHandle:null,selection:null,mousewheel:"scroll",cancelSelection:function(t,e){var i=this.selectionHandle;this.selection="",i&&(i.effects(t),this.registerEvents(i.button,"mouseout",i),i.preview&&i.preview.setAttributeNS(null,"display","none"),this.selectionHandle=null),e&&(this.doc.ctm.e=this.doc.ctm.f=0,this.doc.matrixTransformApply(),this.doc.horScrollSliderSync(),this.doc.vertScrollSliderSync()),this.owner&&(this.owner.validated=!1)},empty:function(){if(this.listGroup&&pergola.removeChildren(this.listGroup),this.list)for(var t in this.list)delete this[this.list[t]]},getListWidth:function(){var t,e,i=[];for(var o in this.list)i.push(this.list[o].width(this["font-size"],this["font-family"]));return t=Math.max.apply(null,i)+2*this.listMargin,e=6+this.vScrollBar.size*(this.list.length*this.listItemHeight>this.height),t<this.width-e&&(t=this.width-e),t},update:function(t){t=t||[];var e,i,o;this.empty(),this.listGroup||(this.listGroup=$C({element:"g",transform:"translate(2 2)","font-size":this["font-size"],"font-family":this["font-family"],appendTo:this.doc.transformable})),this.list=t,this.advanceY=0,e=this.getListWidth();for(i in this.list)o=this.list[i],this[o]=new pergola.ListItem(this.id+"_"+o).build({owner:this,parent:this.listGroup,width:e,string:o});this.doc.updateOnMutation()},build:function(){pergola.extend(this,arguments[0]);var t,i,o,s,n=this.scrollSize;if(this.owner&&!this.x&&(this.x=(this.owner.width-this.width)/2),this.height-=this.height%(this.listItemHeight+2)-4,this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),$C({element:"rect",id:this.id+"_background",x:.5,y:.5,width:this.width-1,height:this.height-1,fill:"white",stroke:this.stroke,appendTo:this.container}),this.doc=new pergola.Doc(this.id+"_doc").build({owner:this,parent:this.container,x:1,y:1}),this.hScrollBar=new pergola.Scrollbar(this.id+"_hScrollBar").buildH({owner:this,parent:this.container,scrollSize:n,scrollTarget:this.doc,symbol:pergola.symbols.arrow.small,step:8}),this.vScrollBar=new pergola.Scrollbar(this.id+"_vScrollBar").buildV({owner:this,parent:this.container,scrollSize:n,scrollTarget:this.doc,symbol:pergola.symbols.arrow.small,step:this.listItemHeight+2}),this.resizeDummy=$C({element:"rect",x:this.width-n-1,y:this.height-n-1,width:n,height:n,fill:e.scrollBar.fill}),this.container.insertBefore(this.resizeDummy,this.hScrollBar.container),this.list){this.listGroup=$C({element:"g",transform:"translate(2 2)","font-size":this["font-size"],"font-family":this["font-family"]}),this.advanceY=0,t=this.getListWidth();for(i in this.list)o=this.list[i],this[o]=new pergola.ListItem(this.id+"_"+o).build({owner:this,parent:this.listGroup,width:t,string:o});this.doc.transformable.appendChild(this.listGroup)}else this.layout&&(s=pergola.extend(this.layout,{owner:this,parent:this.doc.transformable,width:this.layout.width||this.doc.width(),height:this.layout.height||this.doc.height()}),this.layout=(new pergola.Layout).build(s));return this.doc.updateOnMutation(),this}}),i=e.commandButton,t(pergola.CommandButton.prototype,{width:i.width,height:i.height,fill:i.fill,maskFill:i.maskFill,stroke:i.stroke}),t(pergola.Contextmenu,{active:null}),i=e.contextMenu,t(pergola.Contextmenu.prototype,{height:0,"font-size":i["font-size"],fill:i.fill,filter:i.filter,margin:i.margin,advanceY:0,open:function(t){this.container.setAttributeNS(null,"transform","translate("+t.x+" "+t.y+")"),this.parent.appendChild(this.container),pergola.Contextmenu.active=this,window.addEventListener("mousedown",pergola.contextmenuManager.custom,!1)},close:function(){this.parent.removeChild(this.container),pergola.Contextmenu.active=null,window.removeEventListener("mousedown",pergola.contextmenuManager.custom,!1)},build:function(){pergola.extend(this,arguments[0]);var t,e,i,o=pergola.ContextmenuItem.prototype.height,s=[];for(t in this.items)e=this.items[t],this.height+=o+(e.separator?e.separator.height:0),s.push(e.string.width(this["font-size"],this["font-family"]));this.width=Math.max.apply(null,s)+this.margin+16,this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),$C({element:"rect",x:.5,y:.5,width:this.width+5,height:this.height+5,fill:"#FFFFFF",stroke:this.stroke,filter:this.filter,appendTo:this.container}),i=$C({element:"g",id:this.id+"_itemsGroup",transform:"translate(2 2)",appendTo:this.container});for(t in this.items)(new pergola.ContextmenuItem).build(pergola.extend(this.items[t],{owner:this,parent:i,"font-family":this["font-family"],"font-size":this["font-size"],text:{x:this.margin,y:parseInt(this["font-size"])+2,textNode:this.items[t].string,"pointer-events":"none"}}));return this.parent.removeChild(this.container),this}}),t(pergola.ContextmenuItem.prototype,{handleEvent:function(t){var e=this.owner.owner;t.detail>1&&t.preventDefault(),"mousedown"==t.type?t.stopPropagation():"mouseup"==t.type?(this.effects(t),this.owner.close(),e?(e.contextMenuFunction=this.fn,e.checkCallback(t,e.contextMenuFunction)):this.checkUserFunction(t)):this.effects(t)},build:function(){if(pergola.extend(this,arguments[0]),!this.owner)return void alert(pergola.messages.missingOwner+"ContextmenuItem");var t=this.owner,e=1;return this.container=$C({element:"g",id:this.id,transform:"translate(0 "+t.advanceY+")","font-size":this["font-size"],appendTo:this.parent}),this.separator&&(this.separator.build({parent:this.container,type:"horizontal",x:1,y:1,width:t.width}),t.advanceY+=this.separator.height,e=this.separator.height+1,this.text.y+=e),this.button=$C({element:"rect",x:1,y:e,width:t.width,height:this.height,fill:this.fill,opacity:0,appendTo:this.container}),this.registerEvents(this.container,["mouseover","mouseout","mousedown","mouseup"]),this.text=$C(pergola.extend({element:"text","pointer-events":"none",appendTo:this.container},this.text)),t.advanceY+=this.height,this}}),t(pergola.Coordinates.prototype,{"font-size":e.coordinates["font-size"],enable:function(){this.text.setAttributeNS(null,"display","block")},disable:function(){this.text.setAttributeNS(null,"display","none"),this.text.firstChild.data=" "},update:function(t,e){this.text.setAttributeNS(null,"transform","translate("+(t.clientX+6)+" "+(t.clientY-6)+")"),this.text.firstChild.data=e},build:function(){return pergola.extend(this,arguments[0]),this.text=$C({element:"text",id:"pergola_coordinates","font-size":this["font-size"],"pointer-events":"none",textNode:" ",appendTo:this.parent}),this}}),i=e.datagrid,t(pergola.DataGrid.prototype,{headerHeight:i.headerHeight,rowHeight:i.rowHeight,nColumns:i.nColumns,nRows:i.nRows,fill:i.fill,altFill:i.altFill,stroke:i.stroke,highlightFill:i.highlightFill,highlightStroke:i.highlightStroke,gutter:i.gutter,gutterWidth:0,readOnly:!0,savePath:".",permissions:"user",language:pergola.locale,menu:!1,syncMenu:function(){var t,e,i,o={},s=0|(pergola.remote&&!this.readOnly),n=s&&"administrator"==this.permissions,r=!!this.filename,a=s&&"user"==this.permissions,l=this.columns,h={items:{}},p={items:{}};for(t in l)e=l[t],h.items[e.label]={string:e.label,check:!0,target:this,fn:function(){this.target.toggleColumn(this.string)}};for(t in l)e=l[t],p.items[e.label]={string:e.label,target:this,fn:function(){this.target.goToColumn(this.string)}};if(i={file:{title:"File",items:{save:{string:"Save",active:n&&r,target:this,fn:function(){this.target.save()}},saveas:{string:"Save As ...",active:n||a,target:this,fn:function(){this.target.getFiles({title:"Save As ...",ok:"Save",callback:"saveAs",path:this.target.savePath,files:"files"})}},"export":{string:"Export",active:s,submenu:{items:{pdf:{string:"PDF",active:!1,target:this,fn:""},xml:{string:"XML",active:!1,target:this,fn:""}}},separator:new pergola.Separator},closeFile:{string:"Close",fn:function(){this.menuObject.owner.close()}}}},edit:{title:"Edit",items:{undo:{string:"Undo",active:!1,fn:""},redo:{string:"Redo",active:!1,fn:"",separator:new pergola.Separator},cut:{string:"Cut",active:!1,fn:""},copy:{string:"Copy",active:!1,fn:""},paste:{string:"Paste",active:!1,fn:""}}},view:{title:"View",items:{columns:{string:"Columns",submenu:h}}},search:{title:"Search",items:{find:{string:"Find",target:this,fn:function(){this.target.find("search")}},findNext:{string:"Find Next",target:this,fn:function(){this.target.found.length&&this.target.gotoFound(1)}},findPrevious:{string:"Find Previous",target:this,fn:function(){this.target.found.length&&this.target.gotoFound(-1)},separator:new pergola.Separator},gotoCol:{string:"Go To Column",submenu:p},gotoLine:{string:"Go To Line",target:this,fn:function(){var t=this.target.nRows,e=parseInt(Math.abs(prompt("Row number:","")));return isNaN(e)?void alert(pergola.messages.notANumber):1>e||e>t?void alert(pergola.messages.lineNunmberRange+"1 - "+t):void this.target.goToLine(e-1)}}}}},this.menu.length){for(t in this.menu)o[this.menu[t]]=!0;for(t in i)t in o||delete i[t]}this.owner.addMenu(i)},save:function(){var t,e,i,o,s,n={columns:[],rows:[]};for(t in this.columns)i=this.columns[t],n.columns.push({label:i.label,type:i.type,options:i.options,currency:i.currency});
for(t in this.rows){o=this.rows[t],n.rows[t]={};for(e in this.columns)i=this.columns[e],s=i.label,"null"==o[s]?o[s]=null:n.rows[t][s]="date"==i.type?o[s].toJSON():"boolean"==i.type?"true"==o[s]||o[s]==o.cells[s].options[0]?!0:!1:o[s]}pergola.saveJSON(this.savePath,this.filename,n),this.menu&&this.owner.menu.file&&this.owner.menu.file.list.save&&this.owner.menu.file.list.save.activate()},saveAs:function(){var t,e,i=pergola.fileDialog,o=i.comboBox.selection||i.input.value,s=pergola.messages;if(!o)return void(i.validated=!1);/.json/i.test(o)&&(o=o.substring(0,o.lastIndexOf(".")));for(e in this.files)this.files[e]==o+".json"&&(t=!0);return o!=this.filename&&!t||this.savePath!=this.folder?void((!t||confirm(s.overwriteExistingFile[0]+o+".json"+s.overwriteExistingFile[1]))&&(i.validated=!0,this.filename=o,this.save())):"administrator"==this.permissions?void(confirm(s.overwriteCurrentFile)&&(i.validated=!0,this.save())):(alert(s.noSavePermission),void(i.validated=!1))},open:function(){{var t=pergola.fileDialog,e=t.comboBox.selection||t.input.value;pergola.messages}return e?void(t.validated=!0):void(t.validated=!1)},search:function(){return(this.stringData=pergola.findDialog.getData())?(this.doFind(),this.found.length?void this.gotoFound(0):void alert("Not found")):void 0},searchUpdate:function(){if(this.found){var t=this.foundIndex;this.doFind(),this.foundIndex=t>=this.found.length?0:t}},doFind:function(){var t,e,i,o,s,n,r,a=this.stringData;this.found=[],this.foundIndex=0;for(t in this.rows){o=this.rows[t];for(e in this.displayed)i=this.displayed[e].label,n=o[i],s=this.displayed[e].type,"number"==s||"boolean"==s?n=n.toString():"date"==s&&(n=o.cells[i].value),n.length==a.value.length&&a.wholeWord&&(a.regexp=new RegExp(a.value,a.flags)),-1!=(r=n.search(a.regexp))&&(this.found.push({label:i,line:o.index,entry:a.value,textNode:o.cells[i].element.firstChild,start:r,length:a.value.length}),this.stringData=a)}},gotoFound:function(t){var e,i,o,s=window.getSelection();if(this.foundIndex+=t,this.foundIndex==this.found.length)return this.foundIndex=0,void(window.confirm(pergola.messages.nextNotFound[0]+this.found[this.foundIndex].entry+pergola.messages.nextNotFound[1])&&this.gotoFound(0));if(this.foundIndex<0)return this.foundIndex=this.found.length-1,void(window.confirm(pergola.messages.previousNotFound[0]+this.found[this.foundIndex].entry+pergola.messages.previousNotFound[1])&&this.gotoFound(0));e=this.found[this.foundIndex],i=e.textNode;try{s.removeAllRanges()}catch(n){}this.goToColumn(e.label),this.goToLine(e.line),o=document.createRange(),o.selectNodeContents(i),o.setStart(i,e.start),o.setEnd(i,e.start+e.length),s.addRange(o)},goToLine:function(t){var e=this.owner.doc;this.rows[t].line.select(),e.ctm.f=-(this.rows[t].y*e.scaleFactor),e.matrixTransformApply(),e.transformUpdate()},goToColumn:function(t){var e,i=this.owner.doc,o=!1;for(e in this.columns)if(t==this.columns[e].label){o=!0;break}o?(this.columns[e].header.select(),i.ctm.e=-(this.columns[e].x*i.scaleFactor),i.matrixTransformApply(),i.transformUpdate()):alert(pergola.messages.noSuchColumn+name+'"')},toggleColumn:function(t){for(var e in this.ordered)if(this.ordered[e].label==t){if("block"==this.ordered[e].display){this.ordered[e].header.container.setAttributeNS(null,"display",this.ordered[e].display="none"),this.owner.menu.search.list.gotoCol.list[t].deactivate();break}this.ordered[e].header.container.setAttributeNS(null,"display",this.ordered[e].display="block"),this.owner.menu.search.list.gotoCol.list[t].activate();break}this.setDisplayed(),this.setColumnsOffset(),this.searchUpdate()},removeColumn:function(t){if(confirm(pergola.messages.deleteColumn)){var e,i,o,s=this.columns,n=this.rows,r=t.title,a=this.owner.menu.view.list.columns.list,l=this.owner.menu.search.list.gotoCol.list;for(delete t.contextmenu,o=0;o<s.length;o++)if(s[o].label==r){i=s[o];break}for(i.header.parent.removeChild(i.header.container),s.splice(o,1),o=0;o<n.length;o++)e=n[o],e.group.removeChild(e.cells[r].container),delete e.cells[r];for(o=0;o<this.ordered.length;o++)if(this.ordered[o].label==r){this.ordered.splice(o,1);break}this.setDisplayed(),this.setColumnsOffset(),this.searchUpdate(),a[r].parent.removeChild(a[r].container),delete a[r],delete a.items[r],a.update(),l[r].parent.removeChild(l[r].container),delete l[r],delete l.items[r],l.update()}},removeRow:function(){confirm(pergola.messages.deleteRow)&&(this.nRows=this.rows.length)},setDisplayed:function(){this.displayed=[];for(var t in this.ordered)"block"==this.ordered[t].display&&this.displayed.push(this.ordered[t])},setColumnsOffset:function(){{var t,e,i,o=0;this.ordered.length}for(t in this.rows)for(e in this.rows[t].cells)this.rows[t].cells[e].container.setAttributeNS(null,"display","none");for(t in this.displayed){i=this.displayed[t],i.x=i.header.x=o,i.header.container.setAttributeNS(null,"transform","translate("+o+" 0)");for(e in this.rows)pergola.attribute(this.rows[e].cells[i.label].container,{transform:"translate("+o+" 0)",display:"block"});o+=i.width}},redrawOnScale:function(t){this.gutterPositionOnScroll(t),this.headerPositionOnScroll(t),this.gutter&&this.dummy.setAttributeNS(null,"transform","scale("+(this.scaleFactor=t.scaleFactor)+")")},gutterPositionOnScroll:function(t){this.gutter&&this.gutterGroup.setAttributeNS(null,"transform","translate("+-t.ctm.e/t.scaleFactor+" "+this.headerHeight+")")},headerPositionOnScroll:function(t){this.headerGroup.setAttributeNS(null,"transform","translate("+this.gutterWidth+" "+-t.ctm.f/t.scaleFactor+")")},getColumnSelectionFrameData:function(t){var e=this.headerHeight,i=this.height-e;return"M0,"+e+"v"+i+"M"+t+","+e+"v"+i},getRowSelectionFrameData:function(t){var e=this.gutterWidth,i=this.width-e;return"M"+e+",0h"+i+"M"+e+","+t+"h"+i},deselect:function(){this.deselectColumn(),this.deselectRow()},deselectColumn:function(){this.columnSelectionFrame.setAttributeNS(null,"display","none"),this.currentColumn&&this.currentColumn.header.box.setAttributeNS(null,"fill",this.currentColumn.header.fill)},deselectRow:function(){this.rowSelectionFrame.setAttributeNS(null,"display","none"),this.currentRow&&this.currentRow.line.box.setAttributeNS(null,"fill",this.currentRow.line.fill)},sortAscending:function(t,e){switch(e){case"number":this.rows.sort(function(e,i){return e[t]-i[t]});break;case"date":this.rows.sort(function(e,i){return e[t]-i[t]});break;default:this.rows.sort(function(e,i){var o=e[t].toLowerCase(),s=i[t].toLowerCase();return s>o?-1:o>s?1:0})}this.sortApply()},sortDescending:function(t,e){switch(e){case"number":this.rows.sort(function(e,i){return i[t]-e[t]});break;case"date":this.rows.sort(function(e,i){return i[t]-e[t]});break;default:this.rows.sort(function(e,i){var o=e[t].toLowerCase(),s=i[t].toLowerCase();return s>o?1:o>s?-1:0})}this.sortApply()},sortApply:function(){var t,e,i,o,s;for(t in this.rows){o=this.rows[t],s=o.y=t*o.height,i=Number(t).isEven()?this.fill:this.altFill,o.group.setAttributeNS(null,"transform","translate(0 "+s+")");for(e in o.cells)o.cells[e].rect.setAttributeNS(null,"fill",i);o.line.text.firstChild.data=Number(t)+1,o.line.container.setAttributeNS(null,"transform","translate(0 "+s+")")}this.reIndex(),this.searchUpdate(),this.currentRow&&this.goToLine(this.currentRow.index)},reIndex:function(){for(var t in this.rows)this.rows[t].index=Number(t)},createRows:function(t){var e,i,o,s,n,r,a,l,h,p="auto"==this.rowHeight?1:this.rowHeight,d=parseInt(this["font-size"]),c=this.textCenterVertical(p,d),u=this.transY;for(e=t.start;e<t.end;e++){n=this.rows[e],n.y=u,o=parseInt(e).isEven()?this.fill:this.altFill,n.group=$C({element:"g",transform:"translate(0 "+u+")",appendTo:this.container});for(i in this.columns)s=this.columns[i],l=s.label,h=s.type,r=n.cells[l],this.readOnly?(r.container=$C({element:"g",transform:"translate("+s.x+" 0)",appendTo:n.group}),r.rect=$C({element:"rect",x:-.5,y:-.5,width:s.width,height:p,fill:o,stroke:this.stroke,appendTo:r.container}),r.element=$C({element:"text",x:5,y:c,textNode:r.value,appendTo:r.container})):(a={owner:this,parent:n.group,type:s.type,options:s.options,locale:this.language,radixChar:this.radixChar,x:s.x,tY:c,width:s.width,height:p,fill:o,stroke:this.stroke,strokeInside:!1,target:n,propName:l},"number"==h?pergola.extend(a,{format:!0,callback:{keypress:pergola.Key.keypressNum}}):"date"==h&&pergola.extend(a,{format:!0,empty:!0}),r.build(a));this.gutter&&(n.line=(new pergola.DataGridLine).build({owner:this,row:n,parent:this.gutterGroup,width:this.gutterWidth,y:u,height:p,textNode:parseInt(e)+1,tY:c})),u+=p}if(this.buffered&&t!=this.buffered[0]||(this.parent.appendChild(this.container),this.parent.appendChild(this.headerGroup),this.gutter&&this.parent.appendChild(this.gutterGroup)),"auto"==this.rowHeight){var m,g,f=[];for(u=this.transY,e=t.start;e<t.end;e++){n=this.rows[e],m=n.cells,g=n.line;for(i in this.columns)f.push(m[this.columns[i].label].container.getBBox().height);p=n.height=g.height=Math.ceil(Math.max.apply(null,f)+1),c=this.textCenterVertical(p,d),u=n.y=e*p,n.group.setAttributeNS(null,"transform","translate(0 "+u+")"),this.gutter&&(g.container.setAttributeNS(null,"transform","translate(0 "+u+")"),g.box.setAttributeNS(null,"height",p),g.text.setAttributeNS(null,"y",c));for(i in m)r=m[i],r.rect.setAttributeNS(null,"height",p),r.element.setAttributeNS(null,"y",c),r.tY=c}}this.owner.doc.updateOnMutation(),t==this.buffered[0]&&(this.rendered=!0),this.owner.preview.update(),this.transY=u},render:function(){this.buffered?(this.createRows(this.buffered[0]),this.timer=pergola.Timer().initialize({handle:this,callback:function(){if(this.rendered){this.timer.clear();for(var t=1;t<this.buffered.length;t++)this.createRows(this.buffered[t])}},frequence:100,destroy:"timer"})):this.createRows({start:0,end:this.nRows})},handleEvent:function(){},build:function(){var t,e,i,o,s,n,r,a,l,h,p=0,d=0,c=0,u=Math.round(this.textCenterVertical(this.headerHeight,parseInt(this["font-size"])));if(this.radixChar=pergola.radixChar[this.language],this.files=[],this.binding.constructor==String){var m=this.binding.substring(0,this.binding.lastIndexOf("/"));this.folder=m.substring(m.lastIndexOf("/")+1),this.filename=this.binding.substring(this.binding.lastIndexOf("/")+1,this.binding.lastIndexOf("."))}if(this.nColumns=this.columns.length,this.nRows=this.rows.length,this.transY=0,this.buffered=!1,this.scaleFactor=this.owner.doc.scaleFactor,this.nRows>50&&(this.buffered=[],this.buffered[0]={start:0,end:50},this.buffered[1]={start:50,end:this.nRows}),this.currentColumn=this.currentRow=this.currentCell=null,this.ordered=[],this.displayed=[],this.exclude=this.exclude||[],this.readOnly)for(p=this.columns.length-1;p>=0;p--)for(d in this.exclude)this.columns[p].label==this.exclude[d]&&this.columns.splice(p,1);this.gutter&&(this.gutterWidth=(this.nRows+"").width(this["font-size"])+4,this.gutterWidth<16&&(this.gutterWidth=16),this.gutterGroup=$C({element:"g",transform:"translate("+this.x+" "+this.headerHeight+")","text-anchor":"middle","font-family":this["font-family"],"font-size":this["font-size"]}),this.dummy=$C({element:"rect",x:-.5,y:-.5,width:this.gutterWidth,height:this.headerHeight,fill:pergola.presentationAttributes.datagridHeader.fill,stroke:pergola.presentationAttributes.datagridHeader.stroke,appendTo:this.parent.parentNode})),this.container=$C({element:"g",id:this.id,transform:"translate("+this.gutterWidth+" "+this.headerHeight+")","font-family":this["font-family"],"font-size":this["font-size"]}),this.headerGroup=$C({element:"g",transform:"translate("+this.gutterWidth+" 0)","text-anchor":"middle","font-family":this["font-family"],"font-size":this["font-size"]});for(p in this.columns){t=this.columns[p],o=t.label,s=t.type,n=t.options,"boolean"==s&&(n=n||["true","false"]),r=o.toString().width(this["font-size"],this["font-family"]),a=[];for(d in this.rows)e=this.rows[d],e.index=Number(d),0==p&&(e.cells={}),i=e.cells[o]=this.readOnly?{}:new pergola.Input,i.value=e[o],null===e[o]?i.value=e[o]="null":"date"==s?(e[o]=new Date(e[o]),i.value=pergola.DTF?new Intl.DateTimeFormat(this.language,t.options).format(e[o]):e[o].toDateString()):"number"==s?i.value=pergola.NF?new Intl.NumberFormat(this.language,t.options).format(e[o]):e[o].toLocaleString(this.language,t.options):"boolean"==s&&(i.value=e[o]=e[o]?n[0]:n[1]),a.push(i.value.toString().width(this["font-size"],this["font-family"]));l=t.width=Math.max(Math.max.apply(null,a),r)+32,t.index=Number(p),t.x=c,t.display=t.display||"block",t.header=new pergola.DataGridHeader(t.label).build({owner:this,column:t,parent:this.headerGroup,title:t.label,type:t.type,x:c,width:l,height:this.headerHeight,tY:u,index:Number(p)}),this.ordered[p]=t,"block"==t.display&&this.displayed.push(t),c+=l}return this.render(),this.menu&&this.syncMenu(),this.customMenus&&this.owner.addMenu(this.customMenus),h=this.container.getBBox(),this.height=h.height,this.width=h.width,this.columnSelectionFrame=$C({element:"path",d:this.getColumnSelectionFrameData(1),fill:"none",stroke:this.highlightStroke,"stroke-width":2,display:"none","pointer-events":"none"}),this.rowSelectionFrame=$C({element:"path",d:this.getRowSelectionFrameData(1),fill:"none",stroke:this.highlightStroke,"stroke-width":2,display:"none","pointer-events":"none"}),this.owner.vScrollBar.step=isNaN(this.rowHeight)?17:this.rowHeight,this},buildEmpty:function(){}}),i=e.datagridHeader,t(pergola.DataGridHeader.prototype,{width:i.width,height:i.height,fill:i.fill,stroke:i.stroke,sorted:0,release:function(t){var e,i,o,s=t.clientX-this.parent.getScreenCTM().e,n=this.owner.ordered,r=this.owner.rows,a=!1,l=!0;if(pergola.user.removeChild(this.ghost.container),delete this.ghost,this.timer&&this.timer.clear(),"mouseout"!=t.type){if(s<this.x*this.owner.scaleFactor){for(e=0;e<this.index;e++)if(s<n[e+1].x*this.owner.scaleFactor){a=n.splice(this.index,1),n.splice(e,0,a[0]);break}l=!1}else if(s>this.x*this.owner.scaleFactor){for(e=n.length-1;e>this.index;e--)if(s>n[e].x*this.owner.scaleFactor){a=n.splice(this.index,1),n.splice(e,0,a[0]);break}l=!1}if(this.select(),a&&!l){s=0,this.owner.setDisplayed();for(e in n)n[e].index=n[e].header.index=Number(e);for(e in this.owner.displayed){o=this.owner.displayed[e],o.x=o.header.x=s,o.header.container.setAttributeNS(null,"transform","translate("+s+" 0)");for(i in r)r[i].cells[o.label].container.setAttributeNS(null,"transform","translate("+s+" 0)");s+=o.width}}}},select:function(){this.owner.deselectColumn(),this.owner.rowSelectionFrame.setAttributeNS(null,"display","none"),pergola.attribute(this.box,{fill:this.owner.highlightFill}),this.parent.appendChild(this.container),this.container.appendChild(this.owner.columnSelectionFrame),this.owner.columnSelectionFrame.setAttributeNS(null,"display","block"),this.owner.columnSelectionFrame.setAttributeNS(null,"d",this.owner.getColumnSelectionFrameData(this.width-1)),this.owner.currentColumn=this.column},autoScrollLeft:function(){var t=this.timer.target,e=t.ctm,i=t.autoscrollValue;return e.e>=0?void this.timer.clear():(e.e+=i,e.e>0&&(e.e=0),t.matrixTransformApply(),t.horScrollSliderSync(),void this.owner.gutterPositionOnScroll(t))},autoScrollRight:function(){var t=this.timer,e=t.target,i=e.ctm,o=e.autoscrollValue,s=t.min;return i.e<s?void t.clear():(i.e-=o,i.e<s&&(i.e=s),e.matrixTransformApply(),e.horScrollSliderSync(),void this.owner.gutterPositionOnScroll(e))},move:function(t){var e=this.handle,i=e.ghost;t.clientX<this.X+e.owner.gutterWidth+20?e.timer||(e.timer=pergola.Timer().initialize({handle:e,callback:e.autoScrollLeft,target:this.doc,frequence:0,destroy:"timer"})):t.clientX>this.X+this.doc.visibleW-20?e.timer||(e.timer=pergola.Timer().initialize({handle:e,callback:e.autoScrollRight,target:this.doc,min:this.doc.scrollRange().minX,frequence:0,destroy:"timer"})):(e.timer&&e.timer.clear(),i.x+=t.clientX-this.offset,i.container.setAttributeNS(null,"transform","translate("+i.x+" "+i.y+")")),this.offset=t.clientX},sort:function(){var t,e;for(t in this.owner.columns)e=this.owner.columns[t].header,e!=this&&(e.sorted=0,e.desc.setAttributeNS(null,"display","none"),e.asc.setAttributeNS(null,"display","none"));switch(this.sorted){case 0:case this.desc:this.sorted=this.asc,this.desc.setAttributeNS(null,"display","none"),this.asc.setAttributeNS(null,"display","block"),this.owner.sortAscending(this.title,this.type);break;case this.asc:this.sorted=this.desc,this.asc.setAttributeNS(null,"display","none"),this.desc.setAttributeNS(null,"display","block"),this.owner.sortDescending(this.title,this.type)}},handleEvent:function(t){{var e=pergola.Window.active(),i=e.doc,o=i.scaleFactor;pergola.mousePoint(t)}if(!pergola.preemptiveIsUp){if(2==t.button)return void this.setContextmenu(t,this.box,{sortAZ:{string:"Sort Ascending",fn:function(){this.sorted=this.desc,this.sort()}},sortZA:{string:"Sort Descending",fn:function(){this.sorted=this.asc,this.sort()},separator:new pergola.Separator},hide:{string:"Hide",fn:function(){this.owner.toggleColumn(this.title),this.owner.owner.menu.view.list.columns.list[this.title].uncheck()}},remove:{string:"Delete",fn:function(){this.owner.removeColumn(this)}}});if("mouseup"==t.type)this.sort();else if("mousedown"==t.type){var s=Math.round(this.container.getScreenCTM().e)-Math.round(pergola.doc.getScreenCTM().e),n=Math.round(this.container.getScreenCTM().f)-Math.round(pergola.doc.getScreenCTM().f);this.owner.deselectColumn(),this.owner.rowSelectionFrame.setAttributeNS(null,"display","none"),this.ghost={x:s,y:n,container:$C({element:"g",transform:"translate("+s+" "+n+")",opacity:.5,appendTo:pergola.user})},$C({element:"rect",x:-.5,y:-.5,width:this.width*o,height:this.height*o,fill:this.owner.highlightFill,stroke:this.stroke,appendTo:this.ghost.container}),$C({element:"text",x:this.width/2*o,y:this.tY*o,"font-size":this["font-size"]*o,"text-anchor":"middle",textNode:this.title,appendTo:this.ghost.container}),pergola.dragarea.resize(e.x,e.y,e.width,e.height).activate({handle:this,callback:this.move,doc:i,X:i.container.getScreenCTM().e,offset:t.clientX,updateCoordinates:!1})}}},build:function(){if(pergola.extend(this,arguments[0]),!this.owner)return void alert(pergola.messages.missingOwnerDatagrid+"DataGridHeader");var t=this.width,e=this.title.width();return this["font-size"]=this.owner["font-size"],this.container=$C({element:"g",transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.box=$C({element:"rect",x:-.5,y:-.5,width:t,height:this.height,fill:this.fill,stroke:this.stroke,appendTo:this.container}),this.text=$C({element:"text",x:t/2,y:this.tY,textNode:this.title,appendTo:this.container}),this.asc=$C({element:"path",d:"M"+t/2+",23l5,5h-10z",fill:"#80C0F0",display:"none",appendTo:this.container}),this.desc=$C({element:"path",d:"M"+t/2+",28l5,-5h-10z",fill:"#80C0F0",display:"none",appendTo:this.container}),this.sortTouch=$C({element:"rect",x:(t-e)/2,y:8,width:e,height:this.height-8,fill:"none",appendTo:this.container}),this.registerEvents(this.sortTouch,"mouseup",this),this.registerEvents(this.box,"mousedown",this),this}}),i=e.datagridLine,t(pergola.DataGridLine.prototype,{fill:i.fill,stroke:i.stroke,release:function(){},select:function(){this.owner.columnSelectionFrame.setAttributeNS(null,"display","none"),this.owner.deselectRow(),pergola.attribute(this.box,{fill:this.owner.highlightFill}),this.parent.appendChild(this.container),this.container.appendChild(this.owner.rowSelectionFrame),pergola.attribute(this.owner.rowSelectionFrame,{display:"block",d:this.owner.getRowSelectionFrameData(this.height-1)}),this.owner.currentRow=this.row},move:function(){},handleEvent:function(t){pergola.preemptiveIsUp||"mouseup"==t.type&&this.select(t)},build:function(){return pergola.extend(this,arguments[0]),this.container=$C({element:"g",transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.box=$C({element:"rect",x:-.5,y:-.5,width:this.width,height:this.height,fill:this.fill,stroke:this.stroke,appendTo:this.container}),this.text=$C({element:"text",x:this.width/2,y:this.tY,textNode:this.textNode,"pointer-events":"none",appendTo:this.container}),this.registerEvents(this.box,"mouseup",this),this.sweep(["width","height","tY","textNode"]),this}}),i=e.dialogButton,t(pergola.DialogButton.prototype,{rx:i.rx,width:i.width,height:i.height,hasTextEffect:!1,build:function(){if(pergola.extend(this,arguments[0]),!this.owner&&!this.fn)return void alert(pergola.messages.missingHandler+"DialogButton");var t,e={width:this.width,height:this.height,rx:this.rx,fill:this.fill,"fill-opacity":0,stroke:this.stroke},i={width:this.width,height:this.height,rx:this.rx,fill:this.maskFill};return this.extra&&pergola.extend(e,this.extra),t=this.setPositionToStrokeWidth(e["stroke-width"]||1),t&&(i.y=i.x=e.y=e.x=t),this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.mask=$C(pergola.extend({element:"rect",appendTo:this.container},i)),this.button=$C(pergola.extend({element:"rect",appendTo:this.container},e)),this.hasVisualEffects&&this.registerEvents(this.button,["mouseover","mouseout"]),this.owner&&this.registerEvents(this.button,"mouseup",this.owner),this.ev&&("string"==typeof this.ev&&(this.ev=[this.ev]),this.registerEvents(this.button,this.ev)),this.text=$C({element:"text",x:this.width/2,y:this.height/2+4,"font-family":this["font-family"],"font-size":this["font-size"],fill:this.textFill,"text-anchor":"middle","pointer-events":"none",textNode:this.text,appendTo:this.container}),this.extra&&delete this.extra,this}}),t(pergola.Doc.prototype,{parent:null,scaleFactor:1,maxScale:64,minScale:.03125,autoscrollValue:6,width:function(){return this.owner.width-2*this.owner.margin-2},height:function(){var t=this.owner;return t.height-this.owner.margin-2-t.paneY-(t.hasStatus?t.status.height:0)},wRatio:function(){return this.scaledW/this.owner.hScrollBar.range},hRatio:function(){return this.scaledH/this.owner.vScrollBar.range},getVisibleCenter:function(){return{x:(this.owner.hScrollBar.slider.pos*this.wRatio()+this.visibleW/2)/this.scaleFactor,y:(this.owner.vScrollBar.slider.pos*this.hRatio()+this.visibleH/2)/this.scaleFactor}},zoomPointIsCenter:function(){return{x:this.scaledW>this.visibleW?this.visibleW/2:this.scaledW/2,y:this.scaledH>this.visibleH?this.visibleH/2:this.scaledH/2}},zoomPointIsMouse:function(t){return{x:t.x-(this.owner.x+this.x),y:t.y-(this.owner.y+this.y)}},centerCanvas:function(){this.ctm.e=-parseInt((this.canvas.width-this.width())/2),this.ctm.f=-parseInt((this.canvas.height-this.height())/2),this.matrixTransformApply()},matrixTransformApply:function(){var t=this.ctm,e="matrix("+t.a+" "+t.b+" "+t.c+" "+t.d+" "+t.e+" "+t.f+")";this.transformable.setAttributeNS(null,"transform",e)},updateOnMutation:function(){var t=this.owner;"map"!=this.owner.type&&(this.docBgResizable&&pergola.attribute(this.background,{width:1,height:1}),this.canvas.width=this.transformable.getBBox().width,this.canvas.height=this.transformable.getBBox().height),this.scaledW=this.canvas.width*this.scaleFactor,this.scaledH=this.canvas.height*this.scaleFactor,this.visibleW=this.width(),this.visibleH=this.height(),this.transformUpdate(),"clone"in t&&!t.datagrid&&t.preview.update()},transformUpdate:function(){var t=this.owner,e=t.resizable,i=t.hScrollBar,o=t.vScrollBar,s=i.size-1,n=this.width(),r=this.height(),a=this.ctm;if(this.scrollBarsDisplay(),i.extent=n-s*(e|o.visible)+!e*!o.visible-i.margins,o.extent=r-s*(e|i.visible)+!e*!i.visible-o.margins,this.horScrollSliderSync(),this.vertScrollSliderSync(),i.updateHor(this.x,this.y+r-s-1),o.updateVert(this.x+n-s-1,this.y),e){if(t.map){var l=t.map.size();a.e=-parseInt((l.x-this.width())/2),a.f=-parseInt((l.y-this.height())/2)}else Math.abs(a.e)>this.scaledW-this.visibleW&&(a.e=-Math.ceil(this.scaledW-this.visibleW)),Math.abs(a.f)>this.scaledH-this.visibleH&&(a.f=-Math.ceil(this.scaledH-this.visibleH)),a.e>0&&(a.e=0),a.f>0&&(a.f=0);pergola.attribute(this.container,{width:n,height:r}),this.setBackground(),t.transformUpdate(n,r)}this.resizeButtonDisplay(),this.matrixTransformApply()},append:function(){var t=arguments[0],e=t.container||this.transformable;t.resetScale&&(this.scaleFactor=1,this.scale()),t.merge||this.flush(e),e.appendChild(t.newdoc),this.updateOnMutation()},flush:function(t){pergola.removeChildren(t),t==this.transformable&&(this.background=$C({element:"rect",id:this.id+"_background",width:this.width(),height:this.height(),fill:this.fill,appendTo:t}))},setBackground:function(){this.docBgResizable&&pergola.attribute(this.background,{width:this.scaledW<this.visibleW?this.visibleW/this.scaleFactor:this.canvas.width,height:this.scaledH<this.visibleH?this.visibleH/this.scaleFactor:this.canvas.height})},scale:function(t){t=t?this.zoomPointIsMouse(t):this.zoomPointIsCenter();var e,i,o,s,n={x:t.x-this.ctm.e,y:t.y-this.ctm.f},r=this.scaledW/n.x,a=this.scaledH/n.y;this.scaledW=this.canvas.width*this.scaleFactor,this.scaledH=this.canvas.height*this.scaleFactor,e=this.scaledW/r*-1+t.x*(pergola.rubberBox.width<2),i=this.scaledH/a*-1+t.y*(pergola.rubberBox.height<2),o=-(this.scaledW-this.visibleW),s=-(this.scaledH-this.visibleH),this.ctm.e=parseInt(e>o?e:o*(0>o|0)),this.ctm.f=parseInt(i>s?i:s*(0>s|0)),this.ctm.e>0&&(this.ctm.e=0),this.ctm.f>0&&(this.ctm.f=0),this.ctm.a=this.ctm.d=this.scaleFactor,this.scrollBarsDisplay(),this.horScrollSliderSync(),this.vertScrollSliderSync(),this.resizeButtonDisplay(),this.setBackground(),this.matrixTransformApply(),this.owner.status&&this.owner.status.zoom(this.scaleFactor),this.owner.datagrid&&this.owner.datagrid.redrawOnScale(this)},horScrollSliderSync:function(){var t,e=this.owner.hScrollBar,i=e.slider;e.page=this.visibleW-e.step,this.owner.datagrid&&(e.page-=this.owner.datagrid.headerHeight),e.range=e.extent-e.sliderClearance,t=this.wRatio(),"navigation"==e.scrollType?(i.size=i.width,i.pos=this.canvas.width/t/2):(i.size=this.visibleW/t,i.size<i.minSize&&(i.size=i.minSize),i.pos=this.ctm.e/t*-1),i.max=e.range-i.size,i.pos<0&&(i.pos=0),i.pos>i.max&&(i.pos=i.max),i.container.setAttributeNS(null,"transform","translate("+Math.round(i.pos)+" 0)"),i.bar.setAttributeNS(null,"width",Math.round(i.size))},vertScrollSliderSync:function(){var t,e=this.owner.vScrollBar,i=e.slider;e.page=this.visibleH-e.step,this.owner.datagrid&&(e.page-=this.owner.datagrid.gutterWidth),e.range=e.extent-e.sliderClearance,t=this.hRatio(),"navigation"==e.scrollType?(i.size=i.height,i.pos=this.canvas.height/t/2):(i.size=this.visibleH/t,i.size<i.minSize&&(i.size=i.minSize),i.pos=this.ctm.f/t*-1),i.max=e.range-i.size,i.pos<0&&(i.pos=0),i.pos>i.max&&(i.pos=i.max),i.container.setAttributeNS(null,"transform","translate(0 "+Math.round(i.pos)+")"),i.bar.setAttributeNS(null,"height",Math.round(i.size))},resizeButtonDisplay:function(){var t=this.owner,e=t.resizeBtn;return t.resizeDummy?void t.resizeDummy.setAttributeNS(null,"opacity",t.hScrollBar.visible|t.vScrollBar.visible):(e.container.setAttributeNS(null,"transform","translate("+(t.width-e.x)+" "+(t.height-e.y-(t.status?t.status.height:0))+")"),void e.button.setAttributeNS(null,"opacity",t.hScrollBar.visible|t.vScrollBar.visible))},scrollBarsDisplay:function(){var t=this.owner,e=t.hScrollBar,i=t.vScrollBar;e.visible=this.visibleW<this.scaledW?!0:!1,i.visible=this.visibleH<this.scaledH?!0:!1,this.visibleW=this.width()-t.vScrollBar.size*i.visible,this.visibleH=this.height()-t.hScrollBar.size*e.visible,e.container.setAttributeNS(null,"display",e.visible?"block":"none"),i.container.setAttributeNS(null,"display",i.visible?"block":"none")},dblclick:function(t){t.preventDefault();var e,i=this.owner,o=i.map,s=this.ctm,n=polymaps.origin,r=o.zoom(),a=pergola.mousePoint(t);r=t.shiftKey?Math.ceil(r)-r-1:1-r+Math.floor(r),e={x:a.x-(s.e+n.x),y:a.y-(s.f+n.y)},i.centerMap(o.pointLocation(e)),o.zoomBy(r),r=o.zoom(),i.mapZoomLevelMark(r),i.status&&i.status.zoom(r)},mousewheel:function(t){if(this.owner.mousewheel){var e,i,o="editor"==this.owner.type,s=this.owner.datagrid,n=t.wheelDelta/40||-t.detail;t.preventDefault(),"zoom"==this.owner.mousewheel?(o&&this.hideSelectionOnScale(),this.scaleFactor=this.scaleFactor*(n/30+1),this.scaleFactor>this.maxScale&&(this.scaleFactor=this.maxScale),this.scaleFactor<this.minScale&&(this.scaleFactor=this.minScale),this.scale(pergola.mousePoint(t)),o&&this.redrawOnScale()):"scroll"==this.owner.mousewheel&&(e=this.ctm.f+=10*n,i=-(this.scaledH-this.visibleH),this.ctm.f=parseInt(e>i?e:i*(0>i|0)),this.ctm.f>0&&(this.ctm.f=0),this.matrixTransformApply(),s&&s.headerPositionOnScroll(this),this.vertScrollSliderSync())}},zoomFromValue:function(t){this.scaleFactor=parseFloat(t/100),this.scale(),"editor"==this.owner.type&&this.redrawOnScale()},overflow:function(t,e,i){return t=Number(t),e=e||this.minScale,i=i||this.maxScale,{isOut:t>i||e>t,message:"This value must be between "+e+"% and "+i+"%"}},scrollRange:function(){return{minX:-Math.round((this.scaledW-this.visibleW)*(this.scaledW>this.visibleW)),minY:-Math.round((this.scaledH-this.visibleH)*(this.scaledH>this.visibleH))}},getOffset:function(){return pergola.browser.firefox?{x:this.ff_absoluteX()+this.x+this.ctm.e,y:this.ff_absoluteY()+this.y+this.ctm.f}:{x:this.absoluteX(this.container)+this.ctm.e,y:this.absoluteY(this.container)+this.ctm.f}},handleEvent:function(t){var e=t.type,i=this.currentTool;return t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp?void("mousedown"==e&&pergola.preemptiveIsUp.warn()):2==t.button&&t.target==this.background&&this.contextMenuItems?void this.setContextmenu(t,this.background,this.contextMenuItems):("keydown"==e?(t.preventDefault(),18==t.keyCode&&pergola.setCursor(this.container,i.altCursor)):"keyup"==e&&(t.preventDefault(),18==t.keyCode&&pergola.setCursor(this.container,i.cursor)),void("mouseover"==e?i&&i.altCursor&&(document.documentElement.addEventListener("keydown",this,!1),document.documentElement.addEventListener("keyup",this,!1)):"mouseout"==e?(document.documentElement.removeEventListener("keydown",this,!1),document.documentElement.removeEventListener("keyup",this,!1)):"mousedown"==e?(i&&(i.prevent&&t.preventDefault(),this[i.fn](t)),this.owner.map&&2==t.detail&&this.dblclick(t)):"mouseup"==e?i&&this[i.fn](t):"mousemove"==e?i&&i.actOnCanvas&&(i.prevent&&t.preventDefault(),this[i.fn](t)):("mousewheel"==e||"DOMMouseScroll"==e)&&this.mousewheel(t)))},build:function(){if(pergola.extend(this,arguments[0]),!this.owner)return void alert(pergola.messages.missingOwner+"Doc");if(!this.parent)return void alert(pergola.messages.missingParent[0]+this.name);var t=this.scaledW=this.width(),e=this.scaledH=this.height();return this.ctm={a:1,b:0,c:0,d:1,e:0,f:0},this.fill="editor"==this.owner.type?"white":"none",this.canvas=this.owner.canvas||{width:t,height:e},this.selection=[],this.container=$C({element:"svg",id:this.id,x:this.x,y:this.y,width:t,height:e,appendTo:this.parent}),this.transformable=$C({element:"g",id:this.id+"_transformable",appendTo:this.container}),"map"!=this.owner.type&&(this.background=$C({element:"rect",id:this.id+"_background",width:this.canvas.width,height:this.canvas.height,fill:this.fill,"pointer-events":"all",appendTo:this.transformable}),this.registerEvents(this.container,["mousewheel","DOMMouseScroll"])),this.registerEvents(this.container,["mousedown","mouseover","mouseout"]),this}}),t(pergola.Dragarea.prototype,{width:"100%",height:"100%",fill:"none",updateCoordinates:!0,cursor:"default",activate:function(){if(arguments[0]){var t,e=arguments[0];this.userProps={};for(t in e)t in this||(this.userProps[t]=e[t]);return pergola.extend(this,arguments[0]),this.setPointerEvents([this.rect]),pergola.setCursor(this.rect,this.cursor),this.registerEvents(this.rect,["mouseup","mouseout","mousemove"]),this}},release:function(t){var e,i=this.handle;this.unregisterEvents(this.rect,["mouseup","mouseout","mousemove"]),this.removePointerEvents([this.rect]),this.updateCoordinates&&(i.x=t.clientX-this.offset.x,i.y=t.clientY-this.offset.y),i&&i.release&&i.release(t),this.reset(),this.cursor="default",pergola.setCursor(this.rect,this.cursor),this.updateCoordinates=!0;for(e in this.userProps)delete this[e];delete this.userProps,pergola.preventMousedownDefault=!1
},resize:function(t,e,i,o){return this.x=t,this.y=e,this.width=i,this.height=o,this.setXYWH(this.rect),this},reset:function(){this.x=0,this.y=0,this.width="100%",this.height="100%",this.setXYWH(this.rect)},handleEvent:function(t){t.preventDefault(),"mousemove"==t.type?this.callback(t):("mouseup"==t.type||"mouseout"==t.type)&&this.release(t)},build:function(){return pergola.extend(this,arguments[0]),this.parent=pergola.systemComponents,this.rect=$C({element:"rect",id:this.id,width:this.width,height:this.height,fill:this.fill,"pointer-events":"none",appendTo:this.parent}),this}}),i=e.frame,t(pergola.Frame.prototype,{width:i.width,height:i.height,rx:i.rx,fill:i.fill,"fill-opacity":i["fill-opacity"](),stroke:i.stroke,"stroke-opacity":i["stroke-opacity"](),filter:"none",release:function(){this.registerEvents(this.rect,["mouseover","mouseout","mousemove"]),this.owner.release&&this.owner.release()},initDrag:function(){var t=this.owner;if(!t.isFull)return"editor"==t.type&&(t.scaleBar.container.setAttributeNS(null,"display","none"),t.compass.container.setAttributeNS(null,"display","none")),{callback:this.callback,handle:this,target:t,offset:this.offset,updateCoordinates:!1,cursor:this.cursor}},resizeN:function(t){this.target.resizeN(t,this.offset.y)},resizeS:function(t){this.target.resizeS(t,this.offset.y)},resizeE:function(t){this.target.resizeE(t,this.offset.x)},resizeW:function(t){this.target.resizeW(t,this.offset.x)},resizeNE:function(t){this.target.resizeN(t,this.offset.y),this.target.resizeE(t,this.offset.x)},resizeNW:function(t){this.target.resizeN(t,this.offset.y),this.target.resizeW(t,this.offset.x)},resizeSE:function(t){this.target.resizeS(t,this.offset.y),this.target.resizeE(t,this.offset.x)},resizeSW:function(t){this.target.resizeS(t,this.offset.y),this.target.resizeW(t,this.offset.x)},handleEvent:function(t){var e=t.target,i=t.type,o=this.owner,s=pergola.mousePoint(t),n=s.x,r=s.y;return t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp?void("mousedown"==i&&pergola.preemptiveIsUp.warn()):void("mouseover"==i||"mousemove"==i?(this.north=this.east=this.south=this.west=!1,this.offset={x:0,y:0},n<=o.x+8?(this.offset.x=n-o.x,this.west=!0):n>=o.x+o.width-8&&(this.offset.x=o.x+o.width-n,this.east=!0),r<=o.y+8?(this.offset.y=r-o.y,this.north=!0):r>=o.y+o.height-8&&(this.offset.y=o.y+o.height-r,this.south=!0),this.north&&this.west?(this.cursor="nw-resize",e.setAttributeNS(null,"cursor",this.cursor),this.callback=this.resizeNW):this.north&&this.east?(this.cursor="ne-resize",e.setAttributeNS(null,"cursor",this.cursor),this.callback=this.resizeNE):this.south&&this.west?(this.cursor="sw-resize",e.setAttributeNS(null,"cursor",this.cursor),this.callback=this.resizeSW):this.south&&this.east?(this.cursor="se-resize",e.setAttributeNS(null,"cursor",this.cursor),this.callback=this.resizeSE):this.north?(this.cursor="n-resize",e.setAttributeNS(null,"cursor",this.cursor),this.callback=this.resizeN):this.east?(this.cursor="e-resize",e.setAttributeNS(null,"cursor",this.cursor),this.callback=this.resizeE):this.south?(this.cursor="s-resize",e.setAttributeNS(null,"cursor",this.cursor),this.callback=this.resizeS):this.west&&(this.cursor="w-resize",e.setAttributeNS(null,"cursor",this.cursor),this.callback=this.resizeW)):"mouseout"==i?(e.setAttributeNS(null,"cursor","default"),this.north=this.east=this.south=this.west=!1,this.offset.x=this.offset.y=0):(this.unregisterEvents(this.rect,["mouseover","mouseout","mousemove"]),pergola.dragarea.activate(this.initDrag())))},build:function(){pergola.extend(this,arguments[0]);var t,e;return this.owner?(t=e=this.setPositionToStrokeWidth(this["stroke-width"]||1),this.rect=$C({element:"rect",id:this.id,x:t,y:e,rx:this.rx,width:this.width,height:this.height,fill:this.fill,"fill-opacity":this["fill-opacity"],stroke:this.stroke,"stroke-opacity":this["stroke-opacity"],filter:this.filter,appendTo:this.parent}),this.owner&&this.owner.resizable&&this.registerEvents(this.rect,["mousedown","mouseover","mouseout","mousemove"]),this):void alert(pergola.messages.missingOwner+"Frame")}}),i=e.input,t(pergola.Input.prototype,{width:i.width,height:i.height,fill:i.fill,stroke:i.stroke,"font-family":0,"font-size":0,hasButtons:!1,realTime:!1,keypressCallback:pergola.Key.keypress,lowerCaseHex:!1,tX:5,tY:0,strokeInside:!0,cursor:!0,format:!1,locale:pergola.locale,allowEmpty:!0,empty:!1,setValue:function(){return this.lowerCaseHex&&(this.value=this.value.toLowerCase()),this.value.length>this.maxLength?void(this.value=this.value.substring(0,this.value.length-1)):(this.element.firstChild.data=this.value,void(this.cursor&&this.inputCursor.setPosition()))},setByButton:function(){this.owner[this.fn](this.value)},increment:function(){this.value++,this.value>this.max&&(this.value=this.max),this.value+="",this.target&&(this.target[this.propName]=this.value),this.element.firstChild.data=this.value,this.realTime&&this.setByButton()},decrement:function(){this.value--,this.value<this.min&&(this.value=this.min),this.value+="",this.target&&(this.target[this.propName]=this.value),this.element.firstChild.data=this.value,this.realTime&&this.setByButton()},reset:function(){this.value=this.element.firstChild.nodeValue=this.baseValue},overflow:function(){if(this.owner.overflow)return this.owner.overflow(this.value,this.min,this.max);var t=this.keypressCallback==pergola.Key.keypressHex?pergola.hexToDecimal(this.value):parseFloat(this.value),e=pergola.messages.outOfRange;return{isOut:t>this.max||t<this.min,message:this.message||e[0]+this.min+e[1]+this.max}},format_number:function(){this.element.firstChild.data=Number(this.value).toLocaleString(this.locale,this.options)},format_date:function(){""!=this.value&&(this.target[this.propName]=new Date(this.value),this.value=pergola.DTF?new Intl.DateTimeFormat(this.locale,this.options).format(this.target[this.propName]):this.value.toDateString(),this.element.firstChild.data=this.value)},endInput:function(){var t=pergola.Window.active(),e=this.owner.constructor==pergola.Panel,i=this.owner==pergola.colorpicker,o=this.keypressCallback==pergola.Key.keypressNum||this.keypressCallback==pergola.Key.keypressInt||this.keypressCallback==pergola.Key.keypressPos||this.keypressCallback==pergola.Key.keypressPosInt||this.keypressCallback==pergola.Key.keypressHex?this.overflow():!1;if(t&&t.undoManager&&t.undoManager.register(),this.value)o.isOut?(this.value>this.max?this.value=this.max:this.value<this.min&&(this.value=this.min),o.message+="\nClosest value inserted.",this.target&&(this.target[this.propName]=this.value),this.element.firstChild.data=this.value+"",this.key.warn&&alert(o.message),arguments[0]||(i?this.owner.owner.validated=!0:e&&(this.owner.validated=!1))):this.target&&(this.target[this.propName]="number"==this.type?this.value.unformatNumber(this.radixChar||pergola.radixChar[pergola.locale]):this.value);else if(!this.allowEmpty)return this.value=this.baseValue,void this.reset();this.format&&this["format_"+this.type](),this.fn&&this.owner[this.fn](this.value),this.owner.map&&this.owner.map.add(this.owner.interact)},handleEvent:function(t){t.stopPropagation();var e,i=t.target,o=t.type,s=pergola.Window.active(),n=pergola.Key.active;if(pergola.Menu.active&&pergola.Menu.handle.close(t),pergola.Contextmenu.active&&pergola.Contextmenu.active.close(),pergola.preemptiveIsUp)return t.detail>0&&t.preventDefault(),void("mousedown"==o&&pergola.preemptiveIsUp.warn());if(i==this.rect||i==this.element)if("mousedown"==t.type){if(this.registerEvents(this.svg,["mouseup"]),n){if(n==this.key)return;n.release()}}else if("mouseup"==t.type){if(this.unregisterEvents(this.svg,["mouseup"]),n){if(n==this.key)return;n.release()}s&&s.undoManager&&s.undoManager.disable(),this.baseValue=this.value,this.empty?this.value=this.element.firstChild.data="":"number"==this.type&&(this.value=this.element.firstChild.data=this.value.unformatNumber(this.radixChar||pergola.radixChar[pergola.locale]).toString()),this.owner.map&&this.owner.map.remove(this.owner.interact),e={handle:this,warn:!0,destroy:"key"},this.callback&&(this.keypressCallback=this.callback.keypress,e.callback=this.callback),this.printShortcut=!(this.keypressCallback==pergola.Key.keypressPos||this.keypressCallback==pergola.Key.keypressPosInt||this.keypressCallback==pergola.Key.keypressHex),this.key=(new pergola.Key).register(e)}},build:function(){pergola.extend(this,arguments[0]);var t,e,i=this.strokeInside?1:-1,o=this.width;return this.owner=this.owner||this,this.fontSize=parseInt(this["font-size"]||this.owner["font-size"]||this.constructor.superClass["font-size"]),t="auto"==this.height?Math.ceil(1.5*this.fontSize).oddToEven():this.height,this.tY=this.tY||this.textCenterVertical(t,this.fontSize),this.lowerCaseHex&&(this.value=this.value.toLowerCase()),"baseValue"in this||(this.baseValue=this.value),this.container=$C({element:"g",transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.svg=$C({element:"svg",appendTo:this.container}),this.svg.isInput=!0,e={element:"rect",x:.5*i,y:.5*i,width:this.width,height:t,fill:this.fill,appendTo:this.svg},"none"!=this.stroke&&(e.stroke=this.stroke),this.rect=$C(e),e={element:"text",x:this.tX,y:this.tY,textNode:this.value,appendTo:this.svg},this["font-family"]&&(e["font-family"]=this["font-family"]),this["font-size"]&&(e["font-size"]=this["font-size"]),this.element=$C(e),this.registerEvents(this.svg,["mousedown"]),this.hasButtons&&(t/=2,o+=4,this.inc=(new pergola.UpDownButton).build({owner:this,parent:this.container,x:o,height:t,symbol:{symbol:pergola.symbols.arrow.tiny.up,x:4},realTime:this.realTime,callback:"increment"}),this.dec=(new pergola.UpDownButton).build({owner:this,parent:this.container,x:o,y:t,height:t,symbol:{symbol:pergola.symbols.arrow.tiny.down,x:4},realTime:this.realTime,callback:"decrement"}),o+=this.inc.width),this.caption&&(this.caption=(new pergola.Caption).build(pergola.extend(this.caption,{owner:this,activator:!1,y:this.tY,parent:this.container}))),this.suffix&&(this.suffix=(new pergola.Suffix).build(pergola.extend(this.suffix,{owner:this,parent:this.container,x:o+3+(0|this.suffix.x),y:this.tY}))),this}}),t(pergola.InputCursor.prototype,{visibility:"visible",blinkRate:e.inputCursor.blinkRate,blink:function(){this.visibility="visible"==this.visibility?"hidden":"visible",this.bar.setAttributeNS(null,"visibility",this.visibility)},setPosition:function(){var t=this.user.tX+this.user.element.getComputedTextLength()+.5;pergola.attribute(this.bar,{x1:t,x2:t})},remove:function(){this.timer.clear(),this.user.container.removeChild(this.bar),delete this.user.inputCursor},init:function(){pergola.extend(this,arguments[0]);var t=this.user.fontSize||this.user["font-size"];return this.bar=$C({element:"line",x1:this.user.tX,y1:this.user.tY+.3*t,x2:this.user.tX,y2:this.user.tY-t,stroke:"black",appendTo:this.user.container}),this.setPosition(),this.timer=pergola.Timer().initialize({handle:this,callback:this.blink,frequence:this.blinkRate,destroy:"timer"}),this}}),t(pergola.Layout.prototype,{build:function(){return pergola.extend(this,arguments[0]),this.owner?(this[this.type](),this):void alert(pergola.messages.missingOwner+"Layout")},table:function(){var t,e,i,o,s,n=this.owner,r=this.attributes||{},a=r["stroke-width"]||1;for(this.x=this.x||0,this.y=this.y||0,r.fill=r.fill||"white",n.cells=[],this.cellWidth=Math.round((this.width+2*a)/this.cols)-this.spacing,this.cellHeight=Math.round((this.height+2*a)/this.rows)-this.spacing,r.width=this.cellWidth,r.height=this.cellHeight,a&&"string"==typeof a&&(a=-1!=a.indexOf("px")?parseInt(a):null),a&&(t=this.setPositionToStrokeWidth(a)),t&&(r.y=r.x=t),s=$C({element:"g",id:this.id+"_table",transform:"translate("+this.x+" "+this.y+")"}),e=0;e<this.rows;e++)for(i=0;i<this.cols;i++)o=$C({element:"g",transform:"translate("+(this.cellWidth+this.spacing)*i+" "+(this.cellHeight+this.spacing)*e+")",appendTo:s}),$C(pergola.extend({element:"rect",appendTo:o},r)),n.cells.push(o);this.fn&&this.checkUserFunction(),this.parent.appendChild(s)},combobox:function(){var t=pergola.extend({},{owner:this.owner,x:this.x,y:this.y,width:this.width,height:this.height,parent:this.parent,list:this.list,layout:this.layout,mousewheel:this.mousewheel});pergola.extend(t,this.props),this.owner.comboBox=new pergola.ComboBox(this.owner.id+"_comboBox").build(t),this.fn&&this.checkUserFunction()},tabbed:function(){var t,e,i,o=this.owner;o.tabs=this.tabs,o.tabAdvanceX=o.margin;for(e in o.tabs)t=o.tabs[e],t.active&&(i=e),o[e]=new pergola.Tab(o.id+"_"+e),pergola.extend(o[e],t),o[e].build({owner:o,parent:o.topBar.container,x:o.tabAdvanceX,y:o.topBar.height+1}),o.tabAdvanceX+=o[e].width;o.topBar.container.appendChild(o[i].container)},message:function(){var t=this.owner;t.messageGroup=$C({element:"g","font-size":12,transform:"translate(20 60)","pointer-events":"none",appendTo:t.container})},findDialog:function(){var t=this.owner;t.input=(new pergola.Input).build({owner:t,parent:t.container,x:54,y:52,width:280,caption:{x:-10,textNode:"Find:"},maxLength:32,value:""}),t.caseCheckbox=(new pergola.CheckBox).build({owner:t,parent:t.container,x:56,y:100,checked:!1,caption:{position:"right",y:12,textNode:"Match Case","font-size":12}}),t.wholeWordsCheckbox=(new pergola.CheckBox).build({owner:t,parent:t.container,x:56,y:120,checked:!1,caption:{position:"right",y:12,textNode:"Whole Words Only","font-size":12}})},fileDialog:function(){var t=this.owner;t.comboBox=new pergola.ComboBox(this.owner.id+"_comboBox").build({owner:t,parent:t.container,x:140,y:this.owner.topBar.height+12,width:300,height:200,list:[],updateDependencies:function(){var t=this.owner.input;t.element.firstChild.data=t.value=this.selection}}),t.input=(new pergola.Input).build({owner:t,parent:t.container,x:140,y:250,width:300,caption:{x:-10,textNode:"File Name:"},value:""})}}),t(pergola.Legend.prototype,{display:"block","font-size":e.legend["font-size"],toggleOn:function(){this.container.setAttributeNS(null,"display",this.display="block")},toggleOff:function(){this.container.setAttributeNS(null,"display",this.display="none")},move:function(t,e){this.container.setAttributeNS(null,"transform","translate("+t+" "+e+")")},build:function(){pergola.extend(this,arguments[0]);var t,e,i,o,s,n,r,a,l,h,p,d=0,c=this.textOffset||8,u=this.x||this.y?{transform:"translate("+this.x+" "+this.y+")"}:{},m={};this.textAttributes&&pergola.extend(m,this.textAttributes),m["font-size"]=m["font-size"]||this["font-size"],t=parseInt(m["font-size"]),e=t,i=this.vSpacing||e/2,this.container=$C(pergola.extend({element:"g",id:this.id,appendTo:this.parent},u)),o=$C({element:"g",appendTo:this.container}),s=$C(pergola.extend({element:"g",appendTo:this.container},m));for(a in this.legend){l=this.legend[a],"string"==typeof l.caption&&(l.caption=[l.caption]),this[a]=$C({element:"text",y:d,"pointer-events":"none",appendTo:s});for(h in l.caption)$C({element:"tspan",x:0,dy:e,textNode:l.caption[h],appendTo:this[a]});if(l.art)if(l.art.image)n=l.art.image,$C({element:"image",x:n.x||0,y:n.y||d+e-n.height,width:n.width,height:n.height,"xlink:href":n.url,appendTo:o});else for(p in l.art.elements)$C(pergola.extend(l.art.elements[p],{transform:"translate(0 "+(d+e)+")",appendTo:o}));d+=e*++h+i}return r=o.getBBox(),s.setAttributeNS(null,"transform","translate("+(r.width+c)+" 0)"),this.container.setAttributeNS(null,"display",this.display),this}}),i=e.listItem,t(pergola.ListItem.prototype,{fill:i.fill,maskFill:i.maskFill,textFill:"black",textFillInverse:"white",effects:function(t){this.button.setAttributeNS(null,"opacity","mouseover"==t.type|0),this.videoInverse(t)},handleEvent:function(t){if(t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp)return void("mousedown"==t.type&&pergola.preemptiveIsUp.warn());if("mousedown"==t.type)this.registerEvents(this.button,"mouseup");else if("mouseover"==t.type||"mouseout"==t.type)this.effects(t),this.fn&&this.checkUserFunction(t);else if("mouseup"==t.type){var e=this.owner,i=e.owner;e.selectionHandle!=this&&e.cancelSelection(t),e.selection=this.string,this.unregisterEvents(this.button,"mouseout"),e.selectionHandle=this,this.owner.updateDependencies&&this.owner.updateDependencies(t),2==t.detail&&(e.fn?e.checkUserFunction(t):i&&(i.fn?i.checkUserFunction(t):i.user&&(i.user.checkCallback||(i.user.checkCallback=this.checkCallback),i.user.checkCallback(t,i.callback))),e.cancelSelection(t),i&&i.close&&i.close(t))}},build:function(){if(pergola.extend(this,arguments[0]),!this.owner)return void alert(pergola.messages.missingOwner+"ListItem");var t=this.owner,e=t.listItemHeight,i=this.x||this.owner.listMargin,o=this.textCenterVertical(e,t["font-size"]),s=t.advanceY||0;return this.container=$C({element:"g",id:this.id,transform:"translate(0 "+s+")",appendTo:this.parent}),$C({element:"rect",width:this.width,height:e,fill:this.maskFill,appendTo:this.container}),this.button=$C({element:"rect",width:this.width,height:e,fill:this.fill,opacity:0,appendTo:this.container}),this.registerEvents(this.button,["mouseover","mouseout"]),this.registerEvents(this.button,"mousedown"),this.text=$C({element:"text",x:i,y:o,"font-size":t["font-size"],"font-family":t["font-family"],"pointer-events":"none",textNode:this.string,appendTo:this.container}),"advanceY"in t&&(t.advanceY+=e+2),this}}),t(pergola.Menu,{active:!1,handle:null}),i=e.menu,t(pergola.Menu.prototype,{"font-size":i["font-size"],fill:i.fill,stroke:i.stroke,rx:i.rx,textFill:e.text.fill,close:function(t){var e,i;this.list.close(t);for(e in this.owner.menu)i=this.owner.menu[e],this.registerEvents(i.button,"mouseout",i);this.button.setAttributeNS(null,"opacity",0),window.removeEventListener("mousedown",this,!1),pergola.Menu.opacity=.5,pergola.Menu.active=!1},handleEvent:function(t){if(t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp)return void("mousedown"==t.type&&pergola.preemptiveIsUp.warn());var e,i,o,s=t.target,n=t.type,r=this.owner;if(s==this.button){if("mouseover"==n)s.setAttributeNS(null,"opacity",pergola.Menu.opacity),pergola.Menu.active&&(e=pergola.Menu.handle,this!=e&&(e.button.setAttributeNS(null,"opacity",0),e.list.close(t),window.removeEventListener("mousedown",e,!1),window.addEventListener("mousedown",this,!1)),this.list.container.setAttributeNS(null,"display","block"));else if("mouseout"==n)s.setAttributeNS(null,"opacity",0);else if("mousedown"==n){for(i in r.menu)o=r.menu[i],this.unregisterEvents(o.button,"mouseout",o);pergola.Menu.active=!0,window.addEventListener("mousedown",this,!1),pergola.Menu.opacity=.9,s.setAttributeNS(null,"opacity",pergola.Menu.opacity),this.list.container.setAttributeNS(null,"display","block")}pergola.Menu.handle=this}else t.currentTarget==window&&(pergola.Menu.handle.close(t),pergola.Menu.handle=null)},build:function(){if(pergola.extend(this,arguments[0]),!this.owner)return void alert(pergola.messages.missingOwner+"Menu");var t=this.owner.menubar.height-1,e=this.title.width(this["font-size"],this["font-family"])+20,i=t-(t-parseInt(this["font-size"]))/2-2;return this.container=$C({element:"g",id:this.id,appendTo:this.parent}),this.button=$C({element:"rect",id:this.id+"_button",x:.5,y:.5,rx:this.rx,width:e,height:t,fill:this.fill,stroke:this.stroke,opacity:0,appendTo:this.container}),$C({element:"text",x:e/2-1,y:i,fill:this.textFill,"text-anchor":"middle","pointer-events":"none",textNode:this.title,appendTo:this.container}),this.registerEvents(this.button,["mousedown","mouseover","mouseout"]),this.owner.menubar.add(this),this.list=new pergola.MenuList(this.id+"_list").build({owner:this,menuObject:this,parent:this.container,y:t+1,items:this.items,"font-family":this["font-family"],"font-size":this["font-size"]}),this}}),i=e.menuBar,t(pergola.Menubar.prototype,{"font-size":i["font-size"],height:i.height,fill:i.fill,advanceX:0,width:function(){return parseInt(this.container.getBBox().width)+1},add:function(t){t.container.setAttributeNS(null,"transform","translate("+this.advanceX+" 0)"),this.bar.setAttributeNS(null,"width",this.advanceX=this.width()),this==pergola.menubar&&pergola.tabsDock.container.setAttributeNS(null,"transform","translate("+(pergola.tabsDock.x=this.x+this.advanceX+32)+" "+pergola.tabsDock.y+")")},build:function(){return pergola.extend(this,arguments[0]),this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")","font-size":this["font-size"],appendTo:this.parent}),this.bar=$C({element:"rect",width:0,height:this.height,fill:this.fill,appendTo:this.container}),this}}),i=e.menuItem,t(pergola.MenuItem.prototype,{height:i.height,fill:i.fill,textFill:"black",textFillInverse:"white",active:!0,exclusive:!1,effects:function(t){this.button.setAttributeNS(null,"opacity","mouseover"==t.type|0),this.videoInverse(t)},activate:function(){this.active||(this.active=!0,this.text.setAttributeNS(null,"opacity",1),this.submenu&&this.arrow.setAttributeNS(null,"opacity",1))},deactivate:function(){this.active=!1,this.text.setAttributeNS(null,"opacity",.5),this.checkmark&&(this.check=!1,this.checkmark.setAttributeNS(null,"display","none")),this.submenu&&this.arrow.setAttributeNS(null,"opacity",.5)},setChecked:function(){this.checkmark.setAttributeNS(null,"display","block"),this.check=!0},uncheck:function(){this.check=!1,this.checkmark.setAttributeNS(null,"display","none")},handleEvent:function(t){var e,i,o,s;if(t.detail>1&&t.preventDefault(),"mousedown"==t.type)t.stopPropagation();else if("mouseup"==t.type){if(!this.active)return void t.stopPropagation();if(this.checkmark){if(this.exclusive)for(e in this.owner.items)i=this.owner[e],i.check&&i.exclusive&&(i.check=!1,i.checkmark.setAttributeNS(null,"display","none"));this.check=this.check?!1:!0,this.checkmark.setAttributeNS(null,"display",this.check?"block":"none")}this.effects(t),this.menuObject.close(t),this.checkUserFunction(t)}else if(this.effects(t),"mouseover"==t.type){for(e in this.owner)o=this.owner[e],s=o.submenu,s&&s.up&&(o.list.close(t),s.up=!1);this.submenu&&(this.list.container.setAttributeNS(null,"display","block"),this.submenu.up=!0)}},build:function(){if(pergola.extend(this,arguments[0]),!this.owner)return void alert(pergola.messages.missingOwner+"MenuItem");var t=this.owner;return this.container=$C({element:"g",id:this.id,transform:"translate(0 "+t.advanceY+")","font-size":this["font-size"],appendTo:this.parent}),this.button=$C({element:"rect",x:1,y:1,width:t.width,height:this.height,fill:this.fill,opacity:0,appendTo:this.container}),this.registerEvents(this.container,["mouseover","mouseout","mousedown"]),this.submenu||this.registerEvents(this.button,"mouseup"),this.text.opacity=+this.active||.5,this.text=$C(pergola.extend({element:"text","pointer-events":"none",appendTo:this.container},this.text)),"check"in this&&(this.checkmark=pergola.symbol.call(this,{symbol:pergola.symbols.checkmark,x:3.5,y:6}),this.checkmark=this.checkmark.firstChild,this.checkmark.setAttributeNS(null,"display",this.check?"block":"none")),this.submenu&&(this.arrow=pergola.symbol.call(this,{symbol:pergola.symbols.menuArrow,x:t.width-9,y:6}),this.arrow=this.arrow.firstChild,this.list=new pergola.MenuList(this.id+"_list").build({owner:this,menuObject:this.menuObject,parent:this.container,x:t.width,y:-2,items:this.submenu.items,"font-family":this["font-family"],"font-size":this["font-size"],isSubmenu:!0})),this.separator&&(this.separator.build({parent:this.container,type:"horizontal",x:1,y:this.height+1,width:t.width}),t.advanceY+=this.separator.height),t.advanceY+=this.height,this}}),i=e.menuList,t(pergola.MenuList.prototype,{height:0,margin:i.margin,advanceY:0,filter:i.filter,close:function(t){var e;for(var i in this.items)e=this[i],"mouseover"!=t.type&&e.effects(t),e.submenu&&e.list.close(t);this.container.setAttributeNS(null,"display","none")},update:function(){var t;this.advanceY=0;for(var e in this.items)t=this[e],t.container.setAttributeNS(null,"transform","translate(0 "+this.advanceY+")"),this.advanceY+=t.height},build:function(){pergola.extend(this,arguments[0]);var t,e,i=[];for(t in this.items)this[t]=new pergola.MenuItem(this.id+"_"+t),e=this.items[t],this.height+=this[t].height+(e.separator?e.separator.height:0),i.push(e.string.width(this["font-size"],this["font-family"]));this.width=Math.max.apply(null,i)+this.margin+34,this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),$C({element:"rect",x:.5,y:.5,width:this.width+5,height:this.height+5,fill:"#FFFFFF",stroke:this.stroke,filter:this.filter,appendTo:this.container});var o=$C({element:"g",id:this.id+"_itemsGroup",transform:"translate(2 2)",appendTo:this.container});for(t in this.items)this[t].build(pergola.extend(this.items[t],{owner:this,menuObject:this.menuObject,parent:o,"font-family":this["font-family"],"font-size":this["font-size"],text:{x:this.margin,y:parseInt(this["font-size"])+2,textNode:this.items[t].string,"pointer-events":"none"}}));return"bottom"==pergola.taskbar.position&&this.container.setAttributeNS(null,"transform","translate("+this.x+" "+(this.y=-(this.height+12))+")"),this.container.setAttributeNS(null,"display","none"),this}}),t(pergola.Panel,{panels:[]}),i=e.panel,t(pergola.Panel.prototype,{type:"dialog",x:i.x,y:i.y,width:i.width,height:i.height,fill:i.fill,"fill-opacity":1,"stroke-opacity":1,stroke:e.frame.stroke,hasFooter:i.hasFooter,footerFill:i.footerFill,margin:i.margin,footerHeight:i.footerHeight,filter:i.filter,validated:!0,preemptive:!1,isOpen:!1,isTop:!1,move:pergola.Panel.superClass.moveByTranslation,open:function(){this!=pergola.notification&&pergola.preemptiveIsUp||(this.container.setAttributeNS(null,"display","block"),this.bringToFront(),this.isOpen=!0)},init:function(t){return pergola.extend(this,arguments[0]),this.open(t),this},update:function(){var t=arguments[0];return t.title&&t.ok?(this.topBar.title.firstChild.data=t.title,void(this.ok.text.firstChild.data=t.ok)):void alert(pergola.messages.missingPanelData)},warn:function(){this.timer=pergola.Timer().initialize({handle:this.topBar,callback:this.topBar.preemptiveWarning,frequence:15,repeatCount:0,repeats:24})},bringToFront:function(){if(this.parent.appendChild(this.container),!this.isTop){var t,e=pergola.Panel.panels;this.preemptive&&(pergola.preemptiveIsUp=this);for(t in e)e[t].isTop=!1;this.isTop=!0;for(t in e)if(e[t]==this){e.splice(t,1);break}e.push(this)}},getCandidate:function(){var t,e,i=pergola.Panel.panels;for(t=i.length-1;t>=0;t--)if(e=i[t],e!=this&&e.isOpen){e.bringToFront();break}},close:function(t){var e,i,o=pergola.Panel.panels;this.comboBox&&this.comboBox.cancelSelection(t,!0),this.container.setAttributeNS(null,"display","none"),this.isOpen=!1,this.getCandidate(),pergola.preemptiveIsUp=null;for(e in o)if(i=o[e],i!=this&&i.preemptive&&i.isOpen){pergola.preemptiveIsUp=i;break}},release:function(){this.frame.rect.setAttributeNS(null,"filter",this.frame.filter)},footerPath:function(){var t=this.footerHeight,e=this.frame.rx;return"M0 0h"+(this.width-1)+"v"+(t-e)+"q0,"+e+",-"+e+","+e+"h-"+(this.width-1-2*e)+"q-"+e+",0,-"+e+",-"+e+"z"},resize:function(){var t=arguments[0];t.x&&(this.oldX=this.x,this.x=t.x),t.y&&(this.oldY=this.y,this.y=t.y),t.x&&this.container.setAttributeNS(null,"transform","translate("+this.x+" "+this.y+")"),pergola.attribute(this.frame.rect,{width:this.width=t.width,height:this.height=t.height}),"basic"!=this.type&&(this.topBar.resize(this.width),this.closeBtn.container.setAttributeNS(null,"transform","translate("+(this.width-this.closeBtn.width-6)+" "+this.closeBtn.y+")"),this.footerGroup.setAttributeNS(null,"transform","translate(1 "+(this.height-this.footerHeight)+")"),this.hasFooter&&this.footer.setAttributeNS(null,"d",this.footerPath())),this.ok&&t.ok&&this.ok.container.setAttributeNS(null,"transform","translate("+t.ok.x+" "+t.ok.y+")"),this.cancel&&t.cancel&&this.cancel.container.setAttributeNS(null,"transform","translate("+t.cancel.x+" "+t.cancel.y+")")},handleEvent:function(t){var e=t.target,i=t.type,o=this.comboBox,s=this.ok&&e==this.ok.button,n="mousedown"==t.type?!0:!1,r=t.target.parentNode,a=r.isInput,l=!1;if(this.pane)for(;r&&!(l=r==this.pane.container);)r=r.parentNode;if(t.detail>1&&!a&&!l&&t.preventDefault(),pergola.notification.isOpen&&this!=pergola.notification)return void pergola.notification.warn();if(this.preemptive)"mouseout"==i?this.isOpen&&(pergola.preemptiveIsUp=this):"mouseover"==i&&(pergola.preemptiveIsUp=null);else if(pergola.preemptiveIsUp)return void(n&&pergola.preemptiveIsUp.warn());"mousedown"==i?(this.bringToFront(),o&&!s&&this.comboBox.cancelSelection(t)):"mouseup"==i&&(pergola.Key.active&&(pergola.Key.active.warn=this.cancel&&e==this.cancel.button?!1:!0),s?(this.user?(this.user.checkCallback||(this.user.checkCallback=this.checkCallback),this.user.checkCallback(t,this.callback)):this.checkUserFunction(t),this.validated&&this.close(t),this.validated=!0):this.close(t))},build:function(){if(pergola.extend(this,arguments[0]),this.preemptive){if(pergola.preemptiveIsUp)return void alert(pergola.messages.runtimeError+pergola.messages.preemptiveIsUp);this!=pergola.notification&&(this.parent=pergola.preemptive)}if(this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.topBar=new pergola.TopBar(this.id+"_topBar"),this==pergola.notification&&(this.topBar.fill=e.topBar.fill.messageBox),this.frame=new pergola.Frame(this.id+"_frame").build({owner:this,parent:this.container,width:this.width,height:this.height,fill:this.fill,stroke:this.stroke,"fill-opacity":this["fill-opacity"],"stroke-opacity":this["stroke-opacity"],filter:this.filter}),"basic"!=this.type?(this.container.addEventListener("mousedown",this,!0),this.topBar.build({owner:this,rx:this.frame.rx,width:this.width,parent:this.container,stroke:this.stroke,"font-size":12}),this.closeBtn=new pergola.CommandButton(this.id+"_closeButton"),this.closeBtn.build({owner:this,parent:this.container,x:this.width-this.closeBtn.width-6,y:7,symbol:{symbol:pergola.symbols.winClose,x:5,y:4},ev:"mouseup",fn:function(t){pergola.preemptiveIsUp||(pergola.Key.active&&(pergola.Key.active.warn=!1),this.owner.close(t))}})):delete this.topBar,"dialog"==this.type){this.footerGroup=$C({element:"g",id:this.id+"_footer",transform:"translate(1 "+(this.height-this.footerHeight)+")",appendTo:this.container});var t,i;this.hasFooter&&$C({element:"path",d:this.footerPath(),fill:this.footerFill,appendTo:this.footerGroup}),this.okButton&&(t=this.okButton,i=t.text||"OK",this.ok=new pergola.DialogButton(this.id+"_ok").build({owner:this,parent:this.footerGroup,x:t.x||this.width-(t.marginRight||260),y:t.y||16,text:i})),this.cancelButton&&(t=this.cancelButton,i=t.text||"Cancel",this.cancel=new pergola.DialogButton(this.id+"_cancel"),this.cancel.build({owner:this,parent:this.footerGroup,x:this==pergola.notification?(this.width-this.cancel.width)/2:t.x||this.width-(t.marginRight||130),y:t.y||16,text:i}))}if(this.layout){var o=pergola.extend(this.layout,{owner:this,parent:this.container,x:this.layout.x||this.margin,y:(this.layout.y||this.margin)+this.topBar.height*("basic"!=this.type),width:this.layout.width||this.width-2*this.margin,height:this.layout.height||this.height-(this.topBar.height*("basic"!=this.type)+this.footerHeight*("dialog"==this.type))-2*this.margin});this.layout=(new pergola.Layout).build(o)}return this.contains&&("function"==typeof this.contains?this.contains():this.container.appendChild(this.contains)),this.container.setAttributeNS(null,"display","none"),this.preemptive&&(this.container.addEventListener("mouseover",this,!0),this.container.addEventListener("mouseout",this,!1)),this.isOpen&&this.open(),pergola.Panel.panels.push(this),this.sweep(["okButton","cancelButton"]),this}}),i=e.popupList,t(pergola.PopupList.prototype,{width:i.width,listItemHeight:i.listItemHeight,listMargin:i.listMargin,advanceY:0,build:function(){if(pergola.extend(this,arguments[0]),!this.owner)return void alert(pergola.messages.missingOwner+"PopupList");var t,e,i=this.list.length,o=this.width-5;this.height=i*this.listItemHeight+2*i+3,this.y=-this.owner.index*this.listItemHeight-2,this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",display:"none",appendTo:this.parent}),$C({element:"rect",x:.5,y:.5,width:this.width,height:this.height,fill:"white",stroke:this.stroke,appendTo:this.container}),this.listGroup=$C({element:"g",transform:"translate(3 3)",appendTo:this.container});
for(t in this.list)e=this.list[t],this[e]=new pergola.PopupListItem(this.name+"_"+e).build({owner:this,parent:this.listGroup,width:o,string:e});return this}}),t(pergola.PopupListItem.prototype,{handleEvent:function(t){if(t.stopPropagation(),t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp)return void("mousedown"==t.type&&pergola.preemptiveIsUp.warn());if(this.effects(t),"mousedown"==t.type)this.registerEvents(this.button,"mouseup");else if("mouseup"==t.type){var e=this.owner.owner;this.unregisterEvents(this.button,"mouseup"),e.selection=this,e.close(t),e.fn&&e.fn(t)}}}),i=e.preview,t(pergola.Preview.prototype,{rx:i.rx,width:i.width,height:i.height,fill:e.frame.fill,stroke:e.frame.stroke,"fill-opacity":i["fill-opacity"],"stroke-opacity":i["stroke-opacity"],show:function(){this.container.setAttributeNS(null,"display","block")},hide:function(){this.container.setAttributeNS(null,"display","none")},update:function(){var t=this.owner,e=t.doc.transformable.cloneNode(!0),i=e.getElementsByTagNameNS(pergola.ns.svg,"*");e.removeAttributeNS(null,"id");for(var o=0;o<i.length;o++)i.item(o).removeAttributeNS(null,"id");t.clone.replaceChild(e,t.clone.firstChild)},build:function(){if(pergola.extend(this,arguments[0]),!this.owner)return void alert(pergola.messages.missingOwner+"Preview");var t=this.owner;return this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",display:"none",appendTo:this.parent}),$C({element:"rect",x:.5,y:.5,rx:this.rx,width:this.width,height:this.height,fill:this.fill,"fill-opacity":this["fill-opacity"],stroke:this.stroke,"stroke-opacity":this["stroke-opacity"],appendTo:this.container}),$C({element:"rect",x:3.5,y:3.5,width:this.width-6,height:this.height-6,fill:this.owner.fill,stroke:this.stroke,appendTo:this.container}),t.clone=$C({element:"svg",x:4,y:4,width:this.width-7,height:this.height-7,viewBox:"0 0 "+this.owner.width+" "+this.owner.height,appendTo:this.container}),$C({element:"g",appendTo:t.clone}),this}}),i=e.progress,t(pergola.Progress.prototype,{width:i.width,height:i.height,fill:i.fill,stroke:i.stroke,statusFill:i.statusFill,type:"bar",advance:0,start:function(){this.container.setAttributeNS(null,"display","block")},stop:function(){this.advance=0,this.status.setAttributeNS(null,"width",0),this.container.setAttributeNS(null,"display","none")},build:function(){if(pergola.extend(this,arguments[0]),!this.owner)return void alert(pergola.messages.missingOwner+"Progress");var t,e,i,o={width:this.width,height:this.height,fill:this.fill,stroke:this.stroke};return this.extra&&(pergola.extend(o,this.extra),delete this.extra),t=o["stroke-width"]||1*("none"!=this.stroke),this.extent=this.width-t,e=this.setPositionToStrokeWidth(t),e&&(o.y=o.x=e),i=t/2+e,this.container=$C({element:"g",transform:"translate("+this.x+" "+this.y+")",display:"none",appendTo:this.parent}),"bar"==this.type&&(this.rect=$C(pergola.extend({element:"rect",appendTo:this.container},o)),this.status=$C({element:"rect",id:this.id,x:i,y:i,rx:0|o.rx,width:0,height:this.height-t,fill:this.statusFill,appendTo:this.container})),this}}),i=e.quickTip,t(pergola.QuickTip.prototype,{"font-size":i["font-size"],rx:i.rx,fill:i.fill,stroke:i.stroke,textFill:i.textFill,delay:i.delay,update:function(t){pergola.removeChildren(this.textGroup),t=this.convert(t);for(var e in t)$C({element:"text",x:4,y:12+12*e,textNode:t[e],appendTo:this.textGroup})},dims:function(){var t=this.textGroup.getBBox(),e=pergola.browser;return{width:Math.ceil(t.width)+10,height:Math.ceil(t.height)+7*e.firefox+4*(e.opera||e.safari||e.chrome)}},convert:function(t){return"string"==typeof t?-1!=t.indexOf("\n")?t.split("\n"):[t]:t},show:function(){this.timer.clear(),this.unregisterEvents(this.owner.button,["mousemove"],this.owner),pergola.attribute(this.container,{transform:"translate("+(this.x||this.owner.mouse.x-20|0)+" "+(this.y||this.owner.mouse.y+20|0)+")",display:"block"})},hide:function(){this.timer.clear(),this.unregisterEvents(this.owner.button,["mousemove"],this.owner),this.container.setAttributeNS(null,"display","none")},build:function(){var t;pergola.extend(this,arguments[0]),this.container=$C({element:"g",id:this.id,opacity:this.opacity||1,appendTo:pergola.quicktips.container}),this.textGroup=$C({element:"g","font-size":this["font-size"],"font-family":this["font-family"],fill:this.textFill,"pointer-events":"none",appendTo:this.container}),this.tip=this.convert(this.tip);for(var e in this.tip)$C({element:"text",x:4,y:12+12*e,textNode:this.tip[e],appendTo:this.textGroup});return t=this.dims(),this.bubble=$C({element:"rect",x:.5,y:.5,rx:this.rx,width:t.width,height:t.height,fill:this.fill,stroke:this.stroke,appendTo:this.container}),this.container.appendChild(this.textGroup),this.container.setAttributeNS(null,"display","none"),this}}),i=e.radioButton,t(pergola.RadioButton.prototype,{fill:i.fill,stroke:i.stroke,dotFill:i.dotFill,r:i.r,dotR:i.dotR,handleEvent:function(t){if(t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp)return void("mousedown"==t.type&&pergola.preemptiveIsUp.warn());if("mousedown"==t.type)this.registerEvents(this.container,["mouseup"]);else if("mouseup"==t.type){if(this.manager){for(var e in this.manager.options)this.manager.options[e].dot.setAttributeNS(null,"display","none");this.manager.selection=this,this.dot.setAttributeNS(null,"display","block")}else this.dot.setAttributeNS(null,"display","block");this.fn&&this.checkUserFunction(t),this.manager&&this.manager.fn&&this.manager.fn()}},build:function(){return pergola.extend(this,arguments[0]),this.manager&&(this.manager.options||(this.manager.options={}),this.manager.options[this.name]=this,this.isDefault&&(this.manager.selection=this)),this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.registerEvents(this.container,["mousedown"]),$C({element:"circle",cx:this.r,cy:this.r,r:this.r,fill:this.fill,stroke:this.stroke,"stroke-width":.5,appendTo:this.container}),this.dot=$C({element:"circle",cx:this.r,cy:this.r,r:this.dotR,fill:this.dotFill,display:this.isDefault?"block":"none",appendTo:this.container}),this.caption&&(this.caption=(new pergola.Caption).build(pergola.extend(this.caption,{owner:this,parent:this.container}))),this}}),i=e.rubberBox,t(pergola.RubberBox.prototype,{stroke:i.stroke,"stroke-width":i["stroke-width"],"stroke-dasharray":i["stroke-dasharray"],maskStroke:i.maskStroke,set:function(){pergola.extend(this,arguments[0]),this.x=this.point.x,this.y=this.point.y,pergola.attribute(this.rect,{x:this.x-.5,y:this.y-.5}),pergola.attribute(this.mask,{x:this.x-.5,y:this.y-.5}),this.container.setAttributeNS(null,"display","block")},release:function(t){var e,i=pergola.mousePoint(t);this.x=this.tempX?this.tempX:i.x,this.y=this.tempY?this.tempY:i.y,e=0!=this.width&&0!=this.height?[{x:this.x,y:this.y},{x:this.x+this.width,y:this.y},{x:this.x+this.width,y:this.y+this.height},{x:this.x,y:this.y+this.height}]:0,this.user[this.fn](t,e),this.reset()},update:function(t){var e=this.handle,i=pergola.mousePoint(t),o=e.x,s=e.y;e.width=i.x-o,e.width<0&&(o=i.x,e.width*=-1),e.height=i.y-s,e.height<0&&(s=i.y,e.height*=-1),pergola.attribute(e.rect,{x:o,y:s,width:e.width,height:e.height}),pergola.attribute(e.mask,{x:o,y:s,width:e.width,height:e.height}),e.tempX=o,e.tempY=s},reset:function(){this.x=this.tempX=this.y=this.tempY=this.width=this.height=0,this.setXYWH(this.rect),this.setXYWH(this.mask),this.container.setAttributeNS(null,"display","none"),this.sweep(["user","fn","point"])},build:function(){return pergola.extend(this,arguments[0]),this.parent=pergola.systemComponents,this.x=this.y=this.width=this.height=0,this.container=$C({element:"g",id:this.id,fill:"none","stroke-width":this["stroke-width"],"pointer-events":"none",display:"none",appendTo:this.parent}),this.mask=$C({element:"rect",width:0,height:0,stroke:this.maskStroke,appendTo:this.container}),this.rect=$C({element:"rect",width:0,height:0,stroke:this.stroke,"stroke-dasharray":this["stroke-dasharray"],appendTo:this.container}),this}}),i=e.scrollBar,t(pergola.Scrollbar.prototype,{fill:i.fill,stroke:i.stroke,horTrackFill:i.horTrackFill,vertTrackFill:i.vertTrackFill,size:i.size,padding:i.padding,min:0,extent:0,scrollType:"regular",initial:"start",sliderClearance:2,step:i.step,delay:i.delay,stepFrequence:i.stepFrequence,pageFrequence:i.pageFrequence,mapPageFrequence:i.mapPageFrequence,updateHor:function(t,e){this.track.setAttributeNS(null,"width",this.extent),this.container.setAttributeNS(null,"transform","translate("+t+" "+e+")"),this.fwdScroll.container.setAttributeNS(null,"transform","translate("+(this.scrollButtonSize+this.extent-1)+" 0)")},updateVert:function(t,e){this.track.setAttributeNS(null,"height",this.extent),this.container.setAttributeNS(null,"transform","translate("+t+" "+e+")"),this.fwdScroll.container.setAttributeNS(null,"transform","translate(0 "+(this.scrollButtonSize+this.extent-1)+")")},horScrollBySliderInit:function(t){var e;return this.owner.map?(this.callback=this.mapHorScrollBySlider,e=this.owner.map.zoom()):(this.callback=this.horScrollBySlider,e=this.scrollTarget.wRatio()),{callback:this.callback,handle:this,offset:t.clientX-this.slider.pos,ratio:e,evtX:t.clientX,updateCoordinates:!1}},vertScrollBySliderInit:function(t){var e;return this.owner.map?(this.callback=this.mapVertScrollBySlider,e=this.owner.map.zoom()):(this.callback=this.vertScrollBySlider,e=this.scrollTarget.hRatio()),{callback:this.callback,handle:this,offset:t.clientY-this.slider.pos,ratio:e,evtY:t.clientY,updateCoordinates:!1}},horScrollBySlider:function(t){var e=this.handle,i=e.slider,o=e.owner;i.pos=t.clientX-this.offset,e.overflow(i),i.container.setAttributeNS(null,"transform","translate("+Math.round(i.pos)+" 0)"),i.scrollTarget.e=-1*Math.round(i.pos*this.ratio),e.scrollTarget.matrixTransformApply(),o.datagrid&&o.datagrid.gutterPositionOnScroll(e.scrollTarget)},vertScrollBySlider:function(t){var e=this.handle,i=e.slider,o=e.owner;i.pos=t.clientY-this.offset,e.overflow(i),i.container.setAttributeNS(null,"transform","translate(0 "+Math.round(i.pos)+")"),i.scrollTarget.f=-1*Math.round(i.pos*this.ratio),e.scrollTarget.matrixTransformApply(),o.datagrid&&o.datagrid.headerPositionOnScroll(e.scrollTarget)},mapHorScrollBySlider:function(t){if(t.clientX!=this.evtX){var e=this.handle,i=e.slider,o=e.owner,s=o.map,n=t.clientX>this.evtX?-1:1;i.pos=t.clientX-this.offset,e.overflow(i),i.container.setAttributeNS(null,"transform","translate("+Math.round(i.pos)+" 0)"),s.panBy({x:8*n*this.ratio,y:0}),this.evtX=t.clientX,o.status&&o.status.center(s.center()),s.grid&&o.mapGutterPositionOnScroll()}},mapVertScrollBySlider:function(t){if(t.clientY!=this.evtY){var e=this.handle,i=e.slider,o=e.owner,s=o.map,n=t.clientY>this.evtY?-1:1;i.pos=t.clientY-this.offset,e.overflow(i),i.container.setAttributeNS(null,"transform","translate(0 "+Math.round(i.pos)+")"),s.panBy({x:0,y:8*n*this.ratio}),this.evtY=t.clientY,o.status&&o.status.center(s.center()),s.grid&&o.mapGutterPositionOnScroll()}},overflow:function(t){t.pos<0?t.pos=0:t.pos>t.max&&(t.pos=t.max)},horFwdStepScroll:function(){var t=this.slider,e=this.scrollTarget,i=this.owner;t.pos+=this.step/e.wRatio(),this.positiveOverflow(t),e.ctm.e=-1*Math.round(t.pos*e.wRatio()),e.matrixTransformApply(),t.container.setAttributeNS(null,"transform","translate("+Math.round(t.pos)+" 0)"),i.datagrid&&i.datagrid.gutterPositionOnScroll(e)},vertFwdStepScroll:function(){var t=this.slider,e=this.scrollTarget,i=this.owner;t.pos+=this.step/e.hRatio(),this.positiveOverflow(t),e.ctm.f=-1*Math.round(t.pos*e.hRatio()),e.matrixTransformApply(),t.container.setAttributeNS(null,"transform","translate(0 "+Math.round(t.pos)+")"),i.datagrid&&i.datagrid.headerPositionOnScroll(e)},horBackStepScroll:function(){var t=this.slider,e=this.scrollTarget,i=this.owner;t.pos-=this.step/e.wRatio(),this.negativeOverflow(t),e.ctm.e=-1*Math.round(t.pos*e.wRatio()),e.matrixTransformApply(),t.container.setAttributeNS(null,"transform","translate("+Math.round(t.pos)+" 0)"),i.datagrid&&i.datagrid.gutterPositionOnScroll(e)},vertBackStepScroll:function(){var t=this.slider,e=this.scrollTarget,i=this.owner;t.pos-=this.step/e.hRatio(),this.negativeOverflow(t),e.ctm.f=-1*Math.round(t.pos*e.hRatio()),e.matrixTransformApply(),t.container.setAttributeNS(null,"transform","translate(0 "+Math.round(t.pos)+")"),i.datagrid&&i.datagrid.headerPositionOnScroll(e)},mapHorFwdStepScroll:function(){var t=this.slider,e=this.owner,i=e.map;i.panBy({x:-16,y:0}),e.status&&e.status.center(i.center()),i.grid&&e.mapGutterPositionOnScroll(),t.pos+=(i.zoomRange()[1]-i.zoom()+1)/100,t.container.setAttributeNS(null,"transform","translate("+t.pos+" 0)")},mapVertFwdStepScroll:function(){var t=this.slider,e=this.owner,i=e.map;i.panBy({x:0,y:-16}),e.status&&e.status.center(i.center()),i.grid&&e.mapGutterPositionOnScroll(),t.pos+=(i.zoomRange()[1]-i.zoom()+1)/100,t.container.setAttributeNS(null,"transform","translate(0 "+t.pos+")")},mapHorBackStepScroll:function(){var t=this.slider,e=this.owner,i=e.map;i.panBy({x:16,y:0}),e.status&&e.status.center(i.center()),i.grid&&e.mapGutterPositionOnScroll(),t.pos-=(i.zoomRange()[1]-i.zoom()+1)/100,t.container.setAttributeNS(null,"transform","translate("+t.pos+" 0)")},mapVertBackStepScroll:function(){var t=this.slider,e=this.owner,i=e.map;i.panBy({x:0,y:16}),e.status&&e.status.center(i.center()),i.grid&&e.mapGutterPositionOnScroll(),t.pos-=(i.zoomRange()[1]-i.zoom()+1)/100,t.container.setAttributeNS(null,"transform","translate(0 "+t.pos+")")},positiveOverflow:function(t){t.pos>t.max&&(t.pos=t.max)},negativeOverflow:function(t){t.pos<0&&(t.pos=0)},horScrollByPageInit:function(t){var e=pergola.mousePoint(t),i=e.x-this.absoluteX(this.container.parentNode)-this.x;pergola.browser.firefox&&(i=e.x-this.ff_absoluteX()-this.x),"mousedown"==t.type?(this.removePointerEvents([this.slider.bar]),this.registerEvents(t.target,["mousemove","mouseout","mouseup"]),this.offset=i,this.offset>this.slider.pos+this.slider.size?(this.dir=-1,this.callback=this.owner.map?this.mapHorScrollByPage:this.horScrollByPage):this.offset<this.slider.pos&&(this.dir=1,this.callback=this.owner.map?this.mapHorScrollByPage:this.horScrollByPage),this.callback(),this.timer?this.timer.initialize():this.timer=pergola.Timer().initialize({handle:this,callback:this.callback,delay:250,frequence:this.pageFrequence})):"mousemove"==t.type?this.offset=i:("mouseup"==t.type||"mouseout"==t.type)&&(this.timer&&this.timer.clear(),this.unregisterEvents(t.target,["mousemove","mouseout","mouseup"]),this.setPointerEvents([this.slider.bar]))},vertScrollByPageInit:function(t){var e=pergola.mousePoint(t),i=e.y-this.absoluteY(this.container.parentNode)-this.y;pergola.browser.firefox&&(i=e.y-this.ff_absoluteY()-this.y),"mousedown"==t.type?(this.removePointerEvents([this.slider.bar]),this.registerEvents(t.target,["mousemove","mouseout","mouseup"]),this.offset=i,this.offset>this.slider.pos+this.slider.size?(this.dir=-1,this.callback=this.owner.map?this.mapVertScrollByPage:this.vertScrollByPage):this.offset<this.slider.pos&&(this.dir=1,this.callback=this.owner.map?this.mapVertScrollByPage:this.vertScrollByPage),this.callback(),this.timer?this.timer.initialize():this.timer=pergola.Timer().initialize({handle:this,callback:this.callback,delay:250,frequence:this.pageFrequence})):"mousemove"==t.type?this.offset=i:("mouseup"==t.type||"mouseout"==t.type)&&(this.timer&&this.timer.clear(),this.unregisterEvents(t.target,["mousemove","mouseout","mouseup"]),this.setPointerEvents([this.slider.bar]))},horScrollByPage:function(){var t=this.scrollTarget,e=t.ctm,i=this.slider,o=t.canvas.width*t.scaleFactor-t.visibleW;return this.offset>i.pos&&this.offset<i.pos+i.size?void this.timer.clear():(e.e+=this.page*this.dir,e.e>0?e.e=0:Math.abs(e.e)>o&&(e.e=-1*Math.round(o)),i.pos=e.e/t.wRatio()*-1,i.container.setAttributeNS(null,"transform","translate("+Math.round(i.pos)+" 0)"),t.matrixTransformApply(),void(this.owner.datagrid&&this.owner.datagrid.gutterPositionOnScroll(t)))},vertScrollByPage:function(){var t=this.scrollTarget,e=t.ctm,i=this.slider,o=t.canvas.height*t.scaleFactor-t.visibleH;return this.offset>i.pos&&this.offset<i.pos+i.size?void this.timer.clear():(e.f+=this.page*this.dir,e.f>0?e.f=0:Math.abs(e.f)>o&&(e.f=-1*Math.round(o)),i.pos=e.f/t.hRatio()*-1,i.container.setAttributeNS(null,"transform","translate(0 "+Math.round(i.pos)+")"),t.matrixTransformApply(),void(this.owner.datagrid&&this.owner.datagrid.headerPositionOnScroll(t)))},mapHorScrollByPage:function(){var t=this.owner,e=t.map,i=this.slider;return this.offset>i.pos&&this.offset<i.pos+i.size?void this.timer.clear():(e.panBy({x:this.page*this.dir,y:0}),t.status&&t.status.center(e.center()),e.grid&&t.mapGutterPositionOnScroll(),this.slider.pos-=(e.zoomRange()[1]-e.zoom()+1)/10*this.dir,void this.slider.container.setAttributeNS(null,"transform","translate("+Math.round(this.slider.pos)+" 0)"))},mapVertScrollByPage:function(){var t=this.owner,e=t.map,i=this.slider;return this.offset>i.pos&&this.offset<i.pos+i.size?void this.timer.clear():(e.panBy({x:0,y:this.page*this.dir}),t.status&&t.status.center(e.center()),e.grid&&t.mapGutterPositionOnScroll(),this.slider.pos-=(e.zoomRange()[1]-e.zoom()+1)/10*this.dir,void this.slider.container.setAttributeNS(null,"transform","translate(0 "+Math.round(this.slider.pos)+")"))},release:function(){pergola.Key.active&&(pergola.Key.active.stop=!0)},handleEvent:function(t){var e=t.target,i=t.type;return t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp?void("mousedown"==i&&pergola.preemptiveIsUp.warn()):("mousedown"==i?(this.registerEvents(this.track,["mouseup"]),this.registerEvents(this.slider.bar,["mouseup"])):"mouseup"==i&&(this.unregisterEvents(this.track,["mouseup"]),this.unregisterEvents(this.slider.bar,["mouseup"])),void(e==this.slider.bar?pergola.dragarea.activate(this.sliderFn(t)):e==this.track&&this.fn(t)))},buildH:function(){if(pergola.extend(this,arguments[0]),!this.owner)return void alert(pergola.messages.missingOwner+"Scrollbar");var t=0;return"navigation"==this.scrollType&&((this.owner.type="map")&&(this.pageFrequence=this.mapPageFrequence),this.initial="middle",t=16),this.fn=this.fn||this.horScrollByPageInit,this.sliderFn=this.sliderFn||this.horScrollBySliderInit,this.backScrollFn=this.backScrollFn||"map"==this.owner.type?this.mapHorBackStepScroll:this.horBackStepScroll,this.fwdScrollFn=this.fwdScrollFn||"map"==this.owner.type?this.mapHorFwdStepScroll:this.horFwdStepScroll,this.scrollButtonSize=this.size+2,this.margins=2*this.scrollButtonSize,this.x=this.scrollTarget.x+this.scrollButtonSize,this.container=$C({element:"g",id:this.id,appendTo:this.parent}),this.track=$C({element:"rect",x:this.scrollButtonSize-.5,y:.5,width:0,height:this.size-1,fill:this.horTrackFill,stroke:this.stroke,appendTo:this.container}),this.registerEvents(this.track,["mousedown"]),this.slider=new pergola.ScrollSlider(this.id+"_slider").buildH({owner:this,parent:this.container,pos:0,x:this.scrollButtonSize+this.sliderClearance/4,y:this.padding,width:t,height:this.size-2*this.padding,scrollTarget:this.scrollTarget.ctm}),this.registerEvents(this.slider.bar,["mousedown"]),this.backScroll=new pergola.ScrollButton(this.id+"_backScroll").build({owner:this,parent:this.container,fn:this.backScrollFn,width:this.size+1,height:this.size-1,stroke:this.stroke,symbol:{symbol:this.symbol.left}}),this.fwdScroll=new pergola.ScrollButton(this.id+"_fwdScroll").build({owner:this,parent:this.container,fn:this.fwdScrollFn,width:this.size+1,height:this.size-1,stroke:this.stroke,symbol:{symbol:this.symbol.right}}),this},buildV:function(){if(pergola.extend(this,arguments[0]),!this.owner)return void alert(pergola.messages.missingOwner+"Scrollbar");var t=0;return"navigation"==this.scrollType&&((this.owner.type="map")&&(this.pageFrequence=500),this.initial="middle",t=16),this.fn=this.fn||this.vertScrollByPageInit,this.sliderFn=this.sliderFn||this.vertScrollBySliderInit,this.backScrollFn=this.backScrollFn||"map"==this.owner.type?this.mapVertBackStepScroll:this.vertBackStepScroll,this.fwdScrollFn=this.fwdScrollFn||"map"==this.owner.type?this.mapVertFwdStepScroll:this.vertFwdStepScroll,this.scrollButtonSize=this.size+2,this.margins=2*this.scrollButtonSize,this.y=this.scrollTarget.y+this.scrollButtonSize,this.container=$C({element:"g",id:this.id,appendTo:this.parent}),this.track=$C({element:"rect",x:.5,y:this.scrollButtonSize-.5,width:this.size-1,height:0,fill:this.vertTrackFill,stroke:this.stroke,appendTo:this.container}),this.registerEvents(this.track,["mousedown"]),this.slider=new pergola.ScrollSlider(this.id+"_slider").buildV({owner:this,parent:this.container,pos:0,x:this.padding,y:this.scrollButtonSize+this.sliderClearance/4,width:this.size-2*this.padding,height:t,scrollTarget:this.scrollTarget.ctm}),this.registerEvents(this.slider.bar,["mousedown"]),this.backScroll=new pergola.ScrollButton(this.id+"_backScroll").build({owner:this,parent:this.container,fn:this.backScrollFn,width:this.size-1,height:this.size+1,stroke:this.stroke,symbol:{symbol:this.symbol.up}}),this.fwdScroll=new pergola.ScrollButton(this.id+"_fwdScroll").build({owner:this,parent:this.container,fn:this.fwdScrollFn,width:this.size-1,height:this.size+1,stroke:this.stroke,symbol:{symbol:this.symbol.down}}),this}}),i=e.scrollButton,t(pergola.ScrollButton.prototype,{width:i.width,height:i.height,fill:i.fill,maskFill:i.maskFill,stroke:i.stroke,handleEvent:function(t){var e=t.type;return t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp?void("mousedown"==e&&pergola.preemptiveIsUp.warn()):(("mouseover"==e||"mouseout"==e)&&this.rollover(t),void("mousedown"==e?(this.registerEvents(this.button,["mouseup"]),this.owner.callback=this.fn,this.owner.callback(t),this.timer?this.timer.initialize():this.timer=pergola.Timer().initialize({handle:this.owner,callback:this.fn,delay:this.owner.delay,frequence:this.owner.stepFrequence})):("mouseup"==e||"mouseout"==e)&&(this.timer&&this.timer.clear(),this.unregisterEvents(this.button,["mouseup"]),this.owner.callback=null)))},build:function(){if(pergola.extend(this,arguments[0]),!this.owner&&!this.fn)return void alert(pergola.messages.missingHandler+"ScrollButton");var t={width:this.width,height:this.height,fill:this.fill,"fill-opacity":0,stroke:this.stroke},e={width:this.width,height:this.height,fill:this.maskFill},i=this.setPositionToStrokeWidth(t["stroke-width"]||1);return this.extra&&pergola.extend(t,this.extra),i&&(e.y=e.x=t.y=t.x=i),this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.mask=$C(pergola.extend({element:"rect",appendTo:this.container},e)),this.button=$C(pergola.extend({element:"rect",appendTo:this.container},t)),this.hasVisualEffects&&this.registerEvents(this.button,["mouseover","mouseout"]),this.registerEvents(this.button,["mousedown"]),this.symbol&&(this.symbol=pergola.symbol.call(this,this.symbol)),this.extra&&delete this.extra,this}}),i=e.scrollSlider,t(pergola.ScrollSlider.prototype,{rx:i.rx,fill:i.fill,stroke:i.stroke,minSize:16,buildH:function(){pergola.extend(this,arguments[0]);var t=this.setPositionToStrokeWidth("none"!=this.stroke|0);return this.container=$C({element:"g",id:this.id,appendTo:this.parent}),this.bar=$C({element:"rect",x:this.x,y:this.y+t,rx:this.rx,width:this.width,height:this.height-2*t,fill:this.fill.horizontal,stroke:this.stroke,appendTo:this.container}),this},buildV:function(){pergola.extend(this,arguments[0]);var t=this.setPositionToStrokeWidth("none"!=this.stroke|0);return this.container=$C({element:"g",id:this.id,appendTo:this.parent}),this.bar=$C({element:"rect",x:this.x+t,y:this.y,rx:this.rx,width:this.width-2*t,height:this.height,fill:this.fill.vertical,stroke:this.stroke,appendTo:this.container}),this}}),i=e.selector,t(pergola.Selector.prototype,{"font-size":i["font-size"],fill:i.fill,stroke:i.stroke,"stroke-width":i["stroke-width"],maskFill:i.maskFill,rx:i.rx,width:i.width,height:i.height,listItemHeight:20,selection:null,index:0,close:function(){if(this.selection){for(var t in this.list)if(this.selection.string==this.list[t]){this.index=+t,this.popUpList.container.setAttributeNS(null,"transform","translate(0 "+(-(this.popUpList.listItemHeight+2)*this.index-2)+")");break}this.textDataUpdate(this.selection.string)}this.unregisterEvents(pergola.doc,"mousedown"),this.popUpList.container.setAttributeNS(null,"display","none")},handleEvent:function(t){return t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp?void pergola.preemptiveIsUp.warn():(this.parent.appendChild(this.container),this.popUpList.container.setAttributeNS(null,"display","block"),void(t.target.parentNode==this.container?this.registerEvents(pergola.doc,"mousedown"):t.currentTarget==pergola.doc&&(this.popUpList.container.setAttributeNS(null,"display","none"),this.unregisterEvents(pergola.doc,"mousedown"))))},build:function(){pergola.extend(this,arguments[0]);$C({element:"g",transform:"translate(0 "+this.y+")",appendTo:this.parent});this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.button=$C({element:"rect",x:.5,y:.5,rx:this.rx,width:this.width,height:this.height,fill:this.fill,stroke:this.stroke,appendTo:this.container}),this.registerEvents(this.container,"mousedown"),$C({element:"path",d:"M8,14v-6.5h"+(this.width-15),fill:"none",stroke:"#FFFFFF","stroke-width":8,"stroke-linecap":"round","stroke-linejoin":"round","pointer-events":"none",appendTo:this.container}),this.text=$C({element:"text",x:9,y:15,"font-size":this["font-size"],fill:"#204020","pointer-events":"none",textNode:this.list[this.index],appendTo:this.container}),$C({element:"rect",x:2,y:2,rx:this.rx-1.5,width:this.width-3,height:this.height-3,fill:"none",stroke:"#E3F1F6","stroke-width":2,opacity:1,"pointer-events":"none",appendTo:this.container}),$C({element:"path",d:"M"+(this.width-36)+","+this.height+"h30q6,0,6-6v-8q0-6-6-6h-10z",fill:"#E5E9E5",stroke:"none",opacity:.35,"pointer-events":"none",appendTo:this.container}),pergola.symbol.call(this,{symbol:pergola.symbols.selectorArrow.up,x:this.width-10,y:5}),pergola.symbol.call(this,{symbol:pergola.symbols.selectorArrow.down,x:this.width-10,y:17}),this.popUpList=new pergola.PopupList(this.id+"_popUpList").build({owner:this,parent:this.container,width:this.width,list:this.list}),this.caption&&(this.caption=(new pergola.Caption).build(pergola.extend(this.caption,{owner:this,parent:this.container})))}}),i=e.separator,t(pergola.Separator.prototype,{width:i.width,height:i.height,stroke:i.stroke,build:function(){return pergola.extend(this,arguments[0]),this.type?"horizontal"!=this.type&&"vertical"!=this.type?void alert(pergola.messages.wrongSeparatorType+this.type):(this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")","pointer-events":"none",appendTo:this.parent}),$C("horizontal"==this.type?{element:"path",d:"M0,"+this.height/2+"h"+this.width,stroke:this.stroke,appendTo:this.container}:{element:"path",d:"M"+(this.width/2+.5)+",0v"+this.height,stroke:this.stroke,"stroke-linecap":"round",appendTo:this.container}),this.sweep(["type"]),this):void alert(pergola.messages.missingSeparatorType)}}),i=e.slider,t(pergola.Slider.prototype,{"font-size":i["font-size"],shape:i.shape,size:i.size,type:i.type,numberOfSteps:4,initial:i.initial,extent:127,valueTip:i.valueTip,rx:i.rx,fill:i.fill,stroke:i.stroke,trackFill:i.trackFill,trackStroke:i.trackStroke,trackOpacity:i.trackOpacity,slotStroke:i.slotStroke,slotSize:i.slotSize,release:function(){this.valueTipGroup.setAttributeNS(null,"display","none"),this.quickTip&&(this.quickTip.timer&&this.quickTip.timer.clear(),this.quickTip.hide())},horizontalSliderInit:function(t){return{callback:this.horizontalSlideByButton,handle:this,offset:t.clientX-this.pos,updateCoordinates:!1}},verticalSliderInit:function(t){return{callback:this.verticalSlideByButton,handle:this,offset:t.clientY-this.pos,updateCoordinates:!1}},horizontalSlideByButton:function(t){var e=this.handle,i=t.clientX-this.offset;if("discrete"==e.type){if(i<e.pos&&i>e.pos-e.step||i>e.pos&&i<e.pos+e.step)return;e.pos+=e.step*(i>e.pos)-e.step*(i<e.pos)}else e.pos=i;e.pos<0&&(e.pos=0),e.pos>e.extent&&(e.pos=e.extent),e.buttonGroup.setAttributeNS(null,"transform","translate("+e.pos+" 0)"),e.textDataUpdate(e.pos),e.fn&&e.checkUserFunction(t)},verticalSlideByButton:function(t){var e=this.handle,i=t.clientY-this.offset;if("discrete"==e.type){if(i<e.pos&&i>e.pos-e.step||i>e.pos&&i<e.pos+e.step)return;e.pos+=e.step*(i>e.pos)-e.step*(i<e.pos)}else e.pos=i;e.pos<0&&(e.pos=0),e.pos>e.extent&&(e.pos=e.extent),e.buttonGroup.setAttributeNS(null,"transform","translate(0 "+e.pos+")"),e.textDataUpdate(e.pos),e.fn&&e.checkUserFunction(t)},horizontalSlideByTrack:function(t){var e=this.absoluteX(this.container)+this.pos,i=pergola.mousePoint(t);"discrete"==this.type?this.pos+=this.step*(i.x>e)-this.step*(i.x<e):"linear"==this.type&&(this.pos+=i.x-e),this.buttonGroup.setAttributeNS(null,"transform","translate("+this.pos+" 0)"),this.textDataUpdate(this.pos),this.fn&&this.checkUserFunction(t)},verticalSlideByTrack:function(t){var e=this.absoluteY(this.container)+this.pos,i=pergola.mousePoint(t);"discrete"==this.type?this.pos+=this.step*(i.y>e)-this.step*(i.y<e):"linear"==this.type&&(this.pos+=i.y-e),this.buttonGroup.setAttributeNS(null,"transform","translate(0 "+this.pos+")"),this.textDataUpdate(this.pos),this.fn&&this.checkUserFunction(t)},handleEvent:function(t){return t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp?void pergola.preemptiveIsUp.warn():void("mousedown"==t.type&&t.target==this.button?(this.valueTip&&this.valueTipGroup.setAttributeNS(null,"display","block"),this.quickTip&&this.quickTipInit(t),pergola.dragarea.activate(this.sliderFn(t))):t.target==this.track&&this.trackFn(t))},buildH:function(){pergola.extend(this,arguments[0]),this.sliderFn=this.horizontalSliderInit,this.trackFn=this.horizontalSlideByTrack,this.size=this.size.evenToOdd();var t,e,i=this.size,o=this.shape,s=this.initial,n=i/2,r=this.slotSize.isEven();if(this.trackSize=this.trackSize||i+1,t=n-.5*r-this.trackSize/2,e="round"==o?this.trackSize/2:4,"round"!=o&&"square"!=o)return void alert(pergola.messages.header+this.name+pergola.messages.wrongButtonShape+o);if("start"!=s&&"middle"!=s&&"end"!=s)return void alert(pergola.messages.header+this.name+pergola.messages.wrongSliderPosition+s);if(this.pos=parseInt(this.extent/2)*("middle"==s)+this.extent*("end"==s),this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.registerEvents(this.container,"mousedown"),this.track=$C({element:"rect",y:-.5-.5*r,rx:e,width:this.extent,height:this.trackSize,fill:this.trackFill,stroke:this.trackStroke,opacity:this.trackOpacity,appendTo:this.container}),0!=this.slotSize&&$C({element:"path",d:"M0,"+(n-.5*r)+"h"+this.extent,stroke:this.slotStroke,"stroke-width":this.slotSize,"pointer-events":"none",appendTo:this.container}),"discrete"==this.type){"middle"==this.initial&&(this.numberOfSteps=this.numberOfSteps.oddToEven()),this.step=this.extent/this.numberOfSteps;for(var a=$C({element:"g",transform:"translate(0 -4)",appendTo:this.container}),s=1;s<this.numberOfSteps;s++)$C({element:"path",d:"M"+(parseInt(this.step*s)+.5)+",0v1",stroke:"#878787",appendTo:a})}return this.buttonGroup=$C({element:"g",id:this.id+"_buttonGroup",transform:"translate("+this.pos+" 0)",appendTo:this.container}),this.button=$C("round"==o?{element:"circle",cx:0,cy:n-.5*r,r:n,fill:this.fill,stroke:this.stroke,appendTo:this.buttonGroup}:{element:"rect",x:-n,y:-.5*r,rx:this.rx,width:i,height:i,fill:this.fill,stroke:this.stroke,appendTo:this.buttonGroup}),this.valueTipGroup=$C({element:"g",id:this.id+"_valueTipGroup",transform:"translate(0 "+-i+")",display:"none",appendTo:this.buttonGroup}),$C({element:"rect",x:-8.5,y:-7.5,width:18,height:14,fill:"url(#quickTipGrad)",stroke:"#989898",appendTo:this.valueTipGroup}),this.text=$C({element:"text",y:3,"font-size":this["font-size"],"text-anchor":"middle","pointer-events":"none",textNode:this.pos,appendTo:this.valueTipGroup}),this.quickTip&&this.quickTipFormat(),this
},buildV:function(){pergola.extend(this,arguments[0]),this.sliderFn=this.verticalSliderInit,this.trackFn=this.verticalSlideByTrack,this.size=this.size.evenToOdd();var t,e,i=this.size,o=this.shape,s=this.initial,n=i/2,r=this.slotSize.isEven();this.trackSize=this.trackSize||i+1;var t=n-.5*r-this.trackSize/2;if(e="round"==o?this.trackSize/2:4,"round"!=o&&"square"!=o)return void alert(pergola.messages.header+this.name+pergola.messages.wrongButtonShape+o);if("start"!=s&&"middle"!=s&&"end"!=s)return void alert(pergola.messages.header+this.name+pergola.messages.wrongSliderPosition+s);if(this.pos=parseInt(this.extent/2)*("middle"==s)+this.extent*("end"==s),this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.registerEvents(this.container,"mousedown"),this.track=$C({element:"rect",x:t,rx:e,width:this.trackSize,height:this.extent,fill:this.trackFill,stroke:this.trackStroke,opacity:this.trackOpacity,appendTo:this.container}),0!=this.slotSize&&$C({element:"path",d:"M"+(n-.5*r)+",0v"+this.extent,stroke:this.slotStroke,"stroke-width":this.slotSize,"pointer-events":"none",appendTo:this.container}),"discrete"==this.type){"middle"==this.initial&&(this.numberOfSteps=this.numberOfSteps.oddToEven()),this.step=this.extent/this.numberOfSteps;for(var s=($C({element:"g",transform:"translate(-4 0)",appendTo:this.container}),1);s<this.numberOfSteps;s++)$C({element:"path",d:"M-3,"+(parseInt(this.step*s)+.5)+"h1",stroke:"#878787",appendTo:this.container})}return this.buttonGroup=$C({element:"g",id:this.id+"_buttonGroup",transform:"translate(0 "+this.pos+")",appendTo:this.container}),this.button=$C("round"==o?{element:"circle",cx:n-.5*r,cy:0,r:n,fill:this.fill,stroke:this.stroke,appendTo:this.buttonGroup}:{element:"rect",x:-.5*r,y:-n,rx:this.rx,width:i,height:i,fill:this.fill,stroke:this.stroke,appendTo:this.buttonGroup}),this.valueTipGroup=$C({element:"g",id:this.id+"_valueTipGroup",transform:"translate(-16 0)",display:"none",appendTo:this.buttonGroup}),$C({element:"rect",x:-8.5,y:-6.5,width:18,height:14,fill:"url(#quickTipGrad)",stroke:"#A8A8A8",appendTo:this.valueTipGroup}),this.text=$C({element:"text",y:4,"font-size":this["font-size"],"text-anchor":"middle","pointer-events":"none",textNode:this.pos,appendTo:this.valueTipGroup}),this.quickTip&&this.quickTipFormat(),this}}),i=e.statusBar,t(pergola.StatusBar.prototype,{fill:i.fill,height:i.height,"font-size":i["font-size"],textFill:e.text.fill,advanceX:i.advanceX,center:function(t){this.centerLon.firstChild.data=t.lon.toFixed(4),this.centerLat.firstChild.data=t.lat.toFixed(4)},location:function(t){var e=this.owner.lonToRange(t.lon);this.owner.locLon.value=this.owner.locLon.element.firstChild.data=e.toFixed(4),this.owner.locLat.value=this.owner.locLat.element.firstChild.data=t.lat.toFixed(4)},zoom:function(t){if(this.owner.zoomLevel){var e=this.owner.map?t:(100*t).trim(3);this.owner.zoomLevel.value=this.owner.zoomLevel.element.firstChild.data=e+""}},coordinates:function(t){var e=pergola.Window.active(),i=e.doc,o=(t.clientX-(i.absoluteX(i.container)+i.ctm.e))/i.scaleFactor,s=(t.clientY-(i.absoluteY(i.container)+i.ctm.f))/i.scaleFactor;pergola.browser.firefox&&(o=(t.clientX-(i.ff_absoluteX()+i.x+i.ctm.e))/i.scaleFactor,s=(t.clientY-(i.ff_absoluteY()+i.y+i.ctm.f))/i.scaleFactor),e.status&&(e.status.coorX.firstChild.data=window.surveyor?surveyor.convertToSI(o):o,e.status.coorY.firstChild.data=window.surveyor?surveyor.convertToSI(s):s)},addFields:function(){var t,e,i,o,s=pergola.messages.fieldExists;arguments[0]&&(this.fields=arguments[0]);for(var n in this.fields)n in this?alert(s[0]+n+s[1]):(t=this.fields[n],t.input?(pergola.extend(t.input,{owner:t.input.owner||this.owner.doc,parent:this.container,y:Math.ceil((this.height-t.input.height)/2)}),this.owner[n]=(new pergola.Input).build(t.input)):(i=$C({element:"g",transform:"translate("+this.advanceX+" "+this.textCenterVertical(this.height,this.fontSize)+")","pointer-events":"none",appendTo:this.container}),o=$C({element:"text","font-size":this["font-size"],fill:this.textFill,textNode:t.caption+" ",appendTo:i}),this[n]=$C({element:"tspan",textNode:t.value||" ",appendTo:o})),e=this.owner[n]?this.owner[n].container:i,this.advanceX+=e.getBBox().width+60);delete this.fields},handleEvent:function(t){return 2==t.button&&this.contextMenuItems?void this.setContextmenu(t,this.bar,this.contextMenuItems):"mousedown"==t.type&&(t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp)?void pergola.preemptiveIsUp.warn():void 0},build:function(){return pergola.extend(this,arguments[0]),this.owner.constructor!=pergola.Window?void alert(pergola.messages.wrongStatusOwner):(this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.bar=$C({element:"rect",width:0,height:this.height,fill:this.fill,appendTo:this.container}),this.registerEvents(this.bar,["mousedown"]),this.fields&&this.addFields(),this)}}),i=e.suffix,t(pergola.Suffix.prototype,{position:i.position,"text-anchor":i["text-anchor"],activator:!1}),i=e.tab,t(pergola.Tab.prototype,{"font-size":i["font-size"],width:i.width,height:i.height,margin:i.margin,fill:i.fill,"fill-opacity":i["fill-opacity"],hasVisualEffects:!0,active:!1,rollover:function(t){this.button.setAttributeNS(null,"fill-opacity","mouseover"==t.type||this["fill-opacity"])},handleEvent:function(t){var e,i=this.owner;if(pergola.preemptiveIsUp)return void("mousedown"==t.type&&pergola.preemptiveIsUp.warn());if("mouseover"==t.type||"mouseout"==t.type)this.active||this.rollover(t);else if("mousedown"==t.type&&t.target==this.button){for(var o in i.tabs)e=i[o],e!=this?(e.button.setAttributeNS(null,"fill-opacity",this["fill-opacity"]),e.active=!1):this.owner.pane=this.pane;this.button.setAttributeNS(null,"fill-opacity",1),this.parent.appendChild(this.container),this.active=!0,i.comboBox=this.comboBox}},build:function(){if(pergola.extend(this,arguments[0]),!this.owner)return void alert(pergola.messages.missingOwner+"Tab");var t=this.owner,e=+this.active||this["fill-opacity"],i=4,o=4,s=this.width-2*i-2*o,n=this.height-i,r=(i/(n/i)).trim(3),a="M"+this.x+",0v-.5h.5l"+o+"-"+(n-.5)+"c"+r/2+",-"+i/2+" "+r+",-"+i+","+(i+r)+",-"+i+"h"+s+"q"+i+",0,"+i+","+i+"v"+n;if(this.container=$C({element:"g",id:this.id,transform:"translate("+(t.margin+1)+" "+this.y+")",appendTo:this.parent}),this.pane={width:t.width-2*t.margin,height:t.height-t.topBar.height-t.footerHeight,container:$C({element:"g",id:this.id+"_pane",appendTo:this.container})},$C({element:"rect",x:-.5,y:-.5,width:this.pane.width,height:this.pane.height,fill:"white",stroke:"#A0A0A0",appendTo:this.pane.container}),this.active&&(this.owner.pane=this.pane),this.button=$C({element:"path",d:a,fill:this.fill,stroke:"#A0A0A0","fill-opacity":e,appendTo:this.container}),this.hasVisualEffects&&this.registerEvents(this.button,["mouseover","mouseout"]),this.registerEvents(this.container,["mousedown"]),this.text=$C({element:"text",x:this.x+this.width/2,y:-this.height/2+3,"font-size":this["font-size"],"text-anchor":"middle","pointer-events":"none",textNode:this.title,appendTo:this.container}),this.layout){var l=pergola.extend(this.layout,{owner:this,parent:this.pane.container,x:this.layout.x||this.margin,y:this.layout.y||this.margin,width:this.layout.width||this.pane.width-2*this.margin,height:this.layout.height||this.pane.height-2*this.margin});this.layout=(new pergola.Layout).build(l)}return this.contains&&("function"==typeof this.contains?this.contains():this.pane.appendChild(this.contains)),this.sweep(["string"]),this}}),t(pergola.TabsDock.prototype,{reorganize:function(){var t=pergola.presentationAttributes.windowTab.width,e=(t+1)*pergola.Window.tabs.length,i=pergola.width()-200,o=this.container.childNodes;i-=i%(t+1),e>i&&(e=i);for(var s=0;s<o.length;s++)1==o.item(s).nodeType&&o.item(s).setAttributeNS(null,"transform","translate("+s*(t+1)+" 0)")},build:function(){return pergola.extend(this,arguments[0]),this.closedGroup=$C({element:"g",id:this.id+"_closedGroup",display:"none",appendTo:this.parent}),this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this}}),t(pergola.Taskbar.prototype,{width:e.taskBar.width,height:e.taskBar.height,position:taskbarPosition,fill:e.taskBar.fill,display:"none",toggleOn:function(){var t=pergola.Window.tabs,e=pergola.tabsDock;for(var i in t)t[i].mask.setAttributeNS(null,"fill","none");this.display="block",this.toggle(),this.container.appendChild(e.container),e.container.setAttributeNS(null,"transform","translate("+e.x+" "+e.y+")")},toggleOff:function(){var t=pergola.Window.tabs,e=pergola.tabsDock;for(var i in t)t[i].mask.setAttributeNS(null,"fill",t[i].maskFill);this.display="none",pergola.systemComponents.insertBefore(e.container,pergola.contextMenus),e.container.setAttributeNS(null,"transform","translate("+this.x+" "+this.y+")"),this.toggle()},toggle:function(){this.container.setAttributeNS(null,"display",this.display)},handleEvent:function(t){t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp},build:function(){if(pergola.extend(this,arguments[0]),"top"==this.position)this.y=0;else{if("bottom"!=this.position)return void alert(pergola.messages.wrongTaskBarPosition+this.position);this.y=pergola.height()-this.height}return this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",display:this.display,appendTo:this.parent}),this.rect=$C({element:"rect",width:this.width,height:this.height,fill:this.fill,appendTo:this.container}),this.registerEvents(this.container,"mousedown"),this.owner==pergola&&pergola.systemMenu&&(pergola.menubar=(new pergola.Menubar).build({parent:this.container,x:40,y:"top"==this.position?10:6,fill:"none"})),this}}),t(pergola.ToolBar.prototype,{fill:e.toolBar.fill,width:0,rx:e.toolBar.rx,height:e.toolBar.height,advanceX:6,spacing:e.toolBar.spacing,hasDecoration:e.toolBar.hasDecoration,decor:e.toolBar.decoration,organize:function(){},handleEvent:function(t){return t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp?void pergola.preemptiveIsUp.warn():2==t.button&&this.contextMenuItems?void this.setContextmenu(t,this.bar,this.contextMenuItems):void 0},build:function(){return pergola.extend(this,arguments[0]),this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.bar=$C({element:"rect",rx:this.rx,width:this.width,height:this.height,fill:this.fill,appendTo:this.container}),this.registerEvents(this.bar,["mousedown"]),this.hasDecoration&&(this.decor.height=this.height-8,this.decoration=$C({element:"rect",x:3.5,y:2.5,rx:this.decor.rx,width:this.width,height:this.decor.height,fill:this.decor.fill,stroke:this.decor.stroke,appendTo:this.container})),this.groups=[],this}}),t(pergola.ToolButton.prototype,{width:e.toolButton.width,height:e.toolButton.height,fill:e.toolButton.fill,stroke:e.toolButton.stroke,maskFill:e.toolButton.maskFill,rx:e.toolButton.rx,selected:!1,suspended:!1,exclusive:!1,prevent:!1,type:"regular",cursor:"default",handleEvent:function(t){if(t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp)return void("mousedown"==t.type&&pergola.preemptiveIsUp.warn());var e=this.owner&&this.owner.constructor==pergola.Window;if("mouseover"==t.type){if(e&&this.owner.currentTool==this)return;this.rollover(t),this.quickTip&&(this.quickTipInit(t),this.mouse=pergola.mousePoint(t),e&&(this.owner.currentTool=this))}else"mouseout"==t.type?(this.quickTip&&this.quickTip.hide(),e&&(this.owner.currentTool=null),this.selected||this.rollover(t)):"mousedown"==t.type?(this.quickTip&&this.quickTip.hide(),e&&this.exclusive&&this.owner.toolInit(t,this)):"mousemove"==t.type&&(this.mouse=pergola.mousePoint(t));if(this.ev)for(var i in this.ev)if(this.ev[i]==t.type){this.checkUserFunction(t);break}}}),i=e.topBar,t(pergola.TopBar.prototype,{height:i.height.panel,fill:i.fill.panel,preemptiveFill:i.preemptiveFill,textFill:e.text.fill,preemptiveWarning:function(t){return t.repeatCount++==t.repeats?void t.clear():void this.bar.setAttributeNS(null,"fill",t.repeatCount.isEven()?this.fill:this.preemptiveFill)},makePath:function(){var t=this.width,e=this.height,i=this.rx;return"M"+this.x+","+(e+this.x)+"v-"+(e-i)+"q0,-"+i+","+i+",-"+i+"h"+(t-2*i)+"q"+i+",0,"+i+","+i+"v"+(e-i)+"z"},resize:function(t){this.width=t,this.bar.setAttributeNS(null,"d",this.makePath()),this.title.setAttributeNS(null,"x",this.width/2)},handleEvent:function(t){var e=this.owner;t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp||pergola.dragarea.activate({callback:e.move,handle:e,target:e.container,offset:{x:t.clientX-e.x,y:t.clientY-e.y}})},build:function(){pergola.extend(this,arguments[0]);var t,i,o,s,n,r,a=this.owner;return a?(a.layout&&(this.height+=(e.tab.height-.5)*!!a.layout.tabs),"messageBox"==a.type&&(this.fill=e.topBar.fill.messageBox,this.stroke="#000000"),t={fill:this.fill,stroke:this.stroke},this.extra&&pergola.extend(t,this.extra),this.x=this.setPositionToStrokeWidth(t["stroke-width"]||1),o=this.width,s=this.height,r=this.rx,this.container=$C({element:"g",id:this.id,appendTo:this.parent}),t.d=this.makePath(),this.bar=$C(pergola.extend({element:"path",appendTo:this.container},t)),i=this.textCenterVertical(s),a.layout&&a.layout.tabs&&(i-=6),n="normal",a.layout&&"message"==a.layout.type&&(this.textFill=e.text.fill,n="bold",i+=1),this.title=$C({element:"text",x:o/2,y:i,fill:this.textFill,"font-weight":n,"letter-spacing":1,kerning:0,"text-anchor":"middle","pointer-events":"none",textNode:a.title,appendTo:this.container}),this.registerEvents(this.bar,"mousedown"),this.extra&&delete this.extra,this):void alert(pergola.messages.missingOwner+"TopBar")}}),i=e.upDownButton,t(pergola.UpDownButton.prototype,{width:i.width,height:i.height,rx:i.rx,handleEvent:function(t){return t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp?void("mousedown"==t.type&&pergola.preemptiveIsUp.warn()):("mousedown"==t.type&&(this.registerEvents(this.button,"mouseup"),this.owner[this.callback](),this.timer=pergola.Timer().initialize({handle:this,callback:function(){this.owner[this.callback]()},delay:400,frequence:30,destroy:"timer"})),("mouseup"==t.type||"mouseout"==t.type)&&(this.timer&&(this.timer.clear(),this.realTime||this.owner.setByButton()),this.unregisterEvents(this.button,["mouseup"])),void(("mouseover"==t.type||"mouseout"==t.type)&&this.rollover(t)))},build:function(){if(pergola.extend(this,arguments[0]),!this.owner&&!this.fn)return void alert(pergola.messages.missingHandler+"UpDownButton");var t={width:this.width,height:this.height,fill:this.fill,"fill-opacity":0,stroke:this.stroke},e={width:this.width,height:this.height,fill:this.maskFill},i=this.setPositionToStrokeWidth(t["stroke-width"]||1);return this.rx&&(t.rx=e.rx=this.rx),i&&(e.y=e.x=t.y=t.x=i),this.container=$C({element:"g",id:this.id,transform:"translate("+this.x+" "+this.y+")",appendTo:this.parent}),this.mask=$C(pergola.extend({element:"rect",appendTo:this.container},e)),this.button=$C(pergola.extend({element:"rect",appendTo:this.container},t)),this.registerEvents(this.button,"mousedown"),this.hasVisualEffects&&this.registerEvents(this.button,["mouseover","mouseout"]),this.symbol&&(this.symbol=pergola.symbol.call(this,this.symbol)),this}}),t(pergola.Window,{windows:[],tabs:[],untitled:1,unnamed:function(){return"Untitled_"+pergola.Window.untitled++},active:function(){return pergola.Window.windows[pergola.Window.windows.length-1]},exist:function(t){for(var e in pergola.Window.windows)if(t==pergola.Window.windows[e].name)return!0;return!1}}),i=e.window,t(pergola.Window.prototype,{isOpen:!0,minimized:!1,isFull:!1,resizable:!0,fill:i.fill,scrollSize:i.scrollSize,x:200,y:160,margin:4,width:680,height:520,minWidth:340,minHeight:200,hasCommands:!0,hasToolBar:!0,hasZoomAndPan:!0,hasStatus:!0,statusHeight:0,hasUndo:!1,mousewheel:"zoom",docBgResizable:!0,fullW:function(){return pergola.width()+1},fullH:function(){return pergola.height()-pergola.taskbar.height+1},type:"regular",scrollType:"regular",dependencies:!1,move:pergola.Window.superClass.moveXY,logoMaker:function(t){if(this.logo){if(!t.replace)return;this.topBar.container.removeChild(this.logo)}this.logo=pergola.symbol({symbol:t.symbol,x:t.x,y:t.y,width:t.width,height:t.height,parent:this.topBar.container})},closeGroupPos:function(){return this.width-this.margin-3*(pergola.CommandButton.prototype.width+6)+" "+(this.margin+2)},bringToFront:function(){var t,e,i,o=pergola.Window.windows;if(this.parent.appendChild(this.container),!this.isTop){for(t in o)if(o[t]==this){o.splice(t,1);break}for(t in o)if(i=o[t],i.isTop){i.isTop=!1,i.topBar.mask.setAttributeNS(null,"opacity",.5),i.topBar.title.setAttributeNS(null,"opacity",.5),i.removePointerEvents([i.doc.container]),i.background.cursor="default",i.background.rect.setAttributeNS(null,"cursor","default"),i.doc.container.setAttributeNS(null,"cursor","default"),i.undoManager&&i.undoManager.disable();for(e in i.exclusiveTools)if(i.exclusiveTools[e].selected){i.exclusiveTools[e].suspended=!0;break}break}pergola.Window.windows.push(this),this.isTop=!0;for(t in this.exclusiveTools)if(e=this.exclusiveTools[t],e.selected){e.suspended=!1,this.background.cursor=e.cursor;break}this.setPointerEvents([this.doc.container]),pergola.setCursor(this.background.rect,this.background.cursor),pergola.setCursor(this.doc.container,this.background.cursor),this.undoManager&&this.undoManager.register(),this.topBar.mask.setAttributeNS(null,"opacity",0),this.topBar.title.setAttributeNS(null,"opacity",1),this.dependencies&&this.updateDependencies()}},getCandidate:function(){var t,e,i=pergola.Window.windows;for(t=i.length-1;t>=0;t--)if(e=i[t],e!=this&&!e.minimized&&e.isOpen){e.bringToFront();break}},release:function(){},minimize:function(){this.container.setAttributeNS(null,"display","none"),this.minimized=!0,this.preview.hide(),this.getCandidate()},restore:function(){this.container.setAttributeNS(null,"display","block"),this.preview.hide(),this.minimized=!1,this.bringToFront()},maximizeInit:function(){this.isFull?this.reduce():this.maximize(),this.doc.transformUpdate(),this.release()},maximize:function(){this.reducedX=this.x,this.reducedY=this.y,this.reducedWidth=this.width,this.reducedHeight=this.height,this.x=0,this.y=pergola.taskbar.height*("top"==pergola.taskbar.position),this.width=this.fullW(),this.height=this.fullH(),this.setXYWH(this.container),this.doc.transformUpdate(),this.isFull=!0},reduce:function(){this.x=this.reducedX,this.y=this.reducedY,this.width=this.reducedWidth,this.height=this.reducedHeight,this.setXYWH(this.container),this.doc.transformUpdate(),this.isFull=!1},transformUpdate:function(t,e){this.datagrid&&(this.datagrid.gutterPositionOnScroll(this.doc),this.datagrid.headerPositionOnScroll(this.doc)),this.map&&this.map.grid&&this.mapGutterPositionOnScroll(),pergola.attribute(this.background.rect,{width:t+1,height:e+1}),this.background["xlink:href"]&&pergola.attribute(this.background.image,{width:t,height:e}),pergola.attribute(this.frame.rect,{width:this.width-1,height:this.height-1}),this.topBar.title.setAttributeNS(null,"x",this.width/2),this.topBar.bar.setAttributeNS(null,"width",t+2),this.topBar.mask.setAttributeNS(null,"width",t+2),this.toolBar&&(this.toolBar.bar.setAttributeNS(null,"width",t+2),this.toolBar.decoration&&this.toolBar.decoration.setAttributeNS(null,"width",t+2-8)),this.status&&(this.status.container.setAttributeNS(null,"transform","translate("+this.margin+" "+(this.height-this.status.height-this.margin)+")"),this.status.bar.setAttributeNS(null,"width",this.width-2*this.margin)),this.closeGroup&&this.closeGroup.setAttributeNS(null,"transform","translate("+this.closeGroupPos()+")")},resizeByButton:function(t){if(!this.isFull){var e=pergola.mousePoint(t);return"editor"==this.type&&(this.scaleBar.container.setAttributeNS(null,"display","none"),this.compass.container.setAttributeNS(null,"display","none")),{callback:function(t){this.handle.resizeS(t,this.offset.y),this.handle.resizeE(t,this.offset.x)},handle:this,offset:{x:this.x+this.width-e.x,y:this.y+this.height-e.y},updateCoordinates:!1,cursor:"se-resize"}}},resizeN:function(t,e){var i=pergola.mousePoint(t);return this.height+=this.y-(i.y-e),this.height<this.minHeight?void(this.height=this.minHeight):(this.y=i.y-e,pergola.attribute(this.container,{height:this.height,y:this.y}),void this.doc.transformUpdate())},resizeS:function(t,e){var i=pergola.mousePoint(t);return this.height=i.y+e-this.y,this.height<this.minHeight?void(this.height=this.minHeight):(this.container.setAttributeNS(null,"height",this.height),void this.doc.transformUpdate())},resizeE:function(t,e){var i=pergola.mousePoint(t);return this.width=i.x+e-this.x,this.width<this.minWidth?void(this.width=this.minWidth):(this.container.setAttributeNS(null,"width",this.width),void this.doc.transformUpdate())},resizeW:function(t,e){var i=pergola.mousePoint(t);return this.width+=this.x-(i.x-e),this.width<this.minWidth?void(this.width=this.minWidth):(this.x=i.x-e,pergola.attribute(this.container,{width:this.width,x:this.x}),void this.doc.transformUpdate())},close:function(){return"editor"==this.type?void(confirm(pergola.messages.closeConfirm)&&this.terminate()):(this.container.setAttributeNS(null,"display","none"),this.isOpen=!1,this.tab.close(),void this.getCandidate())},terminate:function(){var t,e=pergola.Window.windows;this.getCandidate(),this.tab.remove(),this.parent.removeChild(this.container);for(t in e)this==e[t]&&e.splice(t,1);this.undoManager&&this.undoManager.disable();for(t in this.exclusiveTools)if(this.exclusiveTools[t].selected){this.releaseTool(this.exclusiveTools[t]);break}pergola.xmlName.remove(this.name),pergola.destroy(this.owner,this.name)},reopen:function(){this.isOpen=!0,pergola.Window.tabs.push(this.tab),this.parent.appendChild(this.container),this.container.setAttributeNS(null,"display","block"),this.tab.open()},toolInit:function(t,e){if(2==t.detail)switch(e){case this.lensTool:this.lensToolDoubleClick(t);break;case this.handTool:this.handToolDoubleClick(t);break;case this.itineraryTool:this.itineraryToolDoubleClick(t)}e.selected?this.releaseTool(e):this.activateTool(e)},activateTool:function(t){var e,i;for(e in this.exclusiveTools)i=this.exclusiveTools[e],i.selected&&this.releaseTool(i);t.selected=!0,t.suspended=!1,this.doc.currentTool=t,this.buttonSelect(t),"editor"==this.type&&("selection"==t.type&&this.doc.updateSelection(),t.coordinates&&this.registerEvents(this.doc.transformable,"mousemove",this.status.coordinates)),this.map&&(this.map.remove(this.interact),t.location&&this.registerEvents(this.doc.transformable,"mousemove",this.getLocation)),pergola.setCursor(this.doc.container,t.cursor)},releaseTool:function(t){t.selected=!1,this.buttonDeselect(t),this.doc.container.setAttributeNS(null,"style","cursor:default;"),"editor"==this.type&&t.coordinates&&this.unregisterEvents(this.doc.transformable,"mousemove",this.status.coordinates),this.map&&(t.location&&this.unregisterEvents(this.doc.transformable,"mousemove",this.getLocation),this.map.add(this.interact)),this.doc.currentTool=null},lensToolDoubleClick:function(){var t=this.doc,e="editor"==this.type;return this.map?void this.mapZoom(2):void(1!=t.scaleFactor&&(t.scaleFactor=1,e&&t.hideSelectionOnScale(),t.scale(),e&&t.redrawOnScale()))},handToolDoubleClick:function(){if(this.map)this.centerMap({lon:0,lat:0}),this.mapZoom(1);else{var t=this.doc;t.ctm.e=t.ctm.f=0,t.matrixTransformApply(),t.horScrollSliderSync(),t.vertScrollSliderSync()}},itineraryToolDoubleClick:function(){this.doc.itinerary&&(this.doc.itinerary.remove(),delete this.doc.itinerary)},centerMap:function(t){this.map.center(t),this.status&&this.status.center(t)},getLocation:function(t){var e=pergola.Window.active(),i=e.doc,o=polymaps.origin,s=pergola.mousePoint(t),n=e.map.pointLocation({x:s.x-(i.ctm.e+o.x),y:s.y-(i.ctm.f+o.y)});e.status&&e.status.location(n)},setLocation:function(){var t={lat:this.locLat.value,lon:this.locLon.value};this.map.center(t),this.status&&this.status.center(t)},lonToRange:function(t){return-180>t?t+=360:t>180&&(t-=360),t},mapZoom:function(t){this.map.zoom(t),this.mapZoomLevelMark(t),this.status&&this.status.zoom(t)},showMapFeatureLayer:function(t){t.display="block"==t.display?"none":"block",t.container.setAttributeNS(null,"display",t.display)},mapZoomLevelMark:function(t){if(this.menu.zoomLevel){t=t||this.map.zoom();var e,i,o=this.menu.zoomLevel.list;for(e in o)i=o[e],i.check&&i.uncheck(),i.string==t&&i.setChecked()}},mapViewsToggle:function(t){var e,i,o=this.menu.views.list;for(var s in o.items)e=o[s],i=e.view==t,i?(e.fn(),e.check=!0,e.checkmark.setAttributeNS(null,"display","block")):(e.check=!1,e.checkmark.setAttributeNS(null,"display","none"))},mapGutterPositionOnScroll:function(){this.map.lonG.setAttributeNS(null,"transform","translate(0 "+-this.doc.ctm.f+")"),this.map.latG.setAttributeNS(null,"transform","translate("+-this.doc.ctm.e+" 0)")},mapHelpToggleOn:function(){this.navHelpPanel.container.setAttributeNS(null,"display","block"),this.mapHelpOn=!0,this.mapHelp.selected=!0,this.mapHelpSuspended=!1},mapHelpToggleOff:function(){this.navHelpPanel.container.setAttributeNS(null,"display","none"),this.mapHelpOn=!1,this.mapHelp.selected=!1},mapMaker:function(){var t=this.doc;polymaps.origin={x:this.x+t.x,y:this.y+t.y},this.map=polymaps.map(t).container(t.transformable.appendChild($C({element:"svg",id:this.id+"_tiles",width:this.canvas.width,height:this.canvas.height}))),this.interact=polymaps.interact(),this.map.add(this.interact),this.menu.zoomLevel&&this.mapZoomLevelMark(),this.currentView=this.views[this.view],this.status.center(this.map.center()),this.status.zoom(this.map.zoom()),queryBing.call(this,this.view)},datagridMaker:function(t){var e=this;if(t.binding)switch(t.binding.constructor){case String:pergola.xhrGET({url:t.binding,mime:"application/json",callback:function(i){pergola.extend(t,JSON.parse(i.responseText)),e.datagrid=pergola.extend(new pergola.DataGrid(e.name+"_datagrid"),pergola.extend(t,{owner:e,parent:e.doc.transformable})).build(t)}});break;case Object:pergola.extend(t,t.binding),this.datagrid=pergola.extend(new pergola.DataGrid(this.name+"_datagrid"),pergola.extend(t,{owner:this,parent:this.doc.transformable})).build(t)}else this.datagrid=pergola.extend(new pergola.DataGrid(this.name+"_datagrid"),pergola.extend(t,{owner:this,parent:this.doc.transformable})).buildEmpty(t);return this},addTools:function(){var t,i,o,s,n,r=arguments[0],a=this.toolBar.hasDecoration?this.toolBar.decor.height-7:e.toolButton.height,l=this.toolBar.spacing,h=0,p=Math.ceil((this.toolBar.height-a)/2);for(o in r){t=r[o],n={x:this.toolBar.advanceX,container:$C({element:"g",transform:"translate("+this.toolBar.advanceX+" "+p+")",appendTo:this.toolBar.container})},this.toolBar.groups.push(n);for(s in t)"separator"!=s?(i=t[s],this[s]=new pergola.ToolButton(s),pergola.extend(i,{owner:this,parent:n.container,x:h,width:i.width||(this.toolBar.hasDecoration?this.toolBar.decor.height-4:e.toolButton.width),height:a,extra:{rx:e.toolButton.rx}}),this[s].build(i),i.exclusive&&this.exclusiveTools.push(this[s]),this.tools.push(this[s]),h+=this[s].width+l):(n.separator=(new pergola.Separator).build({parent:n.container,y:1,height:a-2,type:"vertical"}),h+=n.separator.width);this.toolBar.advanceX+=h-l}},addMenu:function(t){this.menu||(this.menu={},this.menubar=new pergola.Menubar(this.id+"_menuBar"),this.menubar.build({owner:this,parent:this.commands,y:this.topBar.height-this.menubar.height-1,fill:"none"}));for(var e in t)this.menu[e]=new pergola.Menu(e).build(pergola.extend(t[e],{owner:this,parent:this.menubar.container}))},handleEvent:function(){return pergola.preemptiveIsUp?void pergola.preemptiveIsUp.warn():void this.bringToFront()},build:function(){pergola.extend(this,arguments[0]);var t,i,o,s,n="map"==this.type,r="editor"==this.type,a="datagrid"==this.type,l="regular",h="lensTool",p="handTool",d=pergola.messages;if(pergola.Window.windows.push(this),this.tools=[],this.exclusiveTools=[],this.hasUndo&&(this.undoManager=new pergola.Undo),this.title=this.name,-1!=this.title.indexOf("Untitled")&&(this.title=this.title.replace("_","-"),pergola.Window.untitled++),!this.hasToolBar&&this.hasZoomAndPan&&(this.hasToolBar=!0),(n||r)&&(this.docBgResizable=!1),r&&(this.minWidth=656,this.minHeight=200),n){{var c,u=pergola.messages,m={Keyboard:u.kbdNavHelp,Mouse:u.mouseNavHelp,Scrollbars:u.scrollHelp,"Lens tool":u.lensToolHelp,"Hand tool":u.handToolHelp,"Minus tool":u.minusToolHelp,"Plus tool":u.plusToolHelp,"Itinerary tool":u.itineraryToolHelp,"Measure tool":u.measureToolHelp},g=$C({element:"text",y:28,"font-family":"'Trebuchet MS'","font-size":"10px",appendTo:pergola.user});$C({element:"tspan",x:10,y:20,"font-family":"'Trebuchet MS'","font-size":"11px","font-weight":"bold","letter-spacing":"1pt",kerning:0,textNode:"NAVIGATION HELP",appendTo:g})}l="navigation",h="mapLensTool",p="mapHandTool";for(i in m){$C({element:"tspan",x:10,dy:18,"font-weight":"bold",fill:"#313133",textNode:i,appendTo:g});for(o in m[i])$C({element:"tspan",x:16,dy:12,textNode:m[i][o],appendTo:g})}c=g.getBBox(),this.navHelpPanel=new pergola.Panel,this.navHelpPanel.build({type:"basic",title:"NAVIGATION HELP",filter:"none",fill:"#FFFFFE",x:1,y:1,width:c.width+18,height:c.height+20,contains:g})}if(this.container=$C({element:"svg",id:this.id,x:this.x,y:this.y,width:this.width,height:this.height,appendTo:pergola.user}),this.container.addEventListener("mousedown",this,!0),this.doc=new pergola.Doc(this.id+"_doc"),this.frame=new pergola.Frame(this.id+"_frame").build({owner:this,parent:this.container}),this.hasStatus&&(s=n?{centerLon:{caption:"Lon:"},centerLat:{caption:"Lat:"},zoomLevel:{input:{owner:this,callback:{keypress:pergola.Key.keypressPosInt},x:200,width:26,height:15,"font-size":10,caption:{x:-2,"font-size":10,textNode:"Level:",inverse:!0},max:21,min:1,maxLength:2,value:"1",allowEmpty:!1,message:pergola.messages.mapLevelRange,fn:"mapZoom"}},locLon:{input:{owner:this,callback:{keypress:pergola.Key.keypressNum},x:320,width:48,height:15,"font-size":10,caption:{x:-2,"font-size":10,textNode:"Location Lon:",inverse:!0},suffix:{"font-size":10,textNode:"°",inverse:!0},max:180,min:-180,maxLength:8,value:"0.0000",allowEmpty:!1,target:this.status,propName:"locLon",fn:"setLocation"}},locLat:{input:{owner:this,callback:{keypress:pergola.Key.keypressNum},x:440,width:44,height:15,"font-size":10,caption:{x:-2,"font-size":10,textNode:"Location Lat:",inverse:!0},suffix:{"font-size":10,textNode:"°",inverse:!0},max:180,min:-180,maxLength:8,value:"0.0000",allowEmpty:!1,target:this.status,propName:"locLat",fn:"setLocation"}}}:a?{zoomLevel:{input:{callback:{keypress:pergola.Key.keypressPos},x:52,width:48,height:16,"font-size":10,caption:{x:-2,"font-size":10,textNode:"Zoom:",inverse:!0},suffix:{"font-size":10,textNode:"%",inverse:!0},hasButtons:!0,realTime:!0,max:800,min:10,maxLength:6,value:100*this.doc.scaleFactor+"",allowEmpty:!1,target:this.doc,propName:"scaleFactor",fn:"zoomFromValue"}}}:{zoomLevel:{input:{callback:{keypress:pergola.Key.keypressPos},x:52,width:48,height:16,"font-size":10,caption:{x:-2,"font-size":10,textNode:"Zoom:",inverse:!0},suffix:{"font-size":10,textNode:"%",inverse:!0},hasButtons:!0,realTime:!0,max:100*this.doc.maxScale,min:100*this.doc.minScale,maxLength:6,value:100*this.doc.scaleFactor+"",allowEmpty:!1,target:this.doc,propName:"scaleFactor",fn:"zoomFromValue"}},coorX:{caption:"x :",value:"0"},coorY:{caption:"y :",value:"0"}},t={owner:this,parent:this.container,fields:s},this.statusHeight&&(t.height=this.statusHeight),this.status=new pergola.StatusBar(this.id+"_statusBar").build(t)),this.commands=$C({element:"g",id:this.id+"_commands",transform:"translate("+this.margin+" "+this.margin+")",appendTo:this.container}),this.topBar=new pergola.WindowTopBar(this.id+"_topBar").build({owner:this,parent:this.commands}),this.progress=new pergola.Progress(this.id+"progress").build({owner:this,parent:this.commands,y:this.topBar.height-1,width:this.topBar.width-2,height:1.5,fill:"none",stroke:"none"}),this.hasCommands&&(this.closeGroup=$C({element:"g",id:this.id+"_closeGroup",transform:"translate("+this.closeGroupPos()+")",appendTo:this.topBar.container}),this.minimizeBtn=new pergola.CommandButton(this.id+"_minimizeButton").build({owner:this,parent:this.closeGroup,symbol:{symbol:pergola.symbols.winMinimize,x:4,y:3},ev:"mouseup",fn:function(){this.owner.minimize()
}}),this.full=new pergola.CommandButton(this.id+"_full"),this.full.build({owner:this,parent:this.closeGroup,x:this.full.width+4,symbol:{symbol:pergola.symbols.winFull,x:4,y:3},ev:"mouseup",fn:function(t){this.owner.maximizeInit(t)}}),this.closeBtn=new pergola.CommandButton(this.id+"_closeButton"),this.closeBtn.build({owner:this,parent:this.closeGroup,x:2*this.closeBtn.width+8,symbol:{symbol:pergola.symbols.winClose,x:5,y:4},ev:"mouseup",fn:function(t){this.owner.close(t)}})),this.hasToolBar&&(this.toolBar=new pergola.ToolBar(this.id+"_toolBar").build({owner:this,parent:this.commands,y:this.topBar.height})),this.paneY=this.margin+this.topBar.height+(this.hasToolBar?this.toolBar.height:0),this.menu){this.menubar=new pergola.Menubar(this.id+"_menuBar"),this.menubar.build({owner:this,parent:this.commands,y:this.topBar.height-this.menubar.height-1,fill:"none"});for(i in this.menu)this.menu[i]=new pergola.Menu(this.id+i).build(pergola.extend(this.menu[i],{owner:this,parent:this.menubar.container}))}if(this.hasZoomAndPan&&(this.addTools({zoomGroup:{lensTool:{type:"zoom&pan",actOnCanvas:!0,prevent:!0,symbol:{symbol:pergola.symbols.lens,x:12,y:10},exclusive:!0,quickTip:h,cursor:"url(#plusCursor)",altCursor:"url(#minusCursor)",fn:"zoomBylensToolInit"},zoomDown:{symbol:{symbol:pergola.symbols.zoomMinus,x:8,y:11},quickTip:"zoomdown",ev:["mousedown","mouseup","mouseout"],fn:n?"mapZoomTimerInit":"zoomTimerInit",zoomTimer:pergola.Timer(),callback:n?this.mapZoomDownByButton:this.zoomDownByButton},zoomUp:{symbol:{symbol:pergola.symbols.zoomPlus,x:8,y:11},quickTip:"zoomup",ev:["mousedown","mouseup","mouseout"],fn:n?"mapZoomTimerInit":"zoomTimerInit",zoomTimer:pergola.Timer(),callback:n?this.mapZoomUpByButton:this.zoomUpByButton},handTool:{type:"zoom&pan",actOnCanvas:!0,prevent:!0,symbol:{symbol:pergola.symbols.hand,x:8,y:7},exclusive:!0,quickTip:p,cursor:"move",fn:"scrollByhandToolInit"}}}),n&&(this.addTools({rulerGroup:{separator:!0,itineraryTool:{type:"measure",actOnCanvas:!0,location:!0,symbol:{symbol:pergola.symbols.itinerary,x:4.5,y:4},exclusive:!0,quickTip:"itineraryTool",cursor:"crosshair",fn:"measureItinerary"},measureTool:{type:"measure",actOnCanvas:!0,prevent:!0,location:!0,symbol:{symbol:pergola.symbols.measure,x:4.5,y:4},exclusive:!0,quickTip:"measureTool",cursor:"crosshair",fn:"measureByRulerTool"}}}),this.addTools({helpGroup:{separator:!0,mapHelp:{symbol:{symbol:pergola.symbols.question,x:9.75,y:18},quickTip:"mapHelp",ev:"click",fn:function(t){this.owner.mapHelpOn?this.owner.mapHelpToggleOff(t):this.owner.mapHelpToggleOn(t)}}}}))),this.background=new pergola.Background(this.id+"_background").build({owner:this,parent:this.container,x:this.margin+.5,y:this.paneY+.5,width:0,height:0,fill:this.fill,stroke:"#A0A0A0"}),this.doc.build({owner:this,parent:this.container,x:this.margin+1,y:this.paneY+1,docBgResizable:this.docBgResizable}),n&&this.doc.container.appendChild(this.navHelpPanel.container),this.hScrollBar=new pergola.Scrollbar(this.id+"_hScrollBar").buildH({owner:this,parent:this.container,scrollTarget:this.doc,scrollType:l,size:this.scrollSize,symbol:pergola.symbols.arrow.small}),this.vScrollBar=new pergola.Scrollbar(this.id+"_vScrollBar").buildV({owner:this,parent:this.container,scrollTarget:this.doc,scrollType:l,size:this.scrollSize,symbol:pergola.symbols.arrow.small}),this.resizeBtn=new pergola.Button(this.id+"_resizeButton").build({owner:this,parent:this.container,width:this.hScrollBar.size,height:this.hScrollBar.size,maskFill:"none",fill:e.scrollBar.fill,stroke:"none","fill-opacity":1,hasVisualEffects:!1,x:this.hScrollBar.size+this.margin+1.5,y:this.hScrollBar.size+this.margin+1.5,symbol:{symbol:pergola.symbols.resize,x:this.hScrollBar.size-10,y:this.hScrollBar.size-10},extra:{cursor:"se-resize"},ev:"mousedown",fn:function(t){pergola.dragarea.activate(this.owner.resizeByButton(t))}}),this.container.appendChild(this.commands),this.hasCommands&&(pergola.taskbar.toggleOn(),this.tab=new pergola.WindowTab(this.id+"_tab").build({owner:this,parent:pergola.tabsDock.container}),this.preview=new pergola.Preview(this.id+"_preview").build({owner:this,parent:this.tab.container,y:"top"==pergola.taskbar.position?this.tab.y+this.tab.height+4:-e.preview.height})),this.contextMenus)for(i in this.contextMenus)if(this[i])if(this[i].contextMenuItems){for(var f in this.contextMenus[i]){this.contextMenus[i][f].separator=new pergola.Separator;break}pergola.extend(this[i].contextMenuItems,this.contextMenus[i])}else this[i].contextMenuItems=this.contextMenus[i];else alert(d.missingCompForCmenu[0]+i+d.missingCompForCmenu[1]+d.missingComponent[0]+this.name+d.missingComponent[1]+i+d.missingComponent[2]);return this.isFull&&"map"!=this.type&&this.maximize(),this.contains&&("function"==typeof this.contains?this.contains():this.doc.transformable.appendChild(this.contains)),this.doc.updateOnMutation(),this.bringToFront(),this.isFull&&n&&(this.maximize(),this.release()),this.minimized&&this.minimize(),this}}),i=e.windowTab,t(pergola.WindowTab.prototype,{"font-size":i["font-size"],height:e.taskBar.height-6,width:i.width,fill:i.fill,maskFill:i.maskFill,maskStroke:i.maskStroke,textFill:e.text.fill,textFillInverse:e.text.fillInverse,hasTextEffect:!1,setTitle:function(){var t=this.owner.title.truncateWithDots(this.width-10,this["font-size"]);this.text.firstChild.data=t},close:function(){var t=pergola.Window.tabs;for(var e in t)if(t[e]==this.tab){t.splice(e,1);break}pergola.tabsDock.closedGroup.appendChild(this.container),pergola.tabsDock.reorganize()},open:function(){pergola.Window.tabs.push(this),pergola.tabsDock.container.appendChild(this.container),pergola.tabsDock.reorganize()},remove:function(){var t=pergola.Window.tabs;for(var e in t)if(t[e]==this){t.splice(e,1);break}pergola.tabsDock.container.removeChild(this.container),pergola.tabsDock.reorganize()},handleEvent:function(t){var e=this.owner;return t.detail>1?void t.preventDefault():pergola.preemptiveIsUp?void("mousedown"==t.type&&pergola.preemptiveIsUp.warn()):2==t.button&&this.contextMenuItems?void this.setContextmenu(t,this.button,this.contextMenuItems):void("mousedown"==t.type?this.registerEvents(this.button,["mouseup"]):"mouseup"==t.type?(e.preview.hide(),this.unregisterEvents(this.button,["mouseup"]),e.minimized?e.restore(t):e.isTop?e.minimize():e.bringToFront()):"mouseover"==t.type?(this.rollover(t),e.datagrid||e.preview.update(),e.preview.show()):"mouseout"==t.type&&(e.preview.hide(),this.rollover(t)))},build:function(){return pergola.extend(this,arguments[0]),this.owner?(this.container=$C({element:"g",id:this.id,appendTo:this.parent}),this.mask=$C({element:"rect",x:2.5,y:3.5,width:this.width-2,height:this.height-2,fill:"none",stroke:this.maskStroke,"pointer-events":"none",appendTo:this.container}),this.button=$C({element:"rect",x:1.5,y:2.5,width:this.width,height:this.height,fill:this.fill,"fill-opacity":0,stroke:this.stroke,appendTo:this.container}),this.registerEvents(this.button,["mousedown","mouseover","mouseout"]),this.text=$C({element:"text",x:this.width/2,y:19,"font-size":this["font-size"],"text-anchor":"middle",fill:this.textFill,"pointer-events":"none",textNode:" ",appendTo:this.container}),this.setTitle(),pergola.Window.tabs.push(this),pergola.tabsDock.reorganize(),this):void alert(pergola.messages.missingOwner+"WindowTab")}}),i=e.topBar,t(pergola.WindowTopBar.prototype,{height:i.height.window,fill:i.fill.window,maskFill:i.maskFill,maskOpacity:0,handleEvent:function(t){var e=this.owner;return t.detail>1&&t.preventDefault(),pergola.preemptiveIsUp?void pergola.preemptiveIsUp.warn():2==t.button&&this.contextMenuItems?void this.setContextmenu(t,this.bar,this.contextMenuItems):void(e.isFull||pergola.dragarea.activate({callback:e.move,handle:e,target:e.container,offset:{x:t.clientX-e.x,y:t.clientY-e.y}}))},build:function(){return pergola.extend(this,arguments[0]),this.owner?(this.width=this.owner.width-2*this.owner.margin+2,this.container=$C({element:"g",id:this.id,appendTo:this.parent}),this.bar=$C({element:"rect",x:this.x,y:this.y,width:this.width,height:this.height,fill:this.fill,appendTo:this.container}),this.mask=$C({element:"rect",x:this.x,y:this.y,width:this.width,height:this.height,fill:this.maskFill,opacity:this.maskOpacity,"pointer-events":"none",appendTo:this.container}),this.title=$C({element:"text",x:this.owner.width/2,y:this["font-size"]+7,"font-size":this["font-size"],"letter-spacing":1,kerning:0,"font-weight":"bold",fill:this.textFill,"text-anchor":"middle","pointer-events":"none",textNode:this.owner.title,appendTo:this.container}),this.registerEvents(this.bar,"mousedown"),this):void alert(pergola.messages.missingOwner+"WindowTopBar")}}),t(pergola.Key,{active:null,keydown:function(t){switch(t.keyCode){case 8:this.value=this.value.substring(0,this.value.length-1),this.setValue(),t.preventDefault();break;case 46:break;case 9:t.preventDefault();break;case 13:pergola.Key.active.release();break;case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:t.preventDefault();break;case 187:t.preventDefault(),this.printShortcut&&(this.value+=t.shiftKey?"+":"=",this.setValue());break;case 189:t.preventDefault(),this.printShortcut&&(this.value+=t.shiftKey?"_":"-",this.setValue());break;case 107:t.preventDefault(),this.printShortcut&&(this.value+="+",this.setValue());break;case 109:t.preventDefault(),this.printShortcut&&(this.value+="-",this.setValue());break;case 191:t.preventDefault(),this.printShortcut&&(this.value+=t.shiftKey?"?":"/",this.setValue());break;case 222:t.preventDefault(),this.printShortcut&&(this.value+=t.shiftKey?'"':"'",this.setValue())}},keypress:function(t){var e=t.charCode;e>31&&65536>e&&(this.value+=String.fromCharCode(e),this.setValue())},keypressNum:function(t){var e=String.fromCharCode(t.charCode);/[0-9]|[.]|[-]/.test(e)&&(this.value+=e,this.setValue())},keypressInt:function(t){var e=String.fromCharCode(t.charCode);/[0-9]||[-]/.test(e)&&(this.value+=e,this.setValue())},keypressPos:function(t){var e=String.fromCharCode(t.charCode);/[0-9]|[.]/.test(e)&&(this.value+=e,this.setValue())},keypressPosInt:function(t){var e=String.fromCharCode(t.charCode);/[0-9]/.test(e)&&(this.value+=e,this.setValue())},keypressHex:function(t){var e=String.fromCharCode(t.charCode);/[ABCDEF]|[0-9]/i.test(e)&&(this.value+=e,this.setValue())},keyup:function(){}}),t(pergola.Key.prototype,{register:function(){pergola.extend(this,arguments[0]);var t=this.handle,e=document.documentElement;return pergola.Key.active&&pergola.Key.active.release(),pergola.Key.active=this,"function"==typeof(this.callback=this.callback||{})?t.kDownCallback=t.kPressCallback=t.kUpCallback=this.callback:(t.kDownCallback=this.callback.keydown||t.keydown||pergola.Key.keydown,t.kPressCallback=this.callback.keypress||t.keypress||pergola.Key.keypress,t.kUpCallback=this.callback.keyup||t.keyup||pergola.Key.keyup),e.addEventListener("keydown",this,!1),e.addEventListener("keypress",this,!1),e.addEventListener("keyup",this,!1),e.addEventListener("mousedown",this.mousedown,!1),"cursor"in this&&!this.cursor||(t.inputCursor=(new pergola.InputCursor).init({user:t})),this},release:function(){if(!("stop"in this)||this.stop){var t=this.handle,e=document.documentElement;e.removeEventListener("keydown",this,!1),e.removeEventListener("keypress",this,!1),e.removeEventListener("keyup",this,!1),e.removeEventListener("mousedown",this.mousedown,!1),pergola.Key.active=null,"cursor"in this&&!this.cursor||t.inputCursor.remove(),t.endInput&&t.endInput(arguments[0]),this.destroy&&pergola.destroy(t,this.destroy)}},mousedown:function(){pergola.Key.active.release()},handleEvent:function(t){switch(t.type){case"keydown":this.handle.kDownCallback(t);break;case"keypress":this.handle.kPressCallback(t);break;case"keyup":this.handle.kUpCallback(t)}}}),t(pergola.Undo.prototype,{canUndo:function(){return this.index>0},canRedo:function(){return this.buffer.length>this.index},add:function(t){var e=this.buffer.splice(this.index,this.buffer.length-this.index++);if(e.length&&this.destroy(e),this.buffer.push(t),this.buffer.length>this.max){var e=this.buffer.shift();this.index--,this.destroy([e])}return this},cancel:function(){this.buffer.pop(),this.index--},destroy:function(t){function e(t){for(n in r)if(t==r[n])return!0}var i,o,s,n,r=[],a=[];for(o in this.buffer)for(s in this.buffer[o])r.push(this.buffer[o][s].obj);for(o in t)for(s in t[o])i=t[o][s].obj,e(i)||a.push(i);for(o in a)i=a[o],i.pendingDelete&&i.destroy&&i.destroy()},flush:function(){this.destroy(this.buffer),this.buffer=[]},undo:function(){if(this.canUndo()){var t=this.buffer[--this.index];for(var e in t)t[e].undo()}},redo:function(){if(this.canRedo()){var t=this.buffer[this.index++];for(var e in t)t[e].redo()}},handleEvent:function(t){t.preventDefault(),t.ctrlKey&&90==t.keyCode&&(t.shiftKey?this.redo():this.undo())},register:function(){return document.documentElement.addEventListener("keydown",this,!1),this},disable:function(){document.documentElement.removeEventListener("keydown",this,!1)}})}(),function(){var t,e,i=(pergola.container,pergola.presentationAttributes),o=i.all;pergola.attribute(pergola.doc,{"font-family":o["font-family"],"font-size":o["font-size"]}),pergola.symbols=pergola.symbols(),pergola.cursors(),pergola.desktop=$C({element:"g",id:"pergola_desktop",appendTo:pergola.doc}),pergola.background=new pergola.Background("pergola_background").build({owner:pergola,parent:pergola.desktop}),pergola.user=$C({element:"g",id:"pergola_userLayer",appendTo:pergola.desktop}),pergola.Class.prototype.parent=pergola.user,pergola.systemComponents=$C({element:"g",id:"pergola_systemComponents",appendTo:pergola.desktop}),pergola.preemptive=$C({element:"g",id:"pergola_preemptive",appendTo:pergola.systemComponents}),pergola.debug&&pergola["debugger"](),o=i.notification,pergola.notification=new pergola.Panel("pergola notification").build({parent:pergola.systemComponents,title:"MESSAGE",x:o.x,y:o.y,width:o.width,height:o.height,hasFooter:!0,fill:o.fill,cancelButton:{text:"Close"},layout:{type:"message"},preemptive:!0}),t=pergola.quicktips={},t.container=$C({element:"g",id:"pergola_quickTips",appendTo:pergola.systemComponents});for(e in pergola.quickTip)t[e]=new pergola.QuickTip("quickTip_"+e).build(pergola.quickTip[e]);pergola.rubberBox=new pergola.RubberBox("pergola_rubberBox").build(),pergola.coordinates=(new pergola.Coordinates).build({parent:pergola.systemComponents}),pergola.dragarea=new pergola.Dragarea("pergola_dragarea").build(),pergola.taskbar=new pergola.Taskbar("pergola_taskbar").build({owner:pergola,parent:pergola.systemComponents}),pergola.tabsDock=new pergola.TabsDock("pergola_tabsDock").build({parent:pergola.taskbar.container,x:40*pergola.taskbarLogo}),pergola.contextMenus=$C({element:"g",id:"pergola_contextMenus",appendTo:pergola.systemComponents}),pergola.Contextmenu.prototype.parent=pergola.contextMenus,pergola.doc.addEventListener("mousedown",pergola.select,!1),window.addEventListener("resize",pergola.resize,!1),window.addEventListener("contextmenu",pergola.contextmenuManager.browser,!1)}();